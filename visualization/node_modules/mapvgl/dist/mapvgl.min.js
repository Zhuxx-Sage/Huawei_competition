(function(x,N){"object"===typeof exports&&"undefined"!==typeof module?N(exports):"function"===typeof define&&define.amd?define(["exports"],N):(x=x||self,N(x.mapvgl={}))})(this,function(x){function N(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f["default"]:f}function K(f,c){return c={exports:{}},f(c,c.exports),c.exports}function Rf(f,c){return function(a){return c(f(a))}}function Sf(f){var c=function(a){if(void 0===a||null===a)return a;1<arguments.length&&(a=Array.prototype.slice.call(arguments));
return f(a)};"conversion"in f&&(c.conversion=f.conversion);return c}function Tf(f){var c=function(a){if(void 0===a||null===a)return a;1<arguments.length&&(a=Array.prototype.slice.call(arguments));var b=f(a);if("object"===("undefined"===typeof b?"undefined":bc(b)))for(var d=b.length,c=0;c<d;c++)b[c]=Math.round(b[c]);return b};"conversion"in f&&(c.conversion=f.conversion);return c}function da(f,c){if(!(this instanceof da))return new da(f,c);c&&c in Md&&(c=null);if(c&&!(c in ta))throw Error("Unknown model: "+
c);if("undefined"===typeof f)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(f instanceof da)this.model=f.model,this.color=f.color.slice(),this.valpha=f.valpha;else if("string"===typeof f){c=yb.get(f);if(null===c)throw Error("Unable to parse color from string: "+f);this.model=c.model;var a=ta[this.model].channels;this.color=c.value.slice(0,a);this.valpha="number"===typeof c.value[a]?c.value[a]:1}else if(f.length)this.model=c||"rgb",a=ta[this.model].channels,c=Hc.call(f,0,a),this.color=Ic(c,
a),this.valpha="number"===typeof f[a]?f[a]:1;else if("number"===typeof f)f&=16777215,this.model="rgb",this.color=[f>>16&255,f>>8&255,f&255],this.valpha=1;else{this.valpha=1;c=Ba(f);"alpha"in f&&(c.splice(c.indexOf("alpha"),1),this.valpha="number"===typeof f.alpha?f.alpha:0);c=c.sort().join("");if(!(c in Jc))throw Error("Unable to parse color from object: "+Uf(f));this.model=Jc[c];a=ta[this.model].labels;var b=[];for(c=0;c<a.length;c++)b.push(f[a[c]]);this.color=Ic(b)}if(cc[this.model])for(a=ta[this.model].channels,
c=0;c<a;c++)(f=cc[this.model][c])&&(this.color[c]=f(this.color[c]));this.valpha=Math.max(0,Math.min(1,this.valpha));Nd&&Nd(this)}function Vf(f){return function(c){return Number(c.toFixed(f))}}function X(f,c,a){f=Array.isArray(f)?f:[f];f.forEach(function(b){(cc[b]||(cc[b]=[]))[c]=a});f=f[0];return function(b){if(arguments.length){a&&(b=a(b));var d=this[f]();d.color[c]=b;return d}d=this[f]().color[c];a&&(d=a(d));return d}}function ea(f){return function(c){return Math.max(0,Math.min(f,c))}}function Ic(f,
c){for(var a=0;a<c;a++)"number"!==typeof f[a]&&(f[a]=0);return f}function ja(f){return f*Math.PI/180}function Kc(f){return f/Math.PI*180}function zb(f){return Math.pow(2,Math.ceil(Math.log(f)/Math.LN2))}function Lc(f){return Math.pow(2,Math.floor(Math.log(f)/Math.LN2))}function Mc(f,c){return 1E-8>Math.abs(f-c)}function ua(){}function Od(f,c){for(var a in c)f[a]=c[a]}function Fa(f,c){this.lng=f;this.lat=c}function Pd(f,c){this.x=f;this.y=c}function Nc(f,c){var a=document.createElement("canvas");f&&
(a.width=f);c&&(a.height=c);return a}function la(f){f=f||{};this.gradient=f.gradient||{"0.25":"rgba(0, 0, 255, 1)","0.55":"rgba(0, 255, 0, 1)","0.85":"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"};this.maxSize=void 0===f.maxSize?35:f.maxSize;this.minSize=f.minSize||0;this.max=f.max||100;this.min=f.min||0;this.initPalette()}function La(f){this.options=f||{};this._initialize()}function Oc(f,c,a,b,d){var e=1-f,g=1-f;return e*e*e*c+3*g*g*f*a+3*(1-f)*f*f*b+f*f*f*d}function Sa(f){this.WORLD_SIZE_MC_HALF=
2.0037726372307256E7;this.WORLD_SIZE_MC=2*this.WORLD_SIZE_MC_HALF;this.options=f||{};this._initialize()}function Qd(f,c){return f&&c?Math.round(Math.sqrt(Math.pow(f.lng-c.lng,2)+Math.pow(f.lat-c.lat,2))):0}function Rd(f){for(var c=["webgl2","experimental-webgl2","webgl","experimental-webgl"],a,b=0;b<c.length;b++)try{if(a=f.getContext(c[b],{premultipliedAlpha:!1}))break}catch(d){}return a}function kb(f,c,a){a=W({TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"REPEAT",TEXTURE_WRAP_T:"REPEAT"},
a);var b=f.createTexture();f.bindTexture(f.TEXTURE_2D,b);f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!0);f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,c);for(var d in a)f.texParameteri(f.TEXTURE_2D,f[d],f[a[d]]);f.bindTexture(f.TEXTURE_2D,null);return b}function Ma(f,c,a,b){if("object"===("undefined"===typeof c?"undefined":bc(c)))c=kb(f,c,b),a(c,null);else{var d=new Image;d.crossOrigin="anonymous";d.onload=function(){var c=Lc(d.width),g=Lc(d.height),k=document.createElement("canvas");k.width=
c;k.height=g;k.getContext("2d").drawImage(d,0,0,c,g);d=k;c=kb(f,d,b);a(c,d)};d.src=c}}function Ab(f,c,a){a=a||2;var b=c&&c.length,d=b?c[0]*a:f.length,e=Sd(f,0,d,a,!0),g=[];if(!e||e.next===e.prev)return g;var k;if(b){var h=a;b=[];var m;var n=0;for(m=c.length;n<m;n++){var p=c[n]*h;var l=n<m-1?c[n+1]*h:f.length;p=Sd(f,p,l,h,!1);p===p.next&&(p.steiner=!0);b.push(Wf(p))}b.sort(Xf);for(n=0;n<b.length;n++){c=b[n];h=e;if(h=Yf(c,h))c=Td(h,c),Bb(c,c.next);e=Bb(e,e.next)}}if(f.length>80*a){var q=k=f[0];var r=
b=f[1];for(h=a;h<d;h+=a)n=f[h],c=f[h+1],n<q&&(q=n),c<r&&(r=c),n>k&&(k=n),c>b&&(b=c);k=Math.max(k-q,b-r);k=0!==k?1/k:0}Cb(e,g,a,q,r,k);return g}function Sd(f,c,a,b,d){if(d===0<Pc(f,c,a,b))for(d=c;d<a;d+=b)var e=Ud(d,f[d],f[d+1],e);else for(d=a-b;d>=c;d-=b)e=Ud(d,f[d],f[d+1],e);e&&$a(e,e.next)&&(Db(e),e=e.next);return e}function Bb(f,c){if(!f)return f;c||(c=f);do{var a=!1;if(f.steiner||!$a(f,f.next)&&0!==ka(f.prev,f,f.next))f=f.next;else{Db(f);f=c=f.prev;if(f===f.next)break;a=!0}}while(a||f!==c);return c}
function Cb(f,c,a,b,d,e,g){if(f){if(!g&&e){var k=f,h=k;do null===h.z&&(h.z=Qc(h.x,h.y,b,d,e)),h.prevZ=h.prev,h=h.nextZ=h.next;while(h!==k);h.prevZ.nextZ=null;h.prevZ=null;k=h;var m,n,p,l,q=1;do{h=k;var r=k=null;for(n=0;h;){n++;var t=h;for(m=p=0;m<q&&(p++,t=t.nextZ,t);m++);for(l=q;0<p||0<l&&t;)0!==p&&(0===l||!t||h.z<=t.z)?(m=h,h=h.nextZ,p--):(m=t,t=t.nextZ,l--),r?r.nextZ=m:k=m,m.prevZ=r,r=m;h=t}r.nextZ=null;q*=2}while(1<n)}for(k=f;f.prev!==f.next;){h=f.prev;t=f.next;if(e)r=Zf(f,b,d,e);else a:if(r=
f,n=r.prev,p=r,q=r.next,0<=ka(n,p,q))r=!1;else{for(m=r.next.next;m!==r.prev;){if(lb(n.x,n.y,p.x,p.y,q.x,q.y,m.x,m.y)&&0<=ka(m.prev,m,m.next)){r=!1;break a}m=m.next}r=!0}if(r)c.push(h.i/a),c.push(f.i/a),c.push(t.i/a),Db(f),k=f=t.next;else if(f=t,f===k){if(!g)Cb(Bb(f),c,a,b,d,e,1);else if(1===g){g=c;k=a;h=f;do t=h.prev,r=h.next.next,!$a(t,r)&&Vd(t,h,h.next,r)&&Eb(t,r)&&Eb(r,t)&&(g.push(t.i/k),g.push(h.i/k),g.push(r.i/k),Db(h),Db(h.next),h=f=r),h=h.next;while(h!==f);f=h;Cb(f,c,a,b,d,e,2)}else if(2===
g)a:{g=f;do{for(k=g.next.next;k!==g.prev;){if(h=g.i!==k.i){h=g;t=k;if(r=h.next.i!==t.i&&h.prev.i!==t.i){b:{r=h;do{if(r.i!==h.i&&r.next.i!==h.i&&r.i!==t.i&&r.next.i!==t.i&&Vd(r,r.next,h,t)){r=!0;break b}r=r.next}while(r!==h);r=!1}r=!r}if(r=r&&Eb(h,t)&&Eb(t,h)){r=h;n=!1;p=(h.x+t.x)/2;t=(h.y+t.y)/2;do r.y>t!==r.next.y>t&&r.next.y!==r.y&&p<(r.next.x-r.x)*(t-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==h);r=n}h=r}if(h){f=Td(g,k);g=Bb(g,g.next);f=Bb(f,f.next);Cb(g,c,a,b,d,e);Cb(f,c,a,b,d,e);break a}k=
k.next}g=g.next}while(g!==f)}break}}}}function Zf(f,c,a,b){var d=f.prev,e=f.next;if(0<=ka(d,f,e))return!1;var g=d.x>f.x?d.x>e.x?d.x:e.x:f.x>e.x?f.x:e.x,k=d.y>f.y?d.y>e.y?d.y:e.y:f.y>e.y?f.y:e.y,h=Qc(d.x<f.x?d.x<e.x?d.x:e.x:f.x<e.x?f.x:e.x,d.y<f.y?d.y<e.y?d.y:e.y:f.y<e.y?f.y:e.y,c,a,b);c=Qc(g,k,c,a,b);a=f.prevZ;for(b=f.nextZ;a&&a.z>=h&&b&&b.z<=c;){if(a!==f.prev&&a!==f.next&&lb(d.x,d.y,f.x,f.y,e.x,e.y,a.x,a.y)&&0<=ka(a.prev,a,a.next))return!1;a=a.prevZ;if(b!==f.prev&&b!==f.next&&lb(d.x,d.y,f.x,f.y,
e.x,e.y,b.x,b.y)&&0<=ka(b.prev,b,b.next))return!1;b=b.nextZ}for(;a&&a.z>=h;){if(a!==f.prev&&a!==f.next&&lb(d.x,d.y,f.x,f.y,e.x,e.y,a.x,a.y)&&0<=ka(a.prev,a,a.next))return!1;a=a.prevZ}for(;b&&b.z<=c;){if(b!==f.prev&&b!==f.next&&lb(d.x,d.y,f.x,f.y,e.x,e.y,b.x,b.y)&&0<=ka(b.prev,b,b.next))return!1;b=b.nextZ}return!0}function Xf(f,c){return f.x-c.x}function Yf(f,c){var a=c,b=f.x,d=f.y,e=-Infinity;do{if(d<=a.y&&d>=a.next.y&&a.next.y!==a.y){var g=a.x+(d-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(g<=b&&g>e){e=
g;if(g===b){if(d===a.y)return a;if(d===a.next.y)return a.next}var k=a.x<a.next.x?a:a.next}}a=a.next}while(a!==c);if(!k)return null;if(b===e)return k.prev;c=k;g=k.x;var h=k.y,m=Infinity;for(a=k.next;a!==c;){if(b>=a.x&&a.x>=g&&b!==a.x&&lb(d<h?b:e,d,g,h,d<h?e:b,d,a.x,a.y)){var n=Math.abs(d-a.y)/(b-a.x);(n<m||n===m&&a.x>k.x)&&Eb(a,f)&&(k=a,m=n)}a=a.next}return k}function Qc(f,c,a,b,d){f=32767*(f-a)*d;c=32767*(c-b)*d;f=(f|f<<8)&16711935;f=(f|f<<4)&252645135;f=(f|f<<2)&858993459;c=(c|c<<8)&16711935;c=(c|
c<<4)&252645135;c=(c|c<<2)&858993459;return(f|f<<1)&1431655765|((c|c<<1)&1431655765)<<1}function Wf(f){var c=f,a=f;do{if(c.x<a.x||c.x===a.x&&c.y<a.y)a=c;c=c.next}while(c!==f);return a}function lb(f,c,a,b,d,e,g,k){return 0<=(d-g)*(c-k)-(f-g)*(e-k)&&0<=(f-g)*(b-k)-(a-g)*(c-k)&&0<=(a-g)*(e-k)-(d-g)*(b-k)}function ka(f,c,a){return(c.y-f.y)*(a.x-c.x)-(c.x-f.x)*(a.y-c.y)}function $a(f,c){return f.x===c.x&&f.y===c.y}function Vd(f,c,a,b){return $a(f,c)&&$a(a,b)||$a(f,b)&&$a(a,c)?!0:0<ka(f,c,a)!==0<ka(f,c,
b)&&0<ka(a,b,f)!==0<ka(a,b,c)}function Eb(f,c){return 0>ka(f.prev,f,f.next)?0<=ka(f,c,f.next)&&0<=ka(f,f.prev,c):0>ka(f,c,f.prev)||0>ka(f,f.next,c)}function Td(f,c){var a=new Rc(f.i,f.x,f.y),b=new Rc(c.i,c.x,c.y),d=f.next,e=c.prev;f.next=c;c.prev=f;a.next=d;d.prev=a;b.next=a;a.prev=b;e.next=b;b.prev=e;return b}function Ud(f,c,a,b){f=new Rc(f,c,a);b?(f.next=b.next,f.prev=b,b.next.prev=f,b.next=f):(f.prev=f,f.next=f);return f}function Db(f){f.next.prev=f.prev;f.prev.next=f.next;f.prevZ&&(f.prevZ.nextZ=
f.nextZ);f.nextZ&&(f.nextZ.prevZ=f.prevZ)}function Rc(f,c,a){this.i=f;this.x=c;this.y=a;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function Pc(f,c,a,b){for(var d=0,e=a-b;c<a;c+=b)d+=(f[e]-f[c])*(f[c+1]+f[e+1]),e=c;return d}function Wd(f){try{return dc.createObjectURL(new Blob([f],{type:"application/javascript"}))}catch(a){var c=new $f;c.append(f);return dc.createObjectURL(c.getBlob(type))}}function ab(f,c){this.shapeLayer=f;this.gl=c;this.initData()}function Xd(){Sc=!0;
for(var f=0;64>f;++f)Ga[f]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f],xa["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(f)]=f;xa[45]=62;xa[95]=63}function ag(f,c,a){for(var b=[],d=c;d<a;d+=3)c=(f[d]<<16)+(f[d+1]<<8)+f[d+2],b.push(Ga[c>>18&63]+Ga[c>>12&63]+Ga[c>>6&63]+Ga[c&63]);return b.join("")}function Yd(f){Sc||Xd();for(var c=f.length,a=c%3,b="",d=[],e=0,g=c-a;e<g;e+=16383)d.push(ag(f,e,e+16383>g?g:e+16383));1===a?(f=f[c-1],b+=Ga[f>>2],b+=
Ga[f<<4&63],b+="=="):2===a&&(f=(f[c-2]<<8)+f[c-1],b+=Ga[f>>10],b+=Ga[f>>4&63],b+=Ga[f<<2&63],b+="=");d.push(b);return d.join("")}function ec(f,c,a,b,d){var e=8*d-b-1;var g=(1<<e)-1,k=g>>1,h=-7;d=a?d-1:0;var m=a?-1:1,n=f[c+d];d+=m;a=n&(1<<-h)-1;n>>=-h;for(h+=e;0<h;a=256*a+f[c+d],d+=m,h-=8);e=a&(1<<-h)-1;a>>=-h;for(h+=b;0<h;e=256*e+f[c+d],d+=m,h-=8);if(0===a)a=1-k;else{if(a===g)return e?NaN:Infinity*(n?-1:1);e+=Math.pow(2,b);a-=k}return(n?-1:1)*e*Math.pow(2,a-b)}function Zd(f,c,a,b,d,e){var g,k=8*e-
d-1,h=(1<<k)-1,m=h>>1,n=23===d?Math.pow(2,-24)-Math.pow(2,-77):0;e=b?0:e-1;var p=b?1:-1,l=0>c||0===c&&0>1/c?1:0;c=Math.abs(c);isNaN(c)||Infinity===c?(c=isNaN(c)?1:0,b=h):(b=Math.floor(Math.log(c)/Math.LN2),1>c*(g=Math.pow(2,-b))&&(b--,g*=2),c=1<=b+m?c+n/g:c+n*Math.pow(2,1-m),2<=c*g&&(b++,g/=2),b+m>=h?(c=0,b=h):1<=b+m?(c=(c*g-1)*Math.pow(2,d),b+=m):(c=c*Math.pow(2,m-1)*Math.pow(2,d),b=0));for(;8<=d;f[a+e]=c&255,e+=p,c/=256,d-=8);b=b<<d|c;for(k+=d;0<k;f[a+e]=b&255,e+=p,b/=256,k-=8);f[a+e-p]|=128*l}
function Na(f,c){if((u.TYPED_ARRAY_SUPPORT?2147483647:1073741823)<c)throw new RangeError("Invalid typed array length");u.TYPED_ARRAY_SUPPORT?(f=new Uint8Array(c),f.__proto__=u.prototype):(null===f&&(f=new u(c)),f.length=c);return f}function u(f,c,a){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(f,c,a);if("number"===typeof f){if("string"===typeof c)throw Error("If encoding is specified then the first argument must be a string");return Tc(this,f)}return $d(this,f,c,a)}function $d(f,c,
a,b){if("number"===typeof c)throw new TypeError('"value" argument must not be a number');if("undefined"!==typeof ArrayBuffer&&c instanceof ArrayBuffer){c.byteLength;if(0>a||c.byteLength<a)throw new RangeError("'offset' is out of bounds");if(c.byteLength<a+(b||0))throw new RangeError("'length' is out of bounds");c=void 0===a&&void 0===b?new Uint8Array(c):void 0===b?new Uint8Array(c,a):new Uint8Array(c,a,b);u.TYPED_ARRAY_SUPPORT?(f=c,f.__proto__=u.prototype):f=Uc(f,c);return f}if("string"===typeof c){b=
f;f=a;if("string"!==typeof f||""===f)f="utf8";if(!u.isEncoding(f))throw new TypeError('"encoding" must be a valid string encoding');a=ae(c,f)|0;b=Na(b,a);c=b.write(c,f);c!==a&&(b=b.slice(0,c));return b}return bg(f,c)}function be(f){if("number"!==typeof f)throw new TypeError('"size" argument must be a number');if(0>f)throw new RangeError('"size" argument must not be negative');}function Tc(f,c){be(c);f=Na(f,0>c?0:Vc(c)|0);if(!u.TYPED_ARRAY_SUPPORT)for(var a=0;a<c;++a)f[a]=0;return f}function Uc(f,
c){var a=0>c.length?0:Vc(c.length)|0;f=Na(f,a);for(var b=0;b<a;b+=1)f[b]=c[b]&255;return f}function bg(f,c){if(Ha(c)){var a=Vc(c.length)|0;f=Na(f,a);if(0===f.length)return f;c.copy(f,0,0,a);return f}if(c){if("undefined"!==typeof ArrayBuffer&&c.buffer instanceof ArrayBuffer||"length"in c)return(a="number"!==typeof c.length)||(a=c.length,a=a!==a),a?Na(f,0):Uc(f,c);if("Buffer"===c.type&&ce(c.data))return Uc(f,c.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");
}function Vc(f){if(f>=(u.TYPED_ARRAY_SUPPORT?2147483647:1073741823))throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+(u.TYPED_ARRAY_SUPPORT?2147483647:1073741823).toString(16)+" bytes");return f|0}function Ha(f){return!(null==f||!f._isBuffer)}function ae(f,c){if(Ha(f))return f.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(f)||f instanceof ArrayBuffer))return f.byteLength;"string"!==typeof f&&(f=""+f);var a=f.length;
if(0===a)return 0;for(var b=!1;;)switch(c){case "ascii":case "latin1":case "binary":return a;case "utf8":case "utf-8":case void 0:return fc(f).length;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return 2*a;case "hex":return a>>>1;case "base64":return de(f).length;default:if(b)return fc(f).length;c=(""+c).toLowerCase();b=!0}}function cg(f,c,a){var b=!1;if(void 0===c||0>c)c=0;if(c>this.length)return"";if(void 0===a||a>this.length)a=this.length;if(0>=a)return"";a>>>=0;c>>>=0;if(a<=c)return"";
for(f||(f="utf8");;)switch(f){case "hex":f=c;c=a;a=this.length;if(!f||0>f)f=0;if(!c||0>c||c>a)c=a;b="";for(a=f;a<c;++a)f=b,b=this[a],b=16>b?"0"+b.toString(16):b.toString(16),b=f+b;return b;case "utf8":case "utf-8":return ee(this,c,a);case "ascii":f="";for(a=Math.min(this.length,a);c<a;++c)f+=String.fromCharCode(this[c]&127);return f;case "latin1":case "binary":f="";for(a=Math.min(this.length,a);c<a;++c)f+=String.fromCharCode(this[c]);return f;case "base64":return c=0===c&&a===this.length?Yd(this):
Yd(this.slice(c,a)),c;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":c=this.slice(c,a);a="";for(f=0;f<c.length;f+=2)a+=String.fromCharCode(c[f]+256*c[f+1]);return a;default:if(b)throw new TypeError("Unknown encoding: "+f);f=(f+"").toLowerCase();b=!0}}function bb(f,c,a){var b=f[c];f[c]=f[a];f[a]=b}function fe(f,c,a,b,d){if(0===f.length)return-1;"string"===typeof a?(b=a,a=0):2147483647<a?a=2147483647:-2147483648>a&&(a=-2147483648);a=+a;isNaN(a)&&(a=d?0:f.length-1);0>a&&(a=f.length+a);if(a>=
f.length){if(d)return-1;a=f.length-1}else if(0>a)if(d)a=0;else return-1;"string"===typeof c&&(c=u.from(c,b));if(Ha(c))return 0===c.length?-1:ge(f,c,a,b,d);if("number"===typeof c)return c&=255,u.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?d?Uint8Array.prototype.indexOf.call(f,c,a):Uint8Array.prototype.lastIndexOf.call(f,c,a):ge(f,[c],a,b,d);throw new TypeError("val must be string, number or Buffer");}function ge(f,c,a,b,d){function e(a,b){return 1===g?a[b]:a.readUInt16BE(b*
g)}var g=1,k=f.length,h=c.length;if(void 0!==b&&(b=String(b).toLowerCase(),"ucs2"===b||"ucs-2"===b||"utf16le"===b||"utf-16le"===b)){if(2>f.length||2>c.length)return-1;g=2;k/=2;h/=2;a/=2}if(d)for(b=-1;a<k;a++)if(e(f,a)===e(c,-1===b?0:a-b)){if(-1===b&&(b=a),a-b+1===h)return b*g}else-1!==b&&(a-=a-b),b=-1;else for(a+h>k&&(a=k-h);0<=a;a--){k=!0;for(b=0;b<h;b++)if(e(f,a+b)!==e(c,b)){k=!1;break}if(k)return a}return-1}function ee(f,c,a){a=Math.min(f.length,a);for(var b=[];c<a;){var d=f[c],e=null,g=239<d?
4:223<d?3:191<d?2:1;if(c+g<=a)switch(g){case 1:128>d&&(e=d);break;case 2:var k=f[c+1];128===(k&192)&&(d=(d&31)<<6|k&63,127<d&&(e=d));break;case 3:k=f[c+1];var h=f[c+2];128===(k&192)&&128===(h&192)&&(d=(d&15)<<12|(k&63)<<6|h&63,2047<d&&(55296>d||57343<d)&&(e=d));break;case 4:k=f[c+1];h=f[c+2];var m=f[c+3];128===(k&192)&&128===(h&192)&&128===(m&192)&&(d=(d&15)<<18|(k&63)<<12|(h&63)<<6|m&63,65535<d&&1114112>d&&(e=d))}null===e?(e=65533,g=1):65535<e&&(e-=65536,b.push(e>>>10&1023|55296),e=56320|e&1023);
b.push(e);c+=g}f=b.length;if(f<=he)b=String.fromCharCode.apply(String,b);else{a="";for(c=0;c<f;)a+=String.fromCharCode.apply(String,b.slice(c,c+=he));b=a}return b}function ha(f,c,a){if(0!==f%1||0>f)throw new RangeError("offset is not uint");if(f+c>a)throw new RangeError("Trying to access beyond buffer length");}function pa(f,c,a,b,d,e){if(!Ha(f))throw new TypeError('"buffer" argument must be a Buffer instance');if(c>d||c<e)throw new RangeError('"value" argument is out of bounds');if(a+b>f.length)throw new RangeError("Index out of range");
}function gc(f,c,a,b){0>c&&(c=65535+c+1);for(var d=0,e=Math.min(f.length-a,2);d<e;++d)f[a+d]=(c&255<<8*(b?d:1-d))>>>8*(b?d:1-d)}function hc(f,c,a,b){0>c&&(c=4294967295+c+1);for(var d=0,e=Math.min(f.length-a,4);d<e;++d)f[a+d]=c>>>8*(b?d:3-d)&255}function ie(f,c,a,b,d,e){if(a+b>f.length)throw new RangeError("Index out of range");if(0>a)throw new RangeError("Index out of range");}function je(f,c,a,b,d){d||ie(f,c,a,4,3.4028234663852886E38,-3.4028234663852886E38);Zd(f,c,a,b,23,4);return a+4}function ke(f,
c,a,b,d){d||ie(f,c,a,8,1.7976931348623157E308,-1.7976931348623157E308);Zd(f,c,a,b,52,8);return a+8}function fc(f,c){c=c||Infinity;for(var a,b=f.length,d=null,e=[],g=0;g<b;++g){a=f.charCodeAt(g);if(55295<a&&57344>a){if(!d){if(56319<a){-1<(c-=3)&&e.push(239,191,189);continue}else if(g+1===b){-1<(c-=3)&&e.push(239,191,189);continue}d=a;continue}if(56320>a){-1<(c-=3)&&e.push(239,191,189);d=a;continue}a=(d-55296<<10|a-56320)+65536}else d&&-1<(c-=3)&&e.push(239,191,189);d=null;if(128>a){if(0>--c)break;
e.push(a)}else if(2048>a){if(0>(c-=2))break;e.push(a>>6|192,a&63|128)}else if(65536>a){if(0>(c-=3))break;e.push(a>>12|224,a>>6&63|128,a&63|128)}else if(1114112>a){if(0>(c-=4))break;e.push(a>>18|240,a>>12&63|128,a>>6&63|128,a&63|128)}else throw Error("Invalid code point");}return e}function le(f){for(var c=[],a=0;a<f.length;++a)c.push(f.charCodeAt(a)&255);return c}function de(f){f=(f.trim?f.trim():f.replace(/^\s+|\s+$/g,"")).replace(dg,"");if(2>f.length)f="";else for(;0!==f.length%4;)f+="=";Sc||Xd();
var c=f.length;if(0<c%4)throw Error("Invalid string. Length must be a multiple of 4");var a="="===f[c-2]?2:"="===f[c-1]?1:0;var b=new eg(3*c/4-a);var d=0<a?c-4:c;var e=0;for(c=0;c<d;c+=4){var g=xa[f.charCodeAt(c)]<<18|xa[f.charCodeAt(c+1)]<<12|xa[f.charCodeAt(c+2)]<<6|xa[f.charCodeAt(c+3)];b[e++]=g>>16&255;b[e++]=g>>8&255;b[e++]=g&255}2===a?(g=xa[f.charCodeAt(c)]<<2|xa[f.charCodeAt(c+1)]>>4,b[e++]=g&255):1===a&&(g=xa[f.charCodeAt(c)]<<10|xa[f.charCodeAt(c+1)]<<4|xa[f.charCodeAt(c+2)]>>2,b[e++]=g>>
8&255,b[e++]=g&255);return b}function Fb(f,c,a,b){for(var d=0;d<b&&!(d+a>=c.length||d>=f.length);++d)c[d+a]=f[d];return d}function me(f){return!!f.constructor&&"function"===typeof f.constructor.isBuffer&&f.constructor.isBuffer(f)}function ya(f,c){var a=[];f.forEach(function(b){a.push(c?-b:b,b)});return a}function ne(f){for(var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=[],b=0;b<f-1;b++){var d=2*(b+c);a.push(d,d+1,d+2);a.push(d+2,d+1,d+3)}return a}function ic(f){return function(c,
a,b){c=a+f;a=b.length-1;return b[0<a?0>c?0:c>a?a:c:c<a?a:0<c?0:c]}}function Oa(f){if(!f[0]||!f[0].length)return f;for(var c=f[0].length,a=[],b=0,d=0;d<f.length;d++)for(var e=0;e<c;e++)a[b++]=f[d][e];return a}function oe(){for(var f=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],c=[],a=0,b=0;b<f.length;b++){var d=f[b];if(0<b){var e=f[b-1];a+=Math.sqrt(Math.pow(d[0]-e[0],2)+Math.pow(d[1]-e[1],2))}c.push(a)}return{arr:c,total:a}}function pe(f){var c=0,a=0,b=!0,d=!1,e=void 0;try{for(var g=
Wc(f),k;!(b=(k=g.next()).done);b=!0){var h=k.value;c+=h.w*h.h;a=Math.max(a,h.w)}}catch(t){d=!0,e=t}finally{try{!b&&g.return&&g.return()}finally{if(d)throw e;}}f.sort(function(a,b){return b.h-a.h});a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),a),h:Infinity}];d=b=0;e=!0;g=!1;k=void 0;try{for(var m=Wc(f),n;!(e=(n=m.next()).done);e=!0)for(var p=n.value,l=a.length-1;0<=l;l--){var q=a[l];if(!(p.w>q.w||p.h>q.h)){p.x=q.x;p.y=q.y;d=Math.max(d,p.y+p.h);b=Math.max(b,p.x+p.w);if(p.w===q.w&&p.h===q.h){var r=
a.pop();l<a.length&&(a[l]=r)}else p.h===q.h?(q.x+=p.w,q.w-=p.w):(p.w!==q.w&&a.push({x:q.x+p.w,y:q.y,w:q.w-p.w,h:p.h}),q.y+=p.h,q.h-=p.h);break}}}catch(t){g=!0,k=t}finally{try{!e&&m.return&&m.return()}finally{if(g)throw k;}}return{w:b,h:d,fill:c/(b*d)||0}}function fg(f,c,a){a=Math.PI/180*(60*a+30);return[f.x+c*Math.cos(a),f.y+c*Math.sin(a)]}function gg(f,c,a){for(var b={},d=[],e=f.length,g=c/2/Math.sin(Math.PI/3),k=1.5*g,h=1,m=0;m<e;++m){var n=f[m].geometry.coordinates;a&&(n=a(n));var p=+n[0],l=+n[1];
if(!isNaN(p)&&!isNaN(l)){n=Math.round(l/=k);var q=Math.round(p=p/c-(n&1)/2),r=l-n;if(1<3*Math.abs(r)){var t=p-q,V=q+(p<q?-1:1)/2,w=n+(l<n?-1:1);p-=V;l-=w;t*t+r*r>p*p+l*l&&(q=V+(n&1?1:-1)/2,n=w)}r=q+"-"+n;(t=b[r])?(t.count+=f[m].count||1,h=Math.max(h,t.count)):(b[r]={center:{x:(q+(n&1)/2)*c,y:n*k},count:f[m].count||1},d.push(b[r]))}}d.max=h;d.r=g;return d}function hg(f){var c,a;this.promise=new f(function(b,d){if(void 0!==c||void 0!==a)throw TypeError("Bad Promise constructor");c=b;a=d});this.resolve=
cb(c);this.reject=cb(a)}function Y(f){this.options=f=f||{};f.colors=f.colors||["rgba(0,192,73,0.99609375)","rgba(242,48,48,0.99609375)","rgba(255,159,25,0.99609375)"];var c=f.colors;this.drawTogether=!0;this.parseColors(c);this.tileSize=256;this.ratio=window.devicePixelRatio;this.cache={};f.getTileUrl&&(this.getTileUrl=f.getTileUrl);this._loadCount={}}function ig(f){var c=f/2,a=f+c,b=new Nc(2*a,2*a),d=b.getContext("2d");d.shadowBlur=c;d.shadowColor="black";d.shadowOffsetX=d.shadowOffsetY=1E4;d.beginPath();
d.arc(a-1E4,a-1E4,f,0,2*Math.PI,!0);d.closePath();d.fill();return b}var qe="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},Ta=function(f){if(void 0==f)throw TypeError("Can't call method on  "+f);return f},jg={}.hasOwnProperty,U=function(f,c){return jg.call(f,c)},kg={}.toString,db=function(f){return kg.call(f).slice(8,-1)},Xc=Object("z").propertyIsEnumerable(0)?Object:function(f){return"String"==db(f)?
f.split(""):Object(f)},Ia=function(f){return Xc(Ta(f))},lg=Math.ceil,mg=Math.floor,Yc=function(f){return isNaN(f=+f)?0:(0<f?mg:lg)(f)},ng=Math.min,jc=function(f){return 0<f?ng(Yc(f),9007199254740991):0},og=Math.max,pg=Math.min,T=K(function(f){f=f.exports={version:"2.6.5"};"number"==typeof __e&&(__e=f)}),M=K(function(f){f=f.exports="undefined"!=typeof window&&Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=f)}),Gb=K(function(f){var c=
M["__core-js_shared__"]||(M["__core-js_shared__"]={});(f.exports=function(a,b){return c[a]||(c[a]=void 0!==b?b:{})})("versions",[]).push({version:T.version,mode:"pure",copyright:"\u00a9 2019 Denis Pushkarev (zloirock.ru)"})}),qg=0,rg=Math.random(),kc=function(f){return"Symbol(".concat(void 0===f?"":f,")_",(++qg+rg).toString(36))},re=Gb("keys"),Zc=function(f){return re[f]||(re[f]=kc(f))},sg=function(f){return function(c,a,b){c=Ia(c);var d=jc(c.length);b=Yc(b);b=0>b?og(b+d,0):pg(b,d);if(f&&a!=a)for(;d>
b;){if(a=c[b++],a!=a)return!0}else for(;d>b;b++)if((f||b in c)&&c[b]===a)return f||b||0;return!f&&-1}}(!1),tg=Zc("IE_PROTO"),se=function(f,c){f=Ia(f);var a=0,b=[],d;for(d in f)d!=tg&&U(f,d)&&b.push(d);for(;c.length>a;)U(f,d=c[a++])&&(~sg(b,d)||b.push(d));return b},lc="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),mb=Object.keys||function(f){return se(f,lc)},cb=function(f){if("function"!=typeof f)throw TypeError(f+" is not a function!");return f},
ia=function(f,c,a){cb(f);if(void 0===c)return f;switch(a){case 1:return function(a){return f.call(c,a)};case 2:return function(a,d){return f.call(c,a,d)};case 3:return function(a,d,e){return f.call(c,a,d,e)}}return function(){return f.apply(c,arguments)}},ma=function(f){return"object"===typeof f?null!==f:"function"===typeof f},oa=function(f){if(!ma(f))throw TypeError(f+" is not an object!");return f},Ua=function(f){try{return!!f()}catch(c){return!0}},za=!Ua(function(){return 7!=Object.defineProperty({},
"a",{get:function(){return 7}}).a}),nb=M.document,mc=ma(nb)&&ma(nb.createElement),te=!za&&!Ua(function(){return 7!=Object.defineProperty(mc?nb.createElement("div"):{},"a",{get:function(){return 7}}).a}),Hb=function(f,c){if(!ma(f))return f;var a,b;if(c&&"function"==typeof(a=f.toString)&&!ma(b=a.call(f))||"function"==typeof(a=f.valueOf)&&!ma(b=a.call(f))||!c&&"function"==typeof(a=f.toString)&&!ma(b=a.call(f)))return b;throw TypeError("Can't convert object to primitive value");},ug=Object.defineProperty,
va={f:za?Object.defineProperty:function(f,c,a){oa(f);c=Hb(c,!0);oa(a);if(te)try{return ug(f,c,a)}catch(b){}if("get"in a||"set"in a)throw TypeError("Accessors not supported!");"value"in a&&(f[c]=a.value);return f}},Va=function(f,c){return{enumerable:!(f&1),configurable:!(f&2),writable:!(f&4),value:c}},Pa=za?function(f,c,a){return va.f(f,c,Va(1,a))}:function(f,c,a){f[c]=a;return f},na=function(f,c,a){var b=f&na.F,d=f&na.G,e=f&na.S,g=f&na.P,k=f&na.B,h=f&na.W,m=d?T:T[c]||(T[c]={}),n=m.prototype;e=d?M:
e?M[c]:(M[c]||{}).prototype;var p;d&&(a=c);for(p in a)if(c=!b&&e&&void 0!==e[p],!c||!U(m,p)){var l=c?e[p]:a[p];m[p]=d&&"function"!=typeof e[p]?a[p]:k&&c?ia(l,M):h&&e[p]==l?function(a){var b=function(b,d,c){if(this instanceof a){switch(arguments.length){case 0:return new a;case 1:return new a(b);case 2:return new a(b,d)}return new a(b,d,c)}return a.apply(this,arguments)};b.prototype=a.prototype;return b}(l):g&&"function"==typeof l?ia(Function.call,l):l;g&&((m.virtual||(m.virtual={}))[p]=l,f&na.R&&
n&&!n[p]&&Pa(n,p,l))}};na.F=1;na.G=2;na.S=4;na.P=8;na.B=16;na.W=32;na.U=64;na.R=128;var C=na,nc=function(f,c){var a=(T.Object||{})[f]||Object[f],b={};b[f]=c(a);C(C.S+C.F*Ua(function(){a(1)}),"Object",b)};nc("keys",function(){return function(f){return mb(Object(Ta(f)))}});var vg=T.Object.keys,wg=K(function(f){f.exports={"default":vg,__esModule:!0}}),Ba=N(wg),$c=Object.getOwnPropertySymbols,oc={}.propertyIsEnumerable,pc=Object.assign,xg=!pc||Ua(function(){var f={},c={},a=Symbol();f[a]=7;"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=
a});return 7!=pc({},f)[a]||"abcdefghijklmnopqrst"!=Object.keys(pc({},c)).join("")})?function(f,c){for(var a=Object(Ta(f)),b=arguments.length,d=1,e=$c,g=oc;b>d;)for(var k=Xc(arguments[d++]),h=e?mb(k).concat(e(k)):mb(k),m=h.length,n=0,p;m>n;)g.call(k,p=h[n++])&&(a[p]=k[p]);return a}:pc;C(C.S+C.F,"Object",{assign:xg});var yg=T.Object.assign,zg=K(function(f){f.exports={"default":yg,__esModule:!0}}),W=N(zg),ue=Zc("IE_PROTO"),Ag=Object.prototype,ve=Object.getPrototypeOf||function(f){f=Object(Ta(f));return U(f,
ue)?f[ue]:"function"==typeof f.constructor&&f instanceof f.constructor?f.constructor.prototype:f instanceof Object?Ag:null};nc("getPrototypeOf",function(){return function(f){return ve(Object(Ta(f)))}});var Bg=T.Object.getPrototypeOf,Ib=K(function(f){f.exports={"default":Bg,__esModule:!0}}),L=N(Ib),Cg=K(function(f,c){c.__esModule=!0;c.default=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}}),F=N(Cg);C(C.S+C.F*!za,"Object",{defineProperty:va.f});var Dg=
T.Object,Eg=function(f,c,a){return Dg.defineProperty(f,c,a)},Qa=K(function(f){f.exports={"default":Eg,__esModule:!0}}),ba=N(Qa),Fg=K(function(f,c){c.__esModule=!0;var a=Qa&&Qa.__esModule?Qa:{default:Qa};c.default=function(){function b(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);(0,a.default)(b,e.key,e)}}return function(a,c,g){c&&b(a.prototype,c);g&&b(a,g);return a}}()}),J=N(Fg),Ja={},Gg=za?Object.defineProperties:function(f,
c){oa(f);for(var a=mb(c),b=a.length,d=0,e;b>d;)va.f(f,e=a[d++],c[e]);return f},we=M.document,ad=we&&we.documentElement,Hg=Zc("IE_PROTO"),bd=function(){},qc=function(){var f=mc?nb.createElement("iframe"):{},c=lc.length;f.style.display="none";ad.appendChild(f);f.src="javascript:";f=f.contentWindow.document;f.open();f.write("<script>document.F=Object\x3c/script>");f.close();for(qc=f.F;c--;)delete qc.prototype[lc[c]];return qc()},Wa=Object.create||function(f,c){if(null!==f){bd.prototype=oa(f);var a=new bd;
bd.prototype=null;a[Hg]=f}else a=qc();return void 0===c?a:Gg(a,c)},fa=K(function(f){var c=Gb("wks"),a=M.Symbol,b="function"==typeof a;(f.exports=function(d){return c[d]||(c[d]=b&&a[d]||(b?a:kc)("Symbol."+d))}).store=c}),Ig=va.f,xe=fa("toStringTag"),eb=function(f,c,a){f&&!U(f=a?f:f.prototype,xe)&&Ig(f,xe,{configurable:!0,value:c})},ye={};Pa(ye,fa("iterator"),function(){return this});var Jg=function(f,c,a){f.prototype=Wa(ye,{next:Va(1,a)});eb(f,c+" Iterator")},cd=fa("iterator"),dd=!([].keys&&"next"in
[].keys()),Kg=function(){return this},ed=function(f,c,a,b,d,e,g){Jg(a,c,b);b=function(b){return!dd&&b in n?n[b]:function(){return new a(this,b)}};var k=c+" Iterator",h="values"==d,m=!1,n=f.prototype,p=n[cd]||n["@@iterator"]||d&&n[d],l=p||b(d),q=d?h?b("entries"):l:void 0,r="Array"==c?n.entries||p:p,t;r&&(f=ve(r.call(new f)),f!==Object.prototype&&f.next&&eb(f,k,!0));h&&p&&"values"!==p.name&&(m=!0,l=function(){return p.call(this)});g&&(dd||m||!n[cd])&&Pa(n,cd,l);Ja[c]=l;Ja[k]=Kg;if(d){var V={values:h?
l:b("values"),keys:e?l:b("keys"),entries:q};if(g)for(t in V)t in n||Pa(n,t,V[t]);else C(C.P+C.F*(dd||m),c,V)}return V},Lg=function(f){return function(c,a){c=String(Ta(c));a=Yc(a);var b=c.length,d;if(0>a||a>=b)return f?"":void 0;var e=c.charCodeAt(a);return 55296>e||56319<e||a+1===b||56320>(d=c.charCodeAt(a+1))||57343<d?f?c.charAt(a):e:f?c.slice(a,a+2):(e-55296<<10)+(d-56320)+65536}}(!0);ed(String,"String",function(f){this._t=String(f);this._i=0},function(){var f=this._t,c=this._i;if(c>=f.length)return{value:void 0,
done:!0};f=Lg(f,c);this._i+=f.length;return{value:f,done:!1}});var Xa=function(f,c){return{value:c,done:!!f}};ed(Array,"Array",function(f,c){this._t=Ia(f);this._i=0;this._k=c},function(){var f=this._t,c=this._k,a=this._i++;return!f||a>=f.length?(this._t=void 0,Xa(1)):"keys"==c?Xa(0,a):"values"==c?Xa(0,f[a]):Xa(0,[a,f[a]])},"values");Ja.Arguments=Ja.Array;for(var ze=fa("toStringTag"),Ae="CSSRuleList CSSStyleDeclaration CSSValueList ClientRectList DOMRectList DOMStringList DOMTokenList DataTransferItemList FileList HTMLAllCollection HTMLCollection HTMLFormElement HTMLSelectElement MediaList MimeTypeArray NamedNodeMap NodeList PaintRequestList Plugin PluginArray SVGLengthList SVGNumberList SVGPathSegList SVGPointList SVGStringList SVGTransformList SourceBufferList StyleSheetList TextTrackCueList TextTrackList TouchList".split(" "),
fd=0;fd<Ae.length;fd++){var gd=Ae[fd],Be=M[gd],hd=Be&&Be.prototype;hd&&!hd[ze]&&Pa(hd,ze,gd);Ja[gd]=Ja.Array}var rc={f:fa},Mg=rc.f("iterator"),Jb=K(function(f){f.exports={"default":Mg,__esModule:!0}});N(Jb);var sc=K(function(f){var c=kc("meta"),a=va.f,b=0,d=Object.isExtensible||function(){return!0},e=!Ua(function(){return d(Object.preventExtensions({}))}),g=function(d){a(d,c,{value:{i:"O"+ ++b,w:{}}})},k=f.exports={KEY:c,NEED:!1,fastKey:function(a,b){if(!ma(a))return"symbol"==typeof a?a:("string"==
typeof a?"S":"P")+a;if(!U(a,c)){if(!d(a))return"F";if(!b)return"E";g(a)}return a[c].i},getWeak:function(a,b){if(!U(a,c)){if(!d(a))return!0;if(!b)return!1;g(a)}return a[c].w},onFreeze:function(a){e&&k.NEED&&d(a)&&!U(a,c)&&g(a);return a}}}),Ng=va.f,id=function(f){var c=T.Symbol||(T.Symbol={});"_"==f.charAt(0)||f in c||Ng(c,f,{value:rc.f(f)})},jd=Array.isArray||function(f){return"Array"==db(f)},Og=lc.concat("length","prototype"),Ce=Object.getOwnPropertyNames||function(f){return se(f,Og)},De=Ce,Pg={}.toString,
Ee="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Fe=function(f){if(Ee&&"[object Window]"==Pg.call(f))try{var c=De(f)}catch(a){c=Ee.slice()}else c=De(Ia(f));return c},Ge=Object.getOwnPropertyDescriptor,tc={f:za?Ge:function(f,c){f=Ia(f);c=Hb(c,!0);if(te)try{return Ge(f,c)}catch(a){}if(U(f,c))return Va(!oc.call(f,c),f[c])}},Qg=sc.KEY,He=tc.f,fb=va.f,Ie=Fe,qa=M.Symbol,uc=M.JSON,vc=uc&&uc.stringify,ra=fa("_hidden"),Je=fa("toPrimitive"),Rg={}.propertyIsEnumerable,
Kb=Gb("symbol-registry"),Ra=Gb("symbols"),Lb=Gb("op-symbols"),Ca=Object.prototype,ob="function"==typeof qa,kd=M.QObject,ld=!kd||!kd.prototype||!kd.prototype.findChild,md=za&&Ua(function(){return 7!=Wa(fb({},"a",{get:function(){return fb(this,"a",{value:7}).a}})).a})?function(f,c,a){var b=He(Ca,c);b&&delete Ca[c];fb(f,c,a);b&&f!==Ca&&fb(Ca,c,b)}:fb,Ke=function(f){var c=Ra[f]=Wa(qa.prototype);c._k=f;return c},nd=ob&&"symbol"==typeof qa.iterator?function(f){return"symbol"==typeof f}:function(f){return f instanceof
qa},wc=function(f,c,a){f===Ca&&wc(Lb,c,a);oa(f);c=Hb(c,!0);oa(a);return U(Ra,c)?(a.enumerable?(U(f,ra)&&f[ra][c]&&(f[ra][c]=!1),a=Wa(a,{enumerable:Va(0,!1)})):(U(f,ra)||fb(f,ra,Va(1,{})),f[ra][c]=!0),md(f,c,a)):fb(f,c,a)},Le=function(f,c){oa(f);var a=c=Ia(c),b=mb(a),d=$c;if(d){d=d(a);for(var e=oc,g=0,k;d.length>g;)e.call(a,k=d[g++])&&b.push(k)}a=0;k=b.length;for(var h;k>a;)wc(f,h=b[a++],c[h]);return f},Sg=function(f){var c=Rg.call(this,f=Hb(f,!0));return this===Ca&&U(Ra,f)&&!U(Lb,f)?!1:c||!U(this,
f)||!U(Ra,f)||U(this,ra)&&this[ra][f]?c:!0},Me=function(f,c){f=Ia(f);c=Hb(c,!0);if(f!==Ca||!U(Ra,c)||U(Lb,c)){var a=He(f,c);!a||!U(Ra,c)||U(f,ra)&&f[ra][c]||(a.enumerable=!0);return a}},Ne=function(f){f=Ie(Ia(f));for(var c=[],a=0,b;f.length>a;)U(Ra,b=f[a++])||b==ra||b==Qg||c.push(b);return c},Oe=function(f){var c=f===Ca;f=Ie(c?Lb:Ia(f));for(var a=[],b=0,d;f.length>b;)U(Ra,d=f[b++])&&(c?U(Ca,d):1)&&a.push(Ra[d]);return a};ob||(qa=function(){if(this instanceof qa)throw TypeError("Symbol is not a constructor!");
var f=kc(0<arguments.length?arguments[0]:void 0),c=function(a){this===Ca&&c.call(Lb,a);U(this,ra)&&U(this[ra],f)&&(this[ra][f]=!1);md(this,f,Va(1,a))};za&&ld&&md(Ca,f,{configurable:!0,set:c});return Ke(f)},Pa(qa.prototype,"toString",function(){return this._k}),tc.f=Me,va.f=wc,Ce=Fe=Ne,oc=Sg,$c=Oe,rc.f=function(f){return Ke(fa(f))});C(C.G+C.W+C.F*!ob,{Symbol:qa});for(var Pe="hasInstance isConcatSpreadable iterator match replace search species split toPrimitive toStringTag unscopables".split(" "),Qe=
0;Pe.length>Qe;)fa(Pe[Qe++]);for(var Re=mb(fa.store),Se=0;Re.length>Se;)id(Re[Se++]);C(C.S+C.F*!ob,"Symbol",{"for":function(f){return U(Kb,f+="")?Kb[f]:Kb[f]=qa(f)},keyFor:function(f){if(!nd(f))throw TypeError(f+" is not a symbol!");for(var c in Kb)if(Kb[c]===f)return c},useSetter:function(){ld=!0},useSimple:function(){ld=!1}});C(C.S+C.F*!ob,"Object",{create:function(f,c){return void 0===c?Wa(f):Le(Wa(f),c)},defineProperty:wc,defineProperties:Le,getOwnPropertyDescriptor:Me,getOwnPropertyNames:Ne,
getOwnPropertySymbols:Oe});uc&&C(C.S+C.F*(!ob||Ua(function(){var f=qa();return"[null]"!=vc([f])||"{}"!=vc({a:f})||"{}"!=vc(Object(f))})),"JSON",{stringify:function(f){for(var c=[f],a=1,b;arguments.length>a;)c.push(arguments[a++]);b=a=c[1];if((ma(a)||void 0!==f)&&!nd(f))return jd(a)||(a=function(a,c){"function"==typeof b&&(c=b.call(this,a,c));if(!nd(c))return c}),c[1]=a,vc.apply(uc,c)}});qa.prototype[Je]||Pa(qa.prototype,Je,qa.prototype.valueOf);eb(qa,"Symbol");eb(Math,"Math",!0);eb(M.JSON,"JSON",
!0);id("asyncIterator");id("observable");var Tg=T.Symbol,Mb=K(function(f){f.exports={"default":Tg,__esModule:!0}}),Te=N(Mb),pb=K(function(f,c){c.__esModule=!0;f=Jb&&Jb.__esModule?Jb:{default:Jb};var a=Mb&&Mb.__esModule?Mb:{default:Mb},b="function"===typeof a.default&&"symbol"===typeof f.default?function(a){return typeof a}:function(b){return b&&"function"===typeof a.default&&b.constructor===a.default&&b!==a.default.prototype?"symbol":typeof b};c.default="function"===typeof a.default&&"symbol"===b(f.default)?
function(a){return"undefined"===typeof a?"undefined":b(a)}:function(d){return d&&"function"===typeof a.default&&d.constructor===a.default&&d!==a.default.prototype?"symbol":"undefined"===typeof d?"undefined":b(d)}}),bc=N(pb),Ug=K(function(f,c){c.__esModule=!0;var a=pb&&pb.__esModule?pb:{default:pb};c.default=function(b,d){if(!b)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!d||"object"!==("undefined"===typeof d?"undefined":(0,a.default)(d))&&"function"!==
typeof d?b:d}}),O=N(Ug),Vg=tc.f;nc("getOwnPropertyDescriptor",function(){return function(f,c){return Vg(Ia(f),c)}});var Wg=T.Object,Xg=function(f,c){return Wg.getOwnPropertyDescriptor(f,c)},Nb=K(function(f){f.exports={"default":Xg,__esModule:!0}}),Z=N(Nb),Yg=K(function(f,c){c.__esModule=!0;var a=Ib&&Ib.__esModule?Ib:{default:Ib},b=Nb&&Nb.__esModule?Nb:{default:Nb};c.default=function h(c,g,k){null===c&&(c=Function.prototype);var e=(0,b.default)(c,g);if(void 0===e){if(c=(0,a.default)(c),null!==c)return h(c,
g,k)}else{if("value"in e)return e.value;g=e.get;return void 0===g?void 0:g.call(k)}}}),Ya=N(Yg),Zg=Object.setPrototypeOf||("__proto__"in{}?function(f,c,a){try{a=ia(Function.call,tc.f(Object.prototype,"__proto__").set,2),a(f,[]),c=!(f instanceof Array)}catch(b){c=!0}return function(b,d){oa(b);if(!ma(d)&&null!==d)throw TypeError(d+": can't set as prototype!");c?b.__proto__=d:a(b,d);return b}}({},!1):void 0);C(C.S,"Object",{setPrototypeOf:Zg});var $g=T.Object.setPrototypeOf,Ue=K(function(f){f.exports=
{"default":$g,__esModule:!0}});N(Ue);C(C.S,"Object",{create:Wa});var ah=T.Object,bh=function(f,c){return ah.create(f,c)},Ve=K(function(f){f.exports={"default":bh,__esModule:!0}}),ch=N(Ve),dh=K(function(f,c){function a(a){return a&&a.__esModule?a:{default:a}}c.__esModule=!0;var b=a(Ue),d=a(Ve),e=a(pb);c.default=function(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof c?"undefined":(0,e.default)(c)));a.prototype=
(0,d.default)(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(b.default?(0,b.default)(a,c):a.__proto__=c)}}),P=N(dh),eh=fa("toStringTag"),fh="Arguments"==db(function(){return arguments}()),xc=function(f){var c;if(void 0===f)var a="Undefined";else{if(null===f)var b="Null";else{a:{var d=f=Object(f);try{b=d[eh];break a}catch(e){}b=void 0}b="string"==typeof(a=b)?a:fh?db(f):"Object"==(c=db(f))&&"function"==typeof f.callee?"Arguments":c}a=b}return a},gh=fa("iterator"),
hh=T.isIterable=function(f){f=Object(f);return void 0!==f[gh]||"@@iterator"in f||Ja.hasOwnProperty(xc(f))},Ob=K(function(f){f.exports={"default":hh,__esModule:!0}});N(Ob);var ih=fa("iterator"),od=T.getIteratorMethod=function(f){if(void 0!=f)return f[ih]||f["@@iterator"]||Ja[xc(f)]},jh=T.getIterator=function(f){var c=od(f);if("function"!=typeof c)throw TypeError(f+" is not iterable!");return oa(c.call(f))},Pb=K(function(f){f.exports={"default":jh,__esModule:!0}}),Wc=N(Pb),kh=K(function(f,c){c.__esModule=
!0;var a=Ob&&Ob.__esModule?Ob:{default:Ob},b=Pb&&Pb.__esModule?Pb:{default:Pb};c.default=function(){return function(d,c){if(Array.isArray(d))return d;if((0,a.default)(Object(d))){var g=[],e=!0,h=!1,f=void 0;try{for(var n=(0,b.default)(d),p;!(e=(p=n.next()).done)&&(g.push(p.value),!c||g.length!==c);e=!0);}catch(l){h=!0,f=l}finally{try{if(!e&&n["return"])n["return"]()}finally{if(h)throw f;}}return g}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}()}),gb=N(kh),We=function(f,
c,a,b){try{return b?c(oa(a)[0],a[1]):c(a)}catch(d){throw c=f["return"],void 0!==c&&oa(c.call(f)),d;}},Xe=fa("iterator"),Ye=Array.prototype,pd=fa("iterator"),Ze=!1;try{[7][pd]()["return"]=function(){Ze=!0}}catch(f){}var $e=function(f,c){if(!c&&!Ze)return!1;var a=!1;try{c=[7];var b=c[pd]();b.next=function(){return{done:a=!0}};c[pd]=function(){return b};f(c)}catch(d){}return a};C(C.S+C.F*!$e(function(f){}),"Array",{from:function(f){var c=Object(Ta(f)),a="function"==typeof this?this:Array,b=arguments.length,
d=1<b?arguments[1]:void 0,e=void 0!==d,g=0,k=od(c),h;e&&(d=ia(d,2<b?arguments[2]:void 0,2));if(void 0!=k&&(a!=Array||void 0===k||Ja.Array!==k&&Ye[Xe]!==k))for(c=k.call(c),a=new a;!(h=c.next()).done;g++)b=a,k=g,h=e?We(c,d,[h.value,g],!0):h.value,k in b?va.f(b,k,Va(0,h)):b[k]=h;else for(b=jc(c.length),a=new a(b);b>g;g++){k=a;h=g;var m=e?d(c[g],g):c[g];h in k?va.f(k,h,Va(0,m)):k[h]=m}a.length=g;return a}});var lh=T.Array.from,Qb=K(function(f){f.exports={"default":lh,__esModule:!0}}),mh=N(Qb),nh=K(function(f,
c){c.__esModule=!0;var a=Qb&&Qb.__esModule?Qb:{default:Qb};c.default=function(b){if(Array.isArray(b)){for(var d=0,c=Array(b.length);d<b.length;d++)c[d]=b[d];return c}return(0,a.default)(b)}}),aa=N(nh),oh=sc.onFreeze;nc("freeze",function(f){return function(c){return f&&ma(c)?f(oh(c)):c}});var ph=T.Object.freeze,qh=K(function(f){f.exports={"default":ph,__esModule:!0}}),Nd=N(qh),af=T.JSON||(T.JSON={stringify:JSON.stringify}),rh=function(f){return af.stringify.apply(af,arguments)},sh=K(function(f){f.exports=
{"default":rh,__esModule:!0}}),Uf=N(sh),Da={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,
0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,
105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,
252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,
0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,
69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],
silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Rb=K(function(f){var c=Array.prototype.concat,a=Array.prototype.slice,b=f.exports=function(b){for(var d=
[],g=0,k=b.length;g<k;g++){var h=b[g];var f=(f=h)&&"string"!==typeof f?f instanceof Array||Array.isArray(f)||0<=f.length&&(f.splice instanceof Function||Z(f,f.length-1)&&"String"!==f.constructor.name):!1;f?d=c.call(d,a.call(h)):d.push(h)}return d};b.wrap=function(a){return function(){return a(b(arguments))}}}),yb=K(function(f){function c(a,b,d){return Math.min(Math.max(b,a),d)}function a(a){a=a.toString(16).toUpperCase();return 2>a.length?"0"+a:a}var b={},d;for(d in Da)Da.hasOwnProperty(d)&&(b[Da[d]]=
d);var e=f.exports={to:{},get:{}};e.get=function(a){switch(a.substring(0,3).toLowerCase()){case "hsl":a=e.get.hsl(a);var b="hsl";break;case "hwb":a=e.get.hwb(a);b="hwb";break;default:a=e.get.rgb(a),b="rgb"}return a?{model:b,value:a}:null};e.get.rgb=function(a){if(!a)return null;var b=/^#([a-f0-9]{3,4})$/i,d=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,g=/^rgba?\(\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,
e=/(\D+)/,f=[0,0,0,1],l;if(l=a.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){b=l[2];l=l[1];for(a=0;3>a;a++)d=2*a,f[a]=parseInt(l.slice(d,d+2),16);b&&(f[3]=Math.round(parseInt(b,16)/255*100)/100)}else if(l=a.match(b)){l=l[1];b=l[3];for(a=0;3>a;a++)f[a]=parseInt(l[a]+l[a],16);b&&(f[3]=Math.round(parseInt(b+b,16)/255*100)/100)}else if(l=a.match(d)){for(a=0;3>a;a++)f[a]=parseInt(l[a+1],0);l[4]&&(f[3]=parseFloat(l[4]))}else if(l=a.match(g)){for(a=0;3>a;a++)f[a]=Math.round(2.55*parseFloat(l[a+1]));l[4]&&(f[3]=
parseFloat(l[4]))}else{if(l=a.match(e)){if("transparent"===l[1])return[0,0,0,0];f=Da[l[1]];if(!f)return null;f[3]=1;return f}return null}for(a=0;3>a;a++)f[a]=c(f[a],0,255);f[3]=c(f[3],0,1);return f};e.get.hsl=function(a){if(!a)return null;var b=a.match(/^hsla?\(\s*([+-]?(?:\d*\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(b){var d=parseFloat(b[4]);a=(parseFloat(b[1])+360)%360;var g=c(parseFloat(b[2]),0,100);b=c(parseFloat(b[3]),0,100);d=c(isNaN(d)?
1:d,0,1);return[a,g,b,d]}return null};e.get.hwb=function(a){if(!a)return null;var b=a.match(/^hwb\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(b){var d=parseFloat(b[4]);a=(parseFloat(b[1])%360+360)%360;var g=c(parseFloat(b[2]),0,100);b=c(parseFloat(b[3]),0,100);d=c(isNaN(d)?1:d,0,1);return[a,g,b,d]}return null};e.to.hex=function(){var b=Rb(arguments);return"#"+a(b[0])+a(b[1])+a(b[2])+(1>b[3]?a(Math.round(255*b[3])):"")};e.to.rgb=function(){var a=
Rb(arguments);return 4>a.length||1===a[3]?"rgb("+Math.round(a[0])+", "+Math.round(a[1])+", "+Math.round(a[2])+")":"rgba("+Math.round(a[0])+", "+Math.round(a[1])+", "+Math.round(a[2])+", "+a[3]+")"};e.to.rgb.percent=function(){var a=Rb(arguments),b=Math.round(a[0]/255*100),d=Math.round(a[1]/255*100),c=Math.round(a[2]/255*100);return 4>a.length||1===a[3]?"rgb("+b+"%, "+d+"%, "+c+"%)":"rgba("+b+"%, "+d+"%, "+c+"%, "+a[3]+")"};e.to.hsl=function(){var a=Rb(arguments);return 4>a.length||1===a[3]?"hsl("+
a[0]+", "+a[1]+"%, "+a[2]+"%)":"hsla("+a[0]+", "+a[1]+"%, "+a[2]+"%, "+a[3]+")"};e.to.hwb=function(){var a=Rb(arguments),b="";4<=a.length&&1!==a[3]&&(b=", "+a[3]);return"hwb("+a[0]+", "+a[1]+"%, "+a[2]+"%"+b+")"};e.to.keyword=function(a){return b[a.slice(0,3)]}}),hb=K(function(f){var c={};for(d in Da)Da.hasOwnProperty(d)&&(c[Da[d]]=d);var a=f.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},
xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}},b;for(b in a)if(a.hasOwnProperty(b)){if(!("channels"in a[b]))throw Error("missing channels property: "+b);if(!("labels"in a[b]))throw Error("missing channel labels property: "+
b);if(a[b].labels.length!==a[b].channels)throw Error("channel and label counts mismatch: "+b);f=a[b].channels;var d=a[b].labels;delete a[b].channels;delete a[b].labels;Object.defineProperty(a[b],"channels",{value:f});Object.defineProperty(a[b],"labels",{value:d})}a.rgb.hsl=function(a){var b=a[0]/255,d=a[1]/255,c=a[2]/255;a=Math.min(b,d,c);var e=Math.max(b,d,c),f=e-a,p;e===a?p=0:b===e?p=(d-c)/f:d===e?p=2+(c-b)/f:c===e&&(p=4+(b-d)/f);p=Math.min(60*p,360);0>p&&(p+=360);b=(a+e)/2;return[p,100*(e===a?
0:.5>=b?f/(e+a):f/(2-e-a)),100*b]};a.rgb.hsv=function(a){var b,d=a[0]/255,c=a[1]/255,e=a[2]/255,f=Math.max(d,c,e);var p=f-Math.min(d,c,e);if(0===p)var l=b=0;else{b=p/f;a=(f-d)/6/p+.5;var q=(f-c)/6/p+.5;p=(f-e)/6/p+.5;d===f?l=p-q:c===f?l=1/3+a-p:e===f&&(l=2/3+q-a);0>l?l+=1:1<l&&--l}return[360*l,100*b,100*f]};a.rgb.hwb=function(b){var d=b[0],c=b[1],h=b[2];b=a.rgb.hsl(b)[0];var e=1/255*Math.min(d,Math.min(c,h));h=1-1/255*Math.max(d,Math.max(c,h));return[b,100*e,100*h]};a.rgb.cmyk=function(a){var b=a[0]/
255,d=a[1]/255;a=a[2]/255;var c=Math.min(1-b,1-d,1-a);return[100*((1-b-c)/(1-c)||0),100*((1-d-c)/(1-c)||0),100*((1-a-c)/(1-c)||0),100*c]};a.rgb.keyword=function(a){var b=c[a];if(b)return b;b=Infinity;var d;for(d in Da)if(Da.hasOwnProperty(d)){var h=Da[d];h=Math.pow(a[0]-h[0],2)+Math.pow(a[1]-h[1],2)+Math.pow(a[2]-h[2],2);if(h<b){b=h;var e=d}}return e};a.keyword.rgb=function(a){return Da[a]};a.rgb.xyz=function(a){var b=a[0]/255,d=a[1]/255;a=a[2]/255;b=.04045<b?Math.pow((b+.055)/1.055,2.4):b/12.92;
d=.04045<d?Math.pow((d+.055)/1.055,2.4):d/12.92;a=.04045<a?Math.pow((a+.055)/1.055,2.4):a/12.92;return[100*(.4124*b+.3576*d+.1805*a),100*(.2126*b+.7152*d+.0722*a),100*(.0193*b+.1192*d+.9505*a)]};a.rgb.lab=function(b){var d=a.rgb.xyz(b);b=d[0];var c=d[1];d=d[2];b/=95.047;c/=100;d/=108.883;b=.008856<b?Math.pow(b,1/3):7.787*b+16/116;c=.008856<c?Math.pow(c,1/3):7.787*c+16/116;d=.008856<d?Math.pow(d,1/3):7.787*d+16/116;return[116*c-16,500*(b-c),200*(c-d)]};a.hsl.rgb=function(a){var b=a[0]/360,d=a[1]/100;
a=a[2]/100;if(0===d){var c=255*a;return[c,c,c]}d=.5>a?a*(1+d):a+d-a*d;a=2*a-d;var e=[0,0,0];for(var f=0;3>f;f++)c=b+1/3*-(f-1),0>c&&c++,1<c&&c--,c=1>6*c?a+6*(d-a)*c:1>2*c?d:2>3*c?a+(d-a)*(2/3-c)*6:a,e[f]=255*c;return e};a.hsl.hsv=function(a){var b=a[0],d=a[1]/100;a=a[2]/100;var c=d,e=Math.max(a,.01);a*=2;d*=1>=a?a:2-a;c*=1>=e?e:2-e;return[b,100*(0===a?2*c/(e+c):2*d/(a+d)),(a+d)/2*100]};a.hsv.rgb=function(a){var b=a[0]/60,d=a[1]/100;a=a[2]/100;var c=Math.floor(b)%6,e=b-Math.floor(b);b=255*a*(1-d);
var f=255*a*(1-d*e);d=255*a*(1-d*(1-e));a*=255;switch(c){case 0:return[a,d,b];case 1:return[f,a,b];case 2:return[b,a,d];case 3:return[b,f,a];case 4:return[d,b,a];case 5:return[a,b,f]}};a.hsv.hsl=function(a){var b=a[0],d=a[1]/100;a=a[2]/100;var c=Math.max(a,.01);var e=(2-d)*c;c=d*c/(1>=e?e:2-e)||0;return[b,100*c,(2-d)*a/2*100]};a.hwb.rgb=function(a){var b=a[0]/360,d=a[1]/100;a=a[2]/100;var c=d+a;1<c&&(d/=c,a/=c);c=Math.floor(6*b);a=1-a;b=6*b-c;0!==(c&1)&&(b=1-b);b=d+b*(a-d);switch(c){default:case 6:case 0:c=
a;var e=b;break;case 1:c=b;e=a;break;case 2:c=d;e=a;d=b;break;case 3:c=d;e=b;d=a;break;case 4:c=b;e=d;d=a;break;case 5:c=a,e=d,d=b}return[255*c,255*e,255*d]};a.cmyk.rgb=function(a){var b=a[3]/100;return[255*(1-Math.min(1,a[0]/100*(1-b)+b)),255*(1-Math.min(1,a[1]/100*(1-b)+b)),255*(1-Math.min(1,a[2]/100*(1-b)+b))]};a.xyz.rgb=function(a){var b=a[0]/100,d=a[1]/100,c=a[2]/100;a=3.2406*b+-1.5372*d+-.4986*c;var e=-.9689*b+1.8758*d+.0415*c;b=.0557*b+-.204*d+1.057*c;a=.0031308<a?1.055*Math.pow(a,1/2.4)-.055:
12.92*a;e=.0031308<e?1.055*Math.pow(e,1/2.4)-.055:12.92*e;b=.0031308<b?1.055*Math.pow(b,1/2.4)-.055:12.92*b;a=Math.min(Math.max(0,a),1);e=Math.min(Math.max(0,e),1);b=Math.min(Math.max(0,b),1);return[255*a,255*e,255*b]};a.xyz.lab=function(a){var b=a[0],d=a[1];a=a[2];b/=95.047;d/=100;a/=108.883;b=.008856<b?Math.pow(b,1/3):7.787*b+16/116;d=.008856<d?Math.pow(d,1/3):7.787*d+16/116;a=.008856<a?Math.pow(a,1/3):7.787*a+16/116;return[116*d-16,500*(b-d),200*(d-a)]};a.lab.xyz=function(a){var b=a[1],d=a[2];
a=(a[0]+16)/116;b=b/500+a;d=a-d/200;var c=Math.pow(a,3),f=Math.pow(b,3),e=Math.pow(d,3);return[95.047*(.008856<f?f:(b-16/116)/7.787),100*(.008856<c?c:(a-16/116)/7.787),108.883*(.008856<e?e:(d-16/116)/7.787)]};a.lab.lch=function(a){var b=a[0],d=a[1];a=a[2];var c=360*Math.atan2(a,d)/2/Math.PI;0>c&&(c+=360);return[b,Math.sqrt(d*d+a*a),c]};a.lch.lab=function(a){var b=a[0],d=a[1];a=a[2]/360*2*Math.PI;return[b,d*Math.cos(a),d*Math.sin(a)]};a.rgb.ansi16=function(b){var d=b[0],c=b[1],h=b[2],f=1 in arguments?
arguments[1]:a.rgb.hsv(b)[2];f=Math.round(f/50);if(0===f)return 30;d=30+(Math.round(h/255)<<2|Math.round(c/255)<<1|Math.round(d/255));2===f&&(d+=60);return d};a.hsv.ansi16=function(b){return a.rgb.ansi16(a.hsv.rgb(b),b[2])};a.rgb.ansi256=function(a){var b=a[0],d=a[1];a=a[2];return b===d&&d===a?8>b?16:248<b?231:Math.round((b-8)/247*24)+232:16+36*Math.round(b/255*5)+6*Math.round(d/255*5)+Math.round(a/255*5)};a.ansi16.rgb=function(a){var b=a%10;if(0===b||7===b)return 50<a&&(b+=3.5),b=b/10.5*255,[b,b,
b];a=.5*(~~(50<a)+1);return[(b&1)*a*255,(b>>1&1)*a*255,(b>>2&1)*a*255]};a.ansi256.rgb=function(a){if(232<=a){var b=10*(a-232)+8;return[b,b,b]}a-=16;b=Math.floor(a/36)/5*255;var d=Math.floor((a%=36)/6)/5*255;return[b,d,a%6/5*255]};a.rgb.hex=function(a){a=(((Math.round(a[0])&255)<<16)+((Math.round(a[1])&255)<<8)+(Math.round(a[2])&255)).toString(16).toUpperCase();return"000000".substring(a.length)+a};a.hex.rgb=function(a){a=a.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!a)return[0,0,0];var b=a[0];
3===a[0].length&&(b=b.split("").map(function(a){return a+a}).join(""));a=parseInt(b,16);return[a>>16&255,a>>8&255,a&255]};a.rgb.hcg=function(a){var b=a[0]/255,d=a[1]/255;a=a[2]/255;var c=Math.max(Math.max(b,d),a),f=Math.min(Math.min(b,d),a),e=c-f;return[(0>=e?0:c===b?(d-a)/e%6:c===d?2+(a-b)/e:(b-d)/e+8)/6%1*360,100*e,100*(1>e?f/(1-e):0)]};a.hsl.hcg=function(a){var b=a[1]/100,d=a[2]/100,c=0;b=.5>d?2*b*d:2*b*(1-d);1>b&&(c=(d-.5*b)/(1-b));return[a[0],100*b,100*c]};a.hsv.hcg=function(a){var b=a[2]/100,
d=a[1]/100*b,c=0;1>d&&(c=(b-d)/(1-d));return[a[0],100*d,100*c]};a.hcg.rgb=function(a){var b=a[1]/100,d=a[2]/100;if(0===b)return[255*d,255*d,255*d];var c=[0,0,0];a=a[0]/360%1*6;var f=a%1,e=1-f;switch(Math.floor(a)){case 0:c[0]=1;c[1]=f;c[2]=0;break;case 1:c[0]=e;c[1]=1;c[2]=0;break;case 2:c[0]=0;c[1]=1;c[2]=f;break;case 3:c[0]=0;c[1]=e;c[2]=1;break;case 4:c[0]=f;c[1]=0;c[2]=1;break;default:c[0]=1,c[1]=0,c[2]=e}d*=1-b;return[255*(b*c[0]+d),255*(b*c[1]+d),255*(b*c[2]+d)]};a.hcg.hsv=function(a){var b=
a[1]/100,d=b+a[2]/100*(1-b),c=0;0<d&&(c=b/d);return[a[0],100*c,100*d]};a.hcg.hsl=function(a){var b=a[1]/100,d=a[2]/100*(1-b)+.5*b,c=0;0<d&&.5>d?c=b/(2*d):.5<=d&&1>d&&(c=b/(2*(1-d)));return[a[0],100*c,100*d]};a.hcg.hwb=function(a){var b=a[1]/100,d=b+a[2]/100*(1-b);return[a[0],100*(d-b),100*(1-d)]};a.hwb.hcg=function(a){var b=1-a[2]/100,d=b-a[1]/100,c=0;1>d&&(c=(b-d)/(1-d));return[a[0],100*d,100*c]};a.apple.rgb=function(a){return[a[0]/65535*255,a[1]/65535*255,a[2]/65535*255]};a.rgb.apple=function(a){return[a[0]/
255*65535,a[1]/255*65535,a[2]/255*65535]};a.gray.rgb=function(a){return[a[0]/100*255,a[0]/100*255,a[0]/100*255]};a.gray.hsl=a.gray.hsv=function(a){return[0,0,a[0]]};a.gray.hwb=function(a){return[0,100,a[0]]};a.gray.cmyk=function(a){return[0,0,0,a[0]]};a.gray.lab=function(a){return[a[0],0,0]};a.gray.hex=function(a){a=Math.round(a[0]/100*255)&255;a=((a<<16)+(a<<8)+a).toString(16).toUpperCase();return"000000".substring(a.length)+a};a.rgb.gray=function(a){return[(a[0]+a[1]+a[2])/3/255*100]}}),th=function(f){for(var c=
{},a=Ba(hb),b=a.length,d=0;d<b;d++)c[a[d]]={distance:-1,parent:null};a=[f];for(c[f].distance=0;a.length;){f=a.pop();b=Ba(hb[f]);d=b.length;for(var e=0;e<d;e++){var g=b[e],k=c[g];-1===k.distance&&(k.distance=c[f].distance+1,k.parent=f,a.unshift(g))}}a={};f=Ba(c);b=f.length;for(d=0;d<b;d++){var h=f[d];if(null!==c[h].parent){e=h;g=c;k=[g[h].parent,h];var m=hb[g[h].parent][h];for(h=g[h].parent;g[h].parent;)k.unshift(g[h].parent),m=Rf(hb[g[h].parent][h],m),h=g[h].parent;m.conversion=k;a[e]=m}}return a},
qb={};Ba(hb).forEach(function(f){qb[f]={};Object.defineProperty(qb[f],"channels",{value:hb[f].channels});Object.defineProperty(qb[f],"labels",{value:hb[f].labels});var c=th(f);Ba(c).forEach(function(a){var b=c[a];qb[f][a]=Tf(b);qb[f][a].raw=Sf(b)})});var ta=qb,Hc=[].slice,Md=["keyword","gray","hex"],Jc={};Ba(ta).forEach(function(f){Jc[Hc.call(ta[f].labels).sort().join("")]=f});var cc={};da.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(f){var c=
this.model in yb.to?this:this.rgb();c=c.round("number"===typeof f?f:1);f=1===c.valpha?c.color:c.color.concat(this.valpha);return yb.to[c.model](f)},percentString:function(f){f=this.rgb().round("number"===typeof f?f:1);f=1===f.valpha?f.color:f.color.concat(this.valpha);return yb.to.rgb.percent(f)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var f={},c=ta[this.model].channels,a=ta[this.model].labels,b=0;b<c;b++)f[a[b]]=this.color[b];
1!==this.valpha&&(f.alpha=this.valpha);return f},unitArray:function(){var f=this.rgb().color;f[0]/=255;f[1]/=255;f[2]/=255;1!==this.valpha&&f.push(this.valpha);return f},unitObject:function(){var f=this.rgb().object();f.r/=255;f.g/=255;f.b/=255;1!==this.valpha&&(f.alpha=this.valpha);return f},round:function(f){f=Math.max(f||0,0);return new da(this.color.map(Vf(f)).concat(this.valpha),this.model)},alpha:function(f){return arguments.length?new da(this.color.concat(Math.max(0,Math.min(1,f))),this.model):
this.valpha},red:X("rgb",0,ea(255)),green:X("rgb",1,ea(255)),blue:X("rgb",2,ea(255)),hue:X(["hsl","hsv","hsl","hwb","hcg"],0,function(f){return(f%360+360)%360}),saturationl:X("hsl",1,ea(100)),lightness:X("hsl",2,ea(100)),saturationv:X("hsv",1,ea(100)),value:X("hsv",2,ea(100)),chroma:X("hcg",1,ea(100)),gray:X("hcg",2,ea(100)),white:X("hwb",1,ea(100)),wblack:X("hwb",2,ea(100)),cyan:X("cmyk",0,ea(100)),magenta:X("cmyk",1,ea(100)),yellow:X("cmyk",2,ea(100)),black:X("cmyk",3,ea(100)),x:X("xyz",0,ea(100)),
y:X("xyz",1,ea(100)),z:X("xyz",2,ea(100)),l:X("lab",0,ea(100)),a:X("lab",1),b:X("lab",2),keyword:function(f){return arguments.length?new da(f):ta[this.model].keyword(this.color)},hex:function(f){return arguments.length?new da(f):yb.to.hex(this.rgb().round().color)},rgbNumber:function(){var f=this.rgb().color;return(f[0]&255)<<16|(f[1]&255)<<8|f[2]&255},luminosity:function(){for(var f=this.rgb().color,c=[],a=0;a<f.length;a++){var b=f[a]/255;c[a]=.03928>=b?b/12.92:Math.pow((b+.055)/1.055,2.4)}return.2126*
c[0]+.7152*c[1]+.0722*c[2]},contrast:function(f){var c=this.luminosity();f=f.luminosity();return c>f?(c+.05)/(f+.05):(f+.05)/(c+.05)},level:function(f){f=this.contrast(f);return 7.1<=f?"AAA":4.5<=f?"AA":""},isDark:function(){var f=this.rgb().color;return 128>(299*f[0]+587*f[1]+114*f[2])/1E3},isLight:function(){return!this.isDark()},negate:function(){for(var f=this.rgb(),c=0;3>c;c++)f.color[c]=255-f.color[c];return f},lighten:function(f){var c=this.hsl();c.color[2]+=c.color[2]*f;return c},darken:function(f){var c=
this.hsl();c.color[2]-=c.color[2]*f;return c},saturate:function(f){var c=this.hsl();c.color[1]+=c.color[1]*f;return c},desaturate:function(f){var c=this.hsl();c.color[1]-=c.color[1]*f;return c},whiten:function(f){var c=this.hwb();c.color[1]+=c.color[1]*f;return c},blacken:function(f){var c=this.hwb();c.color[2]+=c.color[2]*f;return c},grayscale:function(){var f=this.rgb().color;f=.3*f[0]+.59*f[1]+.11*f[2];return da.rgb(f,f,f)},fade:function(f){return this.alpha(this.valpha-this.valpha*f)},opaquer:function(f){return this.alpha(this.valpha+
this.valpha*f)},rotate:function(f){var c=this.hsl(),a=c.color[0];a=(a+f)%360;c.color[0]=0>a?360+a:a;return c},mix:function(f,c){if(!f||!f.rgb)throw Error('Argument to "mix" was not a Color instance, but rather an instance of '+("undefined"===typeof f?"undefined":bc(f)));f=f.rgb();var a=this.rgb();c=void 0===c?.5:c;var b=2*c-1,d=f.alpha()-a.alpha();b=((-1===b*d?b:(b+d)/(1+b*d))+1)/2;d=1-b;return da.rgb(b*f.red()+d*a.red(),b*f.green()+d*a.green(),b*f.blue()+d*a.blue(),f.alpha()*c+a.alpha()*(1-c))}};
Ba(ta).forEach(function(f){if(-1===Md.indexOf(f)){var c=ta[f].channels;da.prototype[f]=function(){if(this.model===f)return new da(this);if(arguments.length)return new da(arguments,f);var a="number"===typeof arguments[c]?c:this.valpha;var b=ta[this.model][f].raw(this.color);b=Array.isArray(b)?b:[b];return new da(b.concat(a),f)};da[f]=function(a){"number"===typeof a&&(a=Ic(Hc.call(arguments),c));return new da(a,f)}}});Od(ua,{EARTHRADIUS:6370996.81,MCBAND:[1.289059486E7,8362377.87,5591021,3481989.83,
1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255E-8,8.98305509648872E-6,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,1.73379812E7],[-7.435856389565537E-9,8.983055097726239E-6,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,1.026014486E7],[-3.030883460898826E-8,8.98305509983578E-6,.30071316287616,59.74293618442277,7.357984074871,
-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552E-8,8.983055099779535E-6,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437E-9,8.983055096812155E-6,6.995724062E-5,23.10934304144901,-2.3663490511E-4,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878E-9,8.983055095805407E-6,-3.068298E-8,7.47137025468032,-3.53937994E-6,
-.02145144861037,-1.234426596E-5,1.0322952773E-4,-3.23890364E-6,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[8.277824516172526E-4,111320.7020463578,6.477955746671607E8,-4.082003173641316E9,1.077490566351142E10,-1.517187553151559E10,1.205306533862167E10,-5.124939663577472E9,9.133119359512032E8,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-2.339375119931662E7,
7.968221547186455E7,-1.159649932797253E8,9.723671115602145E7,-4.366194633752821E7,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-3.441963504368392E-4,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-3.218135878613132E-4,111320.7020701615,.00369383431289,
823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],getDistanceByMC:function(f,c){if(!f||!c)return 0;f=this.convertMC2LL(f);if(!f)return 0;var a=this.toRadians(f.lng);f=this.toRadians(f.lat);c=this.convertMC2LL(c);if(!c)return 0;var b=this.toRadians(c.lng);c=this.toRadians(c.lat);return this.getDistance(a,b,f,c)},getDistanceByLL:function(f,c){if(!f||!c)return 0;f.lng=this.getLoop(f.lng,-180,180);f.lat=this.getRange(f.lat,-74,74);c.lng=this.getLoop(c.lng,
-180,180);c.lat=this.getRange(c.lat,-74,74);var a=this.toRadians(f.lng);var b=this.toRadians(f.lat);f=this.toRadians(c.lng);c=this.toRadians(c.lat);return this.getDistance(a,f,b,c)},convertMC2LL:function(f){if(null===f||void 0===f)return new Fa(0,0);if(180>f.lng&&-180<f.lng&&90>f.lat&&-90<f.lat)return f;var c=new Fa(Math.abs(f.lng),Math.abs(f.lat));for(var a=0;a<this.MCBAND.length;a++)if(c.lat>=this.MCBAND[a]){var b=this.MC2LL[a];break}f=this.convertor(f,b);return f=new Fa(f.lng.toFixed(6),f.lat.toFixed(6))},
convertLL2MC:function(f){if(null===f||void 0===f)return new Fa(0,0);if(180<f.lng||-180>f.lng||90<f.lat||-90>f.lat)return f;f.lng=this.getLoop(f.lng,-180,180);f.lat=this.getRange(f.lat,-74,74);var c=new Fa(f.lng,f.lat);for(var a=0;a<this.LLBAND.length;a++)if(c.lat>=this.LLBAND[a]){var b=this.LL2MC[a];break}if(!b)for(a=0;a<this.LLBAND.length;a++)if(c.lat<=-this.LLBAND[a]){b=this.LL2MC[a];break}f=this.convertor(f,b);return f=new Fa(Number(f.lng.toFixed(2)),Number(f.lat.toFixed(2)))},convertor:function(f,
c){if(f&&c){var a=c[0]+c[1]*Math.abs(f.lng),b=Math.abs(f.lat)/c[9];c=c[2]+c[3]*b+c[4]*b*b+c[5]*b*b*b+c[6]*b*b*b*b+c[7]*b*b*b*b*b+c[8]*b*b*b*b*b*b;a*=0>f.lng?-1:1;c*=0>f.lat?-1:1;return new Fa(a,c)}},getDistance:function(f,c,a,b){return this.EARTHRADIUS*Math.acos(Math.sin(a)*Math.sin(b)+Math.cos(a)*Math.cos(b)*Math.cos(c-f))},toRadians:function(f){return Math.PI*f/180},toDegrees:function(f){return 180*f/Math.PI},getRange:function(f,c,a){null!=c&&(f=Math.max(f,c));null!=a&&(f=Math.min(f,a));return f},
getLoop:function(f,c,a){for(;f>a;)f-=a-c;for(;f<c;)f+=a-c;return f}});Od(ua.prototype,{lngLatToMercator:function(f){return ua.convertLL2MC(f)},lngLatToPoint:function(f){f=ua.convertLL2MC(f);return new Pd(f.lng,f.lat)},mercatorToLngLat:function(f){return ua.convertMC2LL(f)},pointToLngLat:function(f){f=new Fa(f.x,f.y);return ua.convertMC2LL(f)},pointToPixel:function(f,c,a,b,d){if(f)return f=this.lngLatToMercator(f,d),c=this.getZoomUnits(c),new Pd(Math.round((f.lng-a.lng)/c+b.width/2),Math.round((a.lat-
f.lat)/c+b.height/2))},pixelToPoint:function(f,c,a,b,d){if(f)return c=this.getZoomUnits(c),f=new Fa(a.lng+c*(f.x-b.width/2),a.lat-c*(f.y-b.height/2)),this.mercatorToLngLat(f,d)},getZoomUnits:function(f){return Math.pow(2,18-f)}});la.prototype.setMax=function(f){this.max=f||100};la.prototype.setMin=function(f){this.min=f||0};la.prototype.setMaxSize=function(f){this.maxSize=f||35};la.prototype.setMinSize=function(f){this.minSize=f||0};la.prototype.initPalette=function(){var f=this.gradient,c=this.paletteCtx=
(new Nc(256,1)).getContext("2d"),a=c.createLinearGradient(0,0,256,1);Ba(f).forEach(function(b){a.addColorStop(parseFloat(b),f[b])});c.fillStyle=a;c.fillRect(0,0,256,1);c.imageData=c.getImageData(0,0,256,1).data};la.prototype.getColor=function(f){f=this.getImageData(f);return"rgba("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]/256+")"};la.prototype.getImageData=function(f){var c=this.paletteCtx.imageData;if(void 0===f)return c;var a=this.max,b=this.min;f>a&&(f=a);f<b&&(f=b);f=4*Math.floor((f-b)/(a-b)*255);return[c[f],
c[f+1],c[f+2],c[f+3]]};la.prototype.getSize=function(f){var c=this.max,a=this.min,b=this.maxSize,d=this.minSize;f>c&&(f=c);f<a&&(f=a);return d+(f-a)/(c-a)*(b-d)};La.prototype._initialize=function(){this.v0=this._normalizaCoord(this.options.start);this.v3=this._normalizaCoord(this.options.end);this.v1=this._getControlPoint(this.v0,this.v3,4);this.v2=this._getControlPoint(this.v3,this.v0,5);this.v0[2]||(this.v0[2]=0);this.v3[2]||(this.v3[2]=0)};La.prototype.setOptions=function(f){this.options=f||{};
this._initialize()};La.prototype.getPoints=function(f){void 0===f&&(f=20);for(var c=[],a=0;a<=f;a++)c.push(this._getPoint(a/f));return c};La.prototype._normalizaCoord=function(f){if(!f)return[];f=ua.convertLL2MC({lng:Number(f[0]),lat:Number(f[1])});return[f.lng,f.lat]};La.prototype._getControlPoint=function(f,c){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return[].concat(aa(this._getQuarter(f,c)),[this._getDistance(f,c)/a])};La.prototype._getQuarter=function(f,c){return[(3*f[0]+
c[0])/4,(3*f[1]+c[1])/4]};La.prototype._getDistance=function(f,c){return Math.sqrt(Math.pow(f[0]-c[0],2)+Math.pow(f[1]-c[1],2))};La.prototype._getPoint=function(f){var c=[],a=this.v0,b=this.v1,d=this.v2,e=this.v3;c.push(Oc(f,a[0],b[0],d[0],e[0]),Oc(f,a[1],b[1],d[1],e[1]),Oc(f,a[2],b[2],d[2],e[2]));return c};Sa.prototype._initialize=function(){this.points=this.options.points||this.options.point||[];this.greatCirclePoints=[];for(var f=[],c=0;c<this.points.length;c++){var a=this._normalizaCoord(this.points[c]);
a&&f.push(a)}this.points=f};Sa.prototype.setOptions=function(f){this.options=f||{};this._initialize()};Sa.prototype.getPoints=function(){if(0===this.greatCirclePoints.length)for(var f=0;f<this.points.length-1;f++)this._calcGreatCirclePoints(this.points[f],this.points[f+1]);return this.greatCirclePoints};Sa.prototype._normalizaCoord=function(f){if(!f)return null;f instanceof Array&&(f={lng:Number(f[0]),lat:Number(f[1])});var c=ua.convertLL2MC(f);f=ua.convertMC2LL(f);c.latLng=f;return c};Sa.prototype._calcGreatCirclePoints=
function(f,c){var a=f.latLng,b=c.latLng;if(!Mc(a.lng,b.lng)||!Mc(a.lat,b.lat)){var d=ua.getDistance(ja(a.lng),ja(a.lat),ja(b.lng),ja(b.lat));if(!(25E4>d)){d=Math.round(d/15E4);var e=this._calcAngularDistance(a,b);this.greatCirclePoints.push([f.lng,f.lat]);for(var g=0;g<d;g++){var k=this._calcMiddlePoint(a,b,g/d,e);k=ua.convertLL2MC(k);var h=Qd(k,f);30037726<h&&(k.lng=k.lng<f.lng?k.lng+this.WORLD_SIZE_MC:k.lng-this.WORLD_SIZE_MC);this.greatCirclePoints.push([k.lng,k.lat]);f=k}h=Qd(c,f);30037726<h&&
(c.lng=c.lng<f.lng?c.lng+this.WORLD_SIZE_MC:c.lng-this.WORLD_SIZE_MC);this.greatCirclePoints.push([c.lng,c.lat])}}};Sa.prototype._calcAngularDistance=function(f,c){var a=ja(f.lat),b=ja(c.lat);f=ja(f.lng);c=ja(c.lng);return Math.acos(Math.sin(a)*Math.sin(b)+Math.cos(a)*Math.cos(b)*Math.cos(Math.abs(c-f)))};Sa.prototype._calcMiddlePoint=function(f,c,a,b){var d=c.lat,e=f.lng;c=c.lng;f=ja(f.lat);d=ja(d);e=ja(e);var g=ja(c);c=Math.sin((1-a)*b)/Math.sin(b);b=Math.sin(a*b)/Math.sin(b);a=c*Math.cos(f)*Math.cos(e)+
b*Math.cos(d)*Math.cos(g);e=c*Math.cos(f)*Math.sin(e)+b*Math.cos(d)*Math.sin(g);f=Math.atan2(c*Math.sin(f)+b*Math.sin(d),Math.sqrt(Math.pow(a,2)+Math.pow(e,2)));return new Fa(Kc(Math.atan2(e,a)),Kc(f))};var qd=function(){function f(c){F(this,f);this.options=this.getCommonDefaultOptions();this.options=W(this.options,this.getDefaultOptions());this.autoUpdate=!1;this.options=W(this.options,c);this.options.data&&(this.data=this.options.data)}J(f,[{key:"getCommonDefaultOptions",value:function(){return{}}},
{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(c){}},{key:"destroy",value:function(){this.onDestroy&&this.onDestroy()}},{key:"render",value:function(){}},{key:"setData",value:function(c,a){a=a||{};this.data=c;this.onDataChanged&&this.onDataChanged(this.getData());this.onChanged&&this.onChanged(this.getOptions(),this.getData());!1!==a.autoRender&&this.webglLayer&&this.webglLayer.render()}},{key:"getData",value:function(){return this.data||[]}},{key:"setOptions",
value:function(c){c=c||{};var a=W({},this.getOptions());W(this.options,c);this.onOptionsChanged&&this.onOptionsChanged(this.getOptions(),a);this.onChanged&&this.onChanged(this.getOptions(),this.getData());c.data?this.setData(c.data):this.webglLayer&&this.webglLayer.render()}},{key:"getOptions",value:function(){return this.options||{}}},{key:"onOptionsChanged",value:function(c,a){}},{key:"onDataChanged",value:function(c){}},{key:"onChanged",value:function(c,a){}},{key:"onDestroy",value:function(){}},
{key:"lnglatToMercator",value:function(c,a){}},{key:"setWebglLayer",value:function(c){this.webglLayer=c}},{key:"getWebglLayer",value:function(){return this.webglLayer}},{key:"isRequestAnimation",value:function(){return this.autoUpdate}}]);return f}(),S=function(){function f(c,a,b){F(this,f);this.options=a;this.gl=c;b&&(this.map=b.map);b=this.getVertexShader(a.vertexShader);var d=this.getFragmentShader(a.fragmentShader);a=c.createShader(c.VERTEX_SHADER);c.shaderSource(a,b);c.compileShader(a);c.getShaderParameter(a,
c.COMPILE_STATUS)?(b=c.createShader(c.FRAGMENT_SHADER),c.shaderSource(b,d),c.compileShader(b),c.getShaderParameter(b,c.COMPILE_STATUS)?(d=c.createProgram(),c.attachShader(d,a),c.attachShader(d,b),c.deleteShader(a),c.deleteShader(b),c.linkProgram(d),c.getProgramParameter(d,c.LINK_STATUS)?a=d:(a="Shader program failed to link.  The error log is:"+c.getProgramInfoLog(d),console.error(a),a=-1)):(a="Fragment shader failed to compile.  The error log is:"+c.getShaderInfoLog(b),console.error(a),a=-1)):(a=
"Vertex shader failed to compile.  The error log is:"+c.getShaderInfoLog(a),console.error(a),a=-1);a=this.program=a;b={};d=c.getProgramParameter(a,c.ACTIVE_ATTRIBUTES);for(var e=0;e<d;e++){var g=c.getActiveAttrib(a,e);b[g.name]=c.getAttribLocation(a,g.name)}e={};g={};for(var k=c.getProgramParameter(a,c.ACTIVE_UNIFORMS),h=0;h<k;h++){var m=c.getActiveUniform(a,h);e[m.name]=c.getUniformLocation(a,m.name);g[m.name]=m.type}this.parameter=c={attributes:b,numAttributes:d,uniformsType:g,uniforms:e};this.attributes=
c.attributes;this.uniforms=c.uniforms;this.parameter=c}J(f,[{key:"getVertexShader",value:function(c){var a="";this.map&&"cesium"===this.map.type&&(a="#define LOG_DEPTH\n");a+="#ifdef LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n#endif\nuniform vec2 MAPV_resolution;\n#if defined(PICK)\nuniform bool uIsPickRender;attribute vec3 aPickColor;uniform vec3 uPickedColor;varying vec4 vPickColor;uniform bool uEnablePicked;bool mapvIsPicked(){return uEnablePicked&&aPickColor==uPickedColor;}\n#endif\nvoid afterMain(){\n#if defined(LOG_DEPTH)\nv_depthFromNearPlusOne=(gl_Position.w-0.1)+1.0;gl_Position.z=clamp(gl_Position.z/gl_Position.w,-1.0,1.0)*gl_Position.w;\n#endif\n#if defined(PICK)\nvPickColor=vec4(aPickColor,0.0);if(mapvIsPicked()){vPickColor.a=1.0;}\n#endif\n}";
c=this.getDefines()+a+c;c=c.replace("void main","void originMain");return c+"void main() {originMain(); afterMain();}"}},{key:"getFragmentShader",value:function(c){var a="";this.map&&"cesium"===this.map.type&&(a="#define LOG_DEPTH\n");a+="#if defined(LOG_DEPTH)\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;uniform vec2 MAPV_resolution;\n#if defined(PICK)\nuniform bool uIsPickRender;varying vec4 vPickColor;bool mapvIsPicked(){return vPickColor.a==1.0;}\n#endif\n#if defined(LOG_DEPTH)\nuniform float oneOverLog2FarDepthFromNearPlusOne;uniform float farDepthFromNearPlusOne;varying float v_depthFromNearPlusOne;void writeLogDepth(float depth){if(depth<=0.9999999||depth>farDepthFromNearPlusOne){discard;}gl_FragDepthEXT=log2(depth)*oneOverLog2FarDepthFromNearPlusOne;}\n#endif\nvoid afterMain(){\n#if defined(PICK)\nif(uIsPickRender){gl_FragColor=vec4(vPickColor.rgb,1.0);return;}\n#endif\n#if defined(LOG_DEPTH)\nwriteLogDepth(v_depthFromNearPlusOne);\n#endif\n}";
c=this.getDefines()+a+c;c=c.replace("void main","void originMain");return c+"void main() {originMain(); afterMain();}"}},{key:"getDefines",value:function(){var c="",a=this.options.defines;if(a)for(var b=0;b<a.length;b++)c+="#define "+a[b]+"\n";return c}},{key:"use",value:function(c,a){this.gl=c;c.useProgram(this.program);this.map&&"cesium"===this.map.type&&this.setUniforms({oneOverLog2FarDepthFromNearPlusOne:this.map.map.scene.context._us._oneOverLog2FarDepthFromNearPlusOne,farDepthFromNearPlusOne:this.map.map.scene.context._us._farDepthFromNearPlusOne});
this.uniforms.MAPV_resolution&&this.setUniforms({MAPV_resolution:[c.canvas.width,c.canvas.height]})}},{key:"setUniform",value:function(c,a){var b=this.gl,d=this.uniforms[c];if(d)switch(this.parameter.uniformsType[c]){case b.FLOAT:b.uniform1f(d,a);break;case b.FLOAT_VEC2:b.uniform2f(d,a[0],a[1]);break;case b.FLOAT_VEC3:b.uniform3f(d,a[0],a[1],a[2]);break;case b.FLOAT_VEC4:b.uniform4f(d,a[0],a[1],a[2],a[3]);break;case b.SAMPLER_2D:case b.SAMPLER_CUBE:b.activeTexture(b["TEXTURE"+this.textureIndex]);
b.uniform1i(d,this.textureIndex);b.bindTexture(b.TEXTURE_2D,a);this.textureIndex++;break;case b.INT:case b.BOOL:b.uniform1i(d,a);break;case b.INT_VEC2:case b.BOOL_VEC2:b.uniform2i(d,a[0],a[1]);break;case b.INT_VEC3:case b.BOOL_VEC3:b.uniform3i(d,a[0],a[1],a[2]);break;case b.INT_VEC4:case b.BOOL_VEC4:b.uniform4i(d,a[0],a[1],a[2],a[3]);break;case b.FLOAT_MAT2:b.uniformMatrix2fv(d,!1,a);break;case b.FLOAT_MAT3:b.uniformMatrix3fv(d,!1,a);break;case b.FLOAT_MAT4:b.uniformMatrix4fv(d,!1,a);break;default:console.error("Unrecognized uniform type: "+
c)}else console.warn("Unrecognized uniform type: "+c)}},{key:"setUniforms",value:function(c){this.textureIndex=0;for(var a in c)this.setUniform(a,c[a])}}]);return f}(),bf=function(){function f(c){F(this,f);this.options=c;this.gl=c.gl;this.savedState=[];this.currentState=this.getCurrentState()}J(f,[{key:"setDefaultState",value:function(){this.setState()}},{key:"getDefaultState",value:function(){return{blend:!1,depthTest:!1,cullFace:!1,depthMask:!0,stencilTest:!1}}},{key:"getCurrentState",value:function(){var c=
this.gl;return{blend:c.getParameter(c.BLEND),stencilTest:c.getParameter(c.STENCIL_TEST),depthTest:c.getParameter(c.DEPTH_TEST),cullFace:c.getParameter(c.CULL_FACE),depthMask:c.getParameter(c.DEPTH_WRITEMASK)}}},{key:"save",value:function(){this.savedState.push(this.getCurrentState())}},{key:"restore",value:function(){var c=this.savedState.pop();this.setState(c)}},{key:"setState",value:function(c){var a=this.gl,b=this.getCurrentState();c=W(this.getDefaultState(),c);c.blend!==b.blend&&(c.blend?a.enable(a.BLEND):
a.disable(a.BLEND));c.depthTest!==b.depthTest&&(c.depthTest?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST));c.cullFace!==b.cullFace&&(c.cullFace?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE));c.depthMask!==b.depthMask&&(c.depthMask?a.depthMask(!0):a.depthMask(!1));this.currentState=c}}]);return f}(),H=function(){function f(c){F(this,f);this.options=c;this.gl=c.gl;this.buffer=this.gl.createBuffer();c.data&&this.updateData(c.data)}J(f,[{key:"updateData",value:function(c){var a=this.options,b=this.gl;
this.bind();b.bufferData(b[a.target],c,b[a.usage])}},{key:"bind",value:function(c){c=c||this.gl;c.bindBuffer(c[this.options.target],this.buffer)}},{key:"unBind",value:function(c){c=c||this.gl;c.bindBuffer(c[this.options.target],null)}},{key:"destroy",value:function(){this.buffer=null}}]);return f}(),uh={BYTE:1,UNSIGNED_BYTE:1,SHORT:2,UNSIGNED_SHORT:2,FLOAT:4},wa=function(){function f(c){F(this,f);this.options=c;this.attributes=c.attributes;this.gl=c.gl;this.program=c.program;for(c=this.stride=0;c<
this.attributes.length;c++)this.stride+=uh[this.attributes[c].type]*this.attributes[c].size}J(f,[{key:"setVertexAttribPointers",value:function(){for(var c=this.gl,a=this.program,b=0;b<this.attributes.length;b++){var d=this.attributes[b],f=a.attributes[d.name];void 0!==f&&(d.buffer.bind(c),c.vertexAttribPointer(f,d.size,c[d.type],d.normalize||!1,void 0!==d.stride?d.stride:this.stride,d.offset),c.enableVertexAttribArray(f))}}},{key:"bind",value:function(){this.setVertexAttribPointers()}},{key:"destroy",
value:function(){}}]);return f}(),sa=function d(c,a,b){F(this,d);a=a||c.canvas.width;b=b||c.canvas.height;var e=c.createFramebuffer(),g=c.createTexture();c.bindTexture(c.TEXTURE_2D,g);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,b,0,c.RGBA,c.UNSIGNED_BYTE,null);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);e.texture=
g;var k=c.createRenderbuffer();c.bindRenderbuffer(c.RENDERBUFFER,k);c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,a,b);e.depthBuffer=k;c.bindFramebuffer(c.FRAMEBUFFER,e);c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,g,0);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,k);a=c.checkFramebufferStatus(c.FRAMEBUFFER);c.FRAMEBUFFER_COMPLETE===a&&(c.bindFramebuffer(c.FRAMEBUFFER,null),c.bindTexture(c.TEXTURE_2D,null),c.bindRenderbuffer(c.RENDERBUFFER,
null),this.framebuffer=e)},yc=function(){function c(a){F(this,c);this.options={};W(this.options,a);this.vertex=[-1,1,0,-1,-1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0];this.sampleCoord=[0,1,0,0,1,1,1,1,0,0,1,0]}J(c,[{key:"getOptions",value:function(){return this.options}},{key:"onResize",value:function(a){}},{key:"render",value:function(a){var b=a.gl;a=a.texture;var d=this.programSample;b.useProgram(d.program);var c=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,c);var g=[-1,-1,0,-1,1,0,1,1,0,1,1,0,-1,-1,0,1,-1,
0];b.bufferData(b.ARRAY_BUFFER,new Float32Array(g),b.STATIC_DRAW);b.enableVertexAttribArray(d.attributes.aPos);b.vertexAttribPointer(d.attributes.aPos,3,b.FLOAT,!1,0,0);c=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,c);b.bufferData(b.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,1,1,1,0,0,1,0]),b.STATIC_DRAW);b.enableVertexAttribArray(d.attributes.aTextureCoord);b.vertexAttribPointer(d.attributes.aTextureCoord,2,b.FLOAT,!1,0,0);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,a);b.uniform1i(d.uniforms.uSampler,
0);b.drawArrays(b.TRIANGLES,0,g.length/3)}}]);return c}(),vh=function(c){function a(b){F(this,a);return O(this,(a.__proto__||L(a)).call(this,b))}P(a,c);J(a,[{key:"getProgram",value:function(a){this.programSample||(this.programSample=new S(a,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;varying vec2 vTextureCoord;void main(){float fStep=1.0/512.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;gl_FragColor=blurSample;}"}),
this.vertexBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.sampleBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexBuffer.updateData(new Float32Array(this.vertex)),this.sampleBuffer.updateData(new Float32Array(this.sampleCoord)),this.vertexArray=new wa({gl:a,program:this.programSample,attributes:[{stride:12,name:"aPos",buffer:this.vertexBuffer,size:3,type:"FLOAT",offset:0},{stride:8,name:"aTextureCoord",buffer:this.sampleBuffer,size:2,type:"FLOAT",offset:0}]}));
return this.programSample}},{key:"render",value:function(a){var b=a.gl;a=a.texture;b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);var c=this.getProgram(b);c.use(b);this.vertexArray.bind();b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,a);b.uniform1i(c.uniforms.uSampler,1);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3)}}]);return a}(yc),wh=function(c){function a(b){F(this,a);return O(this,(a.__proto__||L(a)).call(this,b))}P(a,c);J(a,[{key:"getProgram",value:function(a){this.programBright||
(this.programBright=new S(a,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-(1.0-threshold)/5.0));float brightness=dot(color.rgb,vec3(0.2126,0.7152,0.0722));if(brightness>threshold){color=lightColor;}else{color=vec4(0.0);}gl_FragColor=color;}"}));
this.programBloom||(this.programBloom=new S(a,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;uniform float devicePixelRatio;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y)*devicePixelRatio;vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"}));
this.programResult||(this.programResult=new S(a,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord);vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"}));
return{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"onResize",value:function(a){this.collectBrightBuffer=new sa(a);this.bloomBuffer=new sa(a)}},{key:"getExtraFbo",value:function(a){this.collectBrightBuffer||(this.collectBrightBuffer=new sa(a));this.bloomBuffer||(this.bloomBuffer=new sa(a));return{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(a){var b=a.gl,
c=a.texture;a=a.fbo;var g=this.getOptions();b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);var k=this.getProgram(b),h=k.programBright,m=k.programBloom;k=k.programResult;var n=this.getExtraFbo(b),p=n.collectBrightBuffer;n=n.bloomBuffer;var l=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,l);b.bufferData(b.ARRAY_BUFFER,new Float32Array(this.vertex),b.STATIC_DRAW);b.enableVertexAttribArray(h.attributes.aPos);b.vertexAttribPointer(h.attributes.aPos,3,b.FLOAT,!1,0,0);b.enableVertexAttribArray(m.attributes.aPos);
b.vertexAttribPointer(m.attributes.aPos,3,b.FLOAT,!1,0,0);b.enableVertexAttribArray(k.attributes.aPos);b.vertexAttribPointer(k.attributes.aPos,3,b.FLOAT,!1,0,0);l=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,l);b.bufferData(b.ARRAY_BUFFER,new Float32Array(this.sampleCoord),b.STATIC_DRAW);b.enableVertexAttribArray(h.attributes.aTextureCoord);b.vertexAttribPointer(h.attributes.aTextureCoord,2,b.FLOAT,!1,0,0);b.enableVertexAttribArray(m.attributes.aTextureCoord);b.vertexAttribPointer(m.attributes.aTextureCoord,
2,b.FLOAT,!1,0,0);b.enableVertexAttribArray(k.attributes.aTextureCoord);b.vertexAttribPointer(k.attributes.aTextureCoord,2,b.FLOAT,!1,0,0);b.useProgram(h.program);b.bindFramebuffer(b.FRAMEBUFFER,p);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,c);b.uniform1i(h.uniforms.uSampler,1);b.uniform1f(h.uniforms.threshold,g.threshold||0);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3);b.useProgram(m.program);b.bindFramebuffer(b.FRAMEBUFFER,
n);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,p.texture);b.uniform1i(m.uniforms.uSampler,1);b.uniform1i(m.uniforms.isVertical,!0);b.uniform1f(m.uniforms.blurSize,g.blurSize||2);b.uniform1f(m.uniforms.devicePixelRatio,window.devicePixelRatio);b.uniform2fv(m.uniforms.canvasSize,[b.canvas.width,b.canvas.height]);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3);b.useProgram(m.program);b.bindFramebuffer(b.FRAMEBUFFER,p);b.clearColor(0,
0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,n.texture);b.uniform1i(m.uniforms.uSampler,1);b.uniform1i(m.uniforms.isVertical,!1);b.uniform1f(m.uniforms.blurSize,g.blurSize||2);b.uniform1f(m.uniforms.devicePixelRatio,window.devicePixelRatio);b.uniform2fv(m.uniforms.canvasSize,[b.canvas.width,b.canvas.height]);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3);b.useProgram(k.program);b.bindFramebuffer(b.FRAMEBUFFER,a);b.clearColor(0,0,0,
0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,c);b.uniform1i(k.uniforms.originalTexture,1);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,p.texture);b.uniform1i(k.uniforms.bloomTexture,0);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3);b.bindBuffer(b.ARRAY_BUFFER,null);b.useProgram(null)}}]);return a}(yc),xh=function(c){function a(b){F(this,a);return O(this,(a.__proto__||L(a)).call(this,b))}P(a,c);J(a,[{key:"getProgram",value:function(a){this.programBright||
(this.programBright=new S(a,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-threshold));gl_FragColor=lightColor;}"}));this.programBloom||(this.programBloom=new S(a,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",
fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;uniform float devicePixelRatio;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y)*devicePixelRatio;vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"}));
this.programResult||(this.programResult=new S(a,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;uniform float toneScale;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord)*toneScale;vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"}));
return{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"onResize",value:function(a){this.collectBrightBuffer=new sa(a);this.bloomBuffer=new sa(a)}},{key:"getExtraFbo",value:function(a){this.collectBrightBuffer||(this.collectBrightBuffer=new sa(a));this.bloomBuffer||(this.bloomBuffer=new sa(a));return{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(a){var b=a.gl,
c=a.texture;a=a.fbo;var g=this.getOptions(),k="clarity"in g?g.clarity:1;k=Math.max(0,k);k=Math.min(1,k);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);var h=this.getProgram(b),m=h.programBright,n=h.programBloom;h=h.programResult;var p=this.getExtraFbo(b),l=p.collectBrightBuffer;p=p.bloomBuffer;var q=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,q);b.bufferData(b.ARRAY_BUFFER,new Float32Array(this.vertex),b.STATIC_DRAW);b.enableVertexAttribArray(m.attributes.aPos);b.vertexAttribPointer(m.attributes.aPos,
3,b.FLOAT,!1,0,0);b.enableVertexAttribArray(n.attributes.aPos);b.vertexAttribPointer(n.attributes.aPos,3,b.FLOAT,!1,0,0);b.enableVertexAttribArray(h.attributes.aPos);b.vertexAttribPointer(h.attributes.aPos,3,b.FLOAT,!1,0,0);q=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,q);b.bufferData(b.ARRAY_BUFFER,new Float32Array(this.sampleCoord),b.STATIC_DRAW);b.enableVertexAttribArray(m.attributes.aTextureCoord);b.vertexAttribPointer(m.attributes.aTextureCoord,2,b.FLOAT,!1,0,0);b.enableVertexAttribArray(n.attributes.aTextureCoord);
b.vertexAttribPointer(n.attributes.aTextureCoord,2,b.FLOAT,!1,0,0);b.enableVertexAttribArray(h.attributes.aTextureCoord);b.vertexAttribPointer(h.attributes.aTextureCoord,2,b.FLOAT,!1,0,0);b.useProgram(m.program);b.bindFramebuffer(b.FRAMEBUFFER,l);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,c);b.uniform1i(m.uniforms.uSampler,1);b.uniform1f(m.uniforms.threshold,g.threshold||0);b.drawArrays(b.TRIANGLES,0,this.vertex.length/
3);b.useProgram(n.program);b.bindFramebuffer(b.FRAMEBUFFER,p);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,l.texture);b.uniform1i(n.uniforms.uSampler,1);b.uniform1i(n.uniforms.isVertical,!0);b.uniform1f(n.uniforms.blurSize,g.blurSize||2);b.uniform1f(n.uniforms.devicePixelRatio,window.devicePixelRatio);b.uniform2fv(n.uniforms.canvasSize,[b.canvas.width,b.canvas.height]);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3);b.useProgram(n.program);
b.bindFramebuffer(b.FRAMEBUFFER,l);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,p.texture);b.uniform1i(n.uniforms.uSampler,1);b.uniform1i(n.uniforms.isVertical,!1);b.uniform1f(n.uniforms.blurSize,g.blurSize||2);b.uniform1f(n.uniforms.devicePixelRatio,window.devicePixelRatio);b.uniform2fv(n.uniforms.canvasSize,[b.canvas.width,b.canvas.height]);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3);b.useProgram(h.program);b.bindFramebuffer(b.FRAMEBUFFER,
a);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,c);b.uniform1i(h.uniforms.originalTexture,1);b.uniform1f(h.uniforms.toneScale,k);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,l.texture);b.uniform1i(h.uniforms.bloomTexture,0);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3);b.bindBuffer(b.ARRAY_BUFFER,null);b.useProgram(null)}}]);return a}(yc),yh=function(c){function a(b){F(this,a);return O(this,(a.__proto__||L(a)).call(this,
b))}P(a,c);J(a,[{key:"getProgram",value:function(a){this.programSample||(this.programSample=new S(a,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform vec2 canvasSize;varying vec2 vTextureCoord;void main(){float fStep=1.0/312.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;float desX=abs((gl_FragCoord.x-canvasSize.x/2.0)/(canvasSize.x/2.0));float desY=abs((gl_FragCoord.y-canvasSize.y/2.0)/(canvasSize.y/2.0));float factor=max(desX,desY);gl_FragColor=(sample22*(1.0-factor)+blurSample*factor);}"}));
return this.programSample}},{key:"render",value:function(a){var b=a.gl;a=a.texture;var c=this.getProgram(b);b.useProgram(c.program);var g=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,g);b.bufferData(b.ARRAY_BUFFER,new Float32Array(this.vertex),b.STATIC_DRAW);b.enableVertexAttribArray(c.attributes.aPos);b.vertexAttribPointer(c.attributes.aPos,3,b.FLOAT,!1,0,0);g=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,g);b.bufferData(b.ARRAY_BUFFER,new Float32Array(this.sampleCoord),b.STATIC_DRAW);b.enableVertexAttribArray(c.attributes.aTextureCoord);
b.vertexAttribPointer(c.attributes.aTextureCoord,2,b.FLOAT,!1,0,0);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,a);b.uniform1i(c.uniforms.uSampler,1);b.uniform2fv(c.uniforms.canvasSize,[b.canvas.width,b.canvas.height]);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3)}}]);return a}(yc),cf=function(){function c(a){F(this,c);this.gl=a;this.effects=[];this.initFbo()}J(c,[{key:"addEffect",value:function(a){this.effects.push(a)}},{key:"removeEffect",value:function(a){}},{key:"setEffects",value:function(a){this.effects=
a}},{key:"onResize",value:function(){this.initFbo();var a=this.gl,b=this.effects;if(b&&1<b.length)for(var d=1;d<b.length;d++){var c=b[d];c.onResize&&c.onResize(a)}}},{key:"initFbo",value:function(){var a=this.gl;this.fbo=[new sa(a),new sa(a)]}},{key:"render",value:function(){var a=this.gl,b=this.effects;if(b&&0<b.length)for(var d={},c=0;c<b.length;c++){var g=this.fbo[c%2].framebuffer;c===b.length-1&&(g=null);a.bindFramebuffer(a.FRAMEBUFFER,g);var k=[0,0,0,0];a.clearColor(k[0],k[1],k[2],k[3]);a.clear(a.COLOR_BUFFER_BIT|
a.DEPTH_BUFFER_BIT);b[c].render({isPickRender:!1,gl:a,texture:d.texture,fbo:g});d=g}}}]);return c}(),ca=function(c){function a(b){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b));b.pickedColor=[-1,-1,-1];return b}P(a,c);J(a,[{key:"getCommonDefaultOptions",value:function(){return{repeat:!1,enablePicked:!1,autoSelect:!1,selectedIndex:-1,selectedColor:"rgba(20, 20, 200, 1.0)"}}},{key:"commonInitialize",value:function(a){var b=this.getOptions();this.gl=a;b.enablePicked&&(this.pickBuffer=new H({gl:a,
target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}))}},{key:"getCommonAttributes",value:function(){var a=[];this.getOptions().enablePicked&&a.push({name:"aPickColor",buffer:this.pickBuffer,size:3,type:"FLOAT",stride:12,offset:0});return a}},{key:"normizedColor",value:function(a){var b=a;a instanceof Array||(b=da(a).unitArray());void 0===b[3]&&(b[3]=1);return b}},{key:"normizedPoint",value:function(a){if(!a||!a[0]||!a[1])return[0,0,0];var b=this.getPointOffset(),c=Number(a[0]),g=Number(a[1]);-180<=c&&180>=
c&&-90<=g&&90>=g&&(g=this.webglLayer.map.lnglatToMercator(c,g),c=g[0],g=g[1]);var k=Number(a[2])||0;this.webglLayer&&"cesium"===this.webglLayer.options.mapType&&window.Cesium?(c=this.convertLngLat([c,g]),k=window.Cesium.Cartesian3.fromDegrees(c[0],c[1],k),c=k.x,g=k.y,k=k.z):this.webglLayer&&"bmapgl"===this.webglLayer.options.mapType&&"B_EARTH_MAP"===this.webglLayer.map.map.mapType&&(c=this.convertLngLat([c,g]),k=this.webglLayer.map.map.getEarth().scene.fromLatLngToXYZ({lng:c[0],lat:c[1]}),c=k.x,g=
k.y,k=k.z);return 3<a.length?[c-b[0],g-b[1],k].concat(aa(a.slice(3))):[c-b[0],g-b[1],k]}},{key:"convertLngLat",value:function(a){return[a[0]/2.003750834E7*180,180/Math.PI*(2*Math.atan(Math.exp(a[1]/2.003750834E7*180*Math.PI/180))-Math.PI/2)]}},{key:"getPointOffset",value:function(){var a=[0,0],c=this.getOptions();this.webglLayer&&this.webglLayer.options.pointOffset?a=this.webglLayer.options.pointOffset:c.pointOffset&&(a=c.pointOffset);return a}},{key:"indexToRgb",value:function(a){a++;var b=Math.floor(a/
65536);a-=65536*b;var c=Math.floor(a/256);return[a-256*c,c,b]}},{key:"rgbToIndex",value:function(a){return a[0]+256*a[1]+65536*a[2]-1}},{key:"getCommonUniforms",value:function(a){a=a.isPickRender;var b=this.getOptions(),c={};if(b.enablePicked){var g=b.autoSelect?this.pickedColor:this.indexToRgb(b.selectedIndex||-1);c=W(c,{uSelectedColor:this.normizedColor(b.selectedColor),uEnablePicked:b.enablePicked,uPickedColor:g.map(function(a){return a/255}),uIsPickRender:!!a})}return c}},{key:"pick",value:function(a,
c){var b=this.gl;this.webglLayer.saveFramebuffer();this.webglLayer.bindFramebuffer(this.webglLayer.pickFBO);this.webglLayer.clear();this.render({gl:b,isPickRender:!0,matrix:this.webglLayer.matrix,projectionMatrix:this.webglLayer.projectionMatrix,viewMatrix:this.webglLayer.viewMatrix,orthoMatrix:this.webglLayer.orthoMatrix});var d=new Uint8Array(4);b.readPixels(a*window.devicePixelRatio,b.canvas.height-c*window.devicePixelRatio,1,1,b.RGBA,b.UNSIGNED_BYTE,d);a=this.rgbToIndex(d);this.pickedColor=[d[0],
d[1],d[2]];this.webglLayer.restoreFramebuffer();return{dataIndex:a,dataItem:this.data[a]}}},{key:"setGLState",value:function(a){this.webglLayer.stateManager.setState(a)}},{key:"addMultipleCoords",value:function(a,c,e){if(!this.options.repeat||!this.webglLayer||"bmapgl"!==this.webglLayer.options.mapType||"B_EARTH_MAP"===this.webglLayer.map.map.mapType)return[a];var b=this.webglLayer.map.map;c=c||b.getZoom();var d=e?b.worldSize(c):4.007545274461451E7;c=function(a){return[[a[0]-d,a[1],a[2]||0],[a[0]+
d,a[1],a[2]||0]]};if(a instanceof Array&&!(a[0]instanceof Array))return c=c(a),c=gb(c,2),[a,c[0],c[1]];e=[];b=[];for(var h=0;h<a.length;h++){var m=c(a[h]);m=gb(m,2);var n=m[1];e.push(m[0]);b.push(n)}return[a,e,b]}}]);return a}(qd),Ea=K(function(c,a){Object.defineProperty(a,"__esModule",{value:!0});a.setMatrixArrayType=function(b){a.ARRAY_TYPE=d=b};a.toRadian=function(a){return a*e};a.equals=function(a,c){return Math.abs(a-c)<=b*Math.max(1,Math.abs(a),Math.abs(c))};a.RANDOM=a.ARRAY_TYPE=a.EPSILON=
void 0;var b=1E-6;a.EPSILON=b;var d="undefined"!==typeof Float32Array?Float32Array:Array;a.ARRAY_TYPE=d;a.RANDOM=Math.random;var e=Math.PI/180});N(Ea);var df=K(function(c,a){function b(a,b,c){var d=b[0],h=b[1],g=b[2];b=b[3];var l=c[0],k=c[1],e=c[2];c=c[3];a[0]=d*l+g*k;a[1]=h*l+b*k;a[2]=d*e+g*c;a[3]=h*e+b*c;return a}function d(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];return a}Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){var a=new e.ARRAY_TYPE(4);e.ARRAY_TYPE!=
Float32Array&&(a[1]=0,a[2]=0);a[0]=1;a[3]=1;return a};a.clone=function(a){var b=new e.ARRAY_TYPE(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a};a.fromValues=function(a,b,c,d){var h=new e.ARRAY_TYPE(4);h[0]=a;h[1]=b;h[2]=c;h[3]=d;return h};a.set=function(a,b,c,d,e){a[0]=b;a[1]=c;a[2]=d;a[3]=e;return a};a.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2];a[2]=
c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a};a.invert=function(a,b){var c=b[0],d=b[1],g=b[2];b=b[3];var e=c*b-g*d;if(!e)return null;e=1/e;a[0]=b*e;a[1]=-d*e;a[2]=-g*e;a[3]=c*e;return a};a.adjoint=function(a,b){var c=b[0];a[0]=b[3];a[1]=-b[1];a[2]=-b[2];a[3]=c;return a};a.determinant=function(a){return a[0]*a[3]-a[2]*a[1]};a.multiply=b;a.rotate=function(a,b,c){var d=b[0],h=b[1],g=b[2];b=b[3];var l=Math.sin(c);c=Math.cos(c);a[0]=d*c+g*l;a[1]=h*c+b*l;a[2]=d*-l+g*c;a[3]=h*-l+b*c;return a};
a.scale=function(a,b,c){var d=b[1],h=b[2],g=b[3],l=c[0];c=c[1];a[0]=b[0]*l;a[1]=d*l;a[2]=h*c;a[3]=g*c;return a};a.fromRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=-c;a[3]=b;return a};a.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=b[1];return a};a.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))};a.LDU=function(a,b,c,d){a[2]=d[2]/d[0];
c[0]=d[0];c[1]=d[1];c[3]=d[3]-a[2]*c[1];return[a,b,c]};a.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];return a};a.subtract=d;a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};a.equals=function(a,b){var c=a[0],d=a[1],g=a[2];a=a[3];var k=b[0],l=b[1],q=b[2];b=b[3];return Math.abs(c-k)<=e.EPSILON*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(d-l)<=e.EPSILON*Math.max(1,Math.abs(d),Math.abs(l))&&Math.abs(g-q)<=e.EPSILON*Math.max(1,
Math.abs(g),Math.abs(q))&&Math.abs(a-b)<=e.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;return a};a.multiplyScalarAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;return a};a.sub=a.mul=void 0;var e=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=ba&&Z?Z(a,c):{};d.get||d.set?ba(b,c,d):b[c]=a[c]}b.default=
a;return b}(Ea);a.mul=b;a.sub=d});N(df);var ef=K(function(c,a){function b(a,b,c){var d=b[0],h=b[1],g=b[2],l=b[3],e=b[4];b=b[5];var k=c[0],t=c[1],V=c[2],w=c[3],y=c[4];c=c[5];a[0]=d*k+g*t;a[1]=h*k+l*t;a[2]=d*V+g*w;a[3]=h*V+l*w;a[4]=d*y+g*c+e;a[5]=h*y+l*c+b;return a}function d(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];return a}Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){var a=new e.ARRAY_TYPE(6);e.ARRAY_TYPE!=Float32Array&&
(a[1]=0,a[2]=0,a[4]=0,a[5]=0);a[0]=1;a[3]=1;return a};a.clone=function(a){var b=new e.ARRAY_TYPE(6);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b};a.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a};a.fromValues=function(a,b,c,d,n,p){var h=new e.ARRAY_TYPE(6);h[0]=a;h[1]=b;h[2]=c;h[3]=d;h[4]=n;h[5]=p;return h};a.set=function(a,b,c,d,e,p,l){a[0]=b;a[1]=c;a[2]=d;a[3]=
e;a[4]=p;a[5]=l;return a};a.invert=function(a,b){var c=b[0],d=b[1],e=b[2],g=b[3],l=b[4];b=b[5];var k=c*g-d*e;if(!k)return null;k=1/k;a[0]=g*k;a[1]=-d*k;a[2]=-e*k;a[3]=c*k;a[4]=(e*b-g*l)*k;a[5]=(d*l-c*b)*k;return a};a.determinant=function(a){return a[0]*a[3]-a[1]*a[2]};a.multiply=b;a.rotate=function(a,b,c){var d=b[0],h=b[1],e=b[2],l=b[3],g=b[4];b=b[5];var k=Math.sin(c);c=Math.cos(c);a[0]=d*c+e*k;a[1]=h*c+l*k;a[2]=d*-k+e*c;a[3]=h*-k+l*c;a[4]=g;a[5]=b;return a};a.scale=function(a,b,c){var d=b[1],h=b[2],
e=b[3],l=b[4],g=b[5],k=c[0];c=c[1];a[0]=b[0]*k;a[1]=d*k;a[2]=h*c;a[3]=e*c;a[4]=l;a[5]=g;return a};a.translate=function(a,b,c){var d=b[0],h=b[1],e=b[2],l=b[3],g=b[4];b=b[5];var k=c[0];c=c[1];a[0]=d;a[1]=h;a[2]=e;a[3]=l;a[4]=d*k+e*c+g;a[5]=h*k+l*c+b;return a};a.fromRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=-c;a[3]=b;a[4]=0;a[5]=0;return a};a.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=b[1];a[4]=0;a[5]=0;return a};a.fromTranslation=function(a,b){a[0]=1;a[1]=
0;a[2]=0;a[3]=1;a[4]=b[0];a[5]=b[1];return a};a.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};a.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];return a};a.subtract=d;a.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=
b[4]*c;a[5]=b[5]*c;return a};a.multiplyScalarAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;a[4]=b[4]+c[4]*d;a[5]=b[5]+c[5]*d;return a};a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]};a.equals=function(a,b){var c=a[0],d=a[1],g=a[2],k=a[3],l=a[4];a=a[5];var q=b[0],r=b[1],t=b[2],V=b[3],w=b[4];b=b[5];return Math.abs(c-q)<=e.EPSILON*Math.max(1,Math.abs(c),Math.abs(q))&&Math.abs(d-r)<=e.EPSILON*
Math.max(1,Math.abs(d),Math.abs(r))&&Math.abs(g-t)<=e.EPSILON*Math.max(1,Math.abs(g),Math.abs(t))&&Math.abs(k-V)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(V))&&Math.abs(l-w)<=e.EPSILON*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(a-b)<=e.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.sub=a.mul=void 0;var e=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=ba&&Z?Z(a,c):{};d.get||d.set?ba(b,c,d):b[c]=a[c]}b.default=a;return b}(Ea);
a.mul=b;a.sub=d});N(ef);var rd=K(function(c,a){function b(a,b,c){var d=b[0],h=b[1],e=b[2],l=b[3],g=b[4],k=b[5],t=b[6],V=b[7];b=b[8];var w=c[0],y=c[1],v=c[2],z=c[3],A=c[4],D=c[5],B=c[6],E=c[7];c=c[8];a[0]=w*d+y*l+v*t;a[1]=w*h+y*g+v*V;a[2]=w*e+y*k+v*b;a[3]=z*d+A*l+D*t;a[4]=z*h+A*g+D*V;a[5]=z*e+A*k+D*b;a[6]=B*d+E*l+c*t;a[7]=B*h+E*g+c*V;a[8]=B*e+E*k+c*b;return a}function d(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];a[6]=b[6]-c[6];a[7]=b[7]-c[7];a[8]=
b[8]-c[8];return a}Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){var a=new e.ARRAY_TYPE(9);e.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0);a[0]=1;a[4]=1;a[8]=1;return a};a.fromMat4=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a};a.clone=function(a){var b=new e.ARRAY_TYPE(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,
b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};a.fromValues=function(a,b,c,d,n,p,l,q,r){var h=new e.ARRAY_TYPE(9);h[0]=a;h[1]=b;h[2]=c;h[3]=d;h[4]=n;h[5]=p;h[6]=l;h[7]=q;h[8]=r;return h};a.set=function(a,b,c,d,e,p,l,q,r,t){a[0]=b;a[1]=c;a[2]=d;a[3]=e;a[4]=p;a[5]=l;a[6]=q;a[7]=r;a[8]=t;return a};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],
e=b[5];a[1]=b[3];a[2]=b[6];a[3]=c;a[5]=b[7];a[6]=d;a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a};a.invert=function(a,b){var c=b[0],d=b[1],e=b[2],g=b[3],l=b[4],q=b[5],k=b[6],t=b[7];b=b[8];var V=b*l-q*t,w=-b*g+q*k,y=t*g-l*k,v=c*V+d*w+e*y;if(!v)return null;v=1/v;a[0]=V*v;a[1]=(-b*d+e*t)*v;a[2]=(q*d-e*l)*v;a[3]=w*v;a[4]=(b*c-e*k)*v;a[5]=(-q*c+e*g)*v;a[6]=y*v;a[7]=(-t*c+d*k)*v;a[8]=(l*c-d*g)*v;return a};a.adjoint=function(a,b){var c=b[0],
d=b[1],e=b[2],g=b[3],l=b[4],q=b[5],k=b[6],t=b[7];b=b[8];a[0]=l*b-q*t;a[1]=e*t-d*b;a[2]=d*q-e*l;a[3]=q*k-g*b;a[4]=c*b-e*k;a[5]=e*g-c*q;a[6]=g*t-l*k;a[7]=d*k-c*t;a[8]=c*l-d*g;return a};a.determinant=function(a){var b=a[3],c=a[4],d=a[5],e=a[6],g=a[7],l=a[8];return a[0]*(l*c-d*g)+a[1]*(-l*b+d*e)+a[2]*(g*b-c*e)};a.multiply=b;a.translate=function(a,b,c){var d=b[0],h=b[1],e=b[2],l=b[3],q=b[4],g=b[5],t=b[6],k=b[7];b=b[8];var w=c[0];c=c[1];a[0]=d;a[1]=h;a[2]=e;a[3]=l;a[4]=q;a[5]=g;a[6]=w*d+c*l+t;a[7]=w*h+
c*q+k;a[8]=w*e+c*g+b;return a};a.rotate=function(a,b,c){var d=b[0],h=b[1],e=b[2],l=b[3],q=b[4],g=b[5],t=b[6],k=b[7];b=b[8];var w=Math.sin(c);c=Math.cos(c);a[0]=c*d+w*l;a[1]=c*h+w*q;a[2]=c*e+w*g;a[3]=c*l-w*d;a[4]=c*q-w*h;a[5]=c*g-w*e;a[6]=t;a[7]=k;a[8]=b;return a};a.scale=function(a,b,c){var d=c[0];c=c[1];a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=c*b[3];a[4]=c*b[4];a[5]=c*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};a.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=b[0];
a[7]=b[1];a[8]=1;return a};a.fromRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=0;a[3]=-c;a[4]=b;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=b[1];a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat2d=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a};a.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var g=c+c,l=d+d,q=e+e;c*=g;var r=d*g;d*=l;var t=e*g,k=e*l;
e*=q;g*=b;l*=b;b*=q;a[0]=1-d-e;a[3]=r-b;a[6]=t+l;a[1]=r+b;a[4]=1-c-e;a[7]=k-g;a[2]=t-l;a[5]=k+g;a[8]=1-c-d;return a};a.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],g=b[3],l=b[4],q=b[5],r=b[6],t=b[7],k=b[8],w=b[9],y=b[10],v=b[11],z=b[12],A=b[13],D=b[14];b=b[15];var B=c*q-d*l,E=c*r-e*l,I=c*t-g*l,G=d*r-e*q,u=d*t-g*q,Q=e*t-g*r,x=k*A-w*z,C=k*D-y*z;k=k*b-v*z;var F=w*D-y*A;w=w*b-v*A;y=y*b-v*D;v=B*y-E*w+I*F+G*k-u*C+Q*x;if(!v)return null;v=1/v;a[0]=(q*y-r*w+t*F)*v;a[1]=(r*k-l*y-t*C)*v;a[2]=(l*w-q*
k+t*x)*v;a[3]=(e*w-d*y-g*F)*v;a[4]=(c*y-e*k+g*C)*v;a[5]=(d*k-c*w-g*x)*v;a[6]=(A*Q-D*u+b*G)*v;a[7]=(D*I-z*Q-b*E)*v;a[8]=(z*u-A*I+b*B)*v;return a};a.projection=function(a,b,c){a[0]=2/b;a[1]=0;a[2]=0;a[3]=0;a[4]=-2/c;a[5]=0;a[6]=-1;a[7]=1;a[8]=1;return a};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],
2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};a.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];a[8]=b[8]+c[8];return a};a.subtract=d;a.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;return a};a.multiplyScalarAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;a[4]=
b[4]+c[4]*d;a[5]=b[5]+c[5]*d;a[6]=b[6]+c[6]*d;a[7]=b[7]+c[7]*d;a[8]=b[8]+c[8]*d;return a};a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]};a.equals=function(a,b){var c=a[0],d=a[1],g=a[2],k=a[3],l=a[4],q=a[5],r=a[6],t=a[7];a=a[8];var V=b[0],w=b[1],y=b[2],v=b[3],z=b[4],A=b[5],D=b[6],B=b[7];b=b[8];return Math.abs(c-V)<=e.EPSILON*Math.max(1,Math.abs(c),Math.abs(V))&&Math.abs(d-w)<=e.EPSILON*Math.max(1,
Math.abs(d),Math.abs(w))&&Math.abs(g-y)<=e.EPSILON*Math.max(1,Math.abs(g),Math.abs(y))&&Math.abs(k-v)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(v))&&Math.abs(l-z)<=e.EPSILON*Math.max(1,Math.abs(l),Math.abs(z))&&Math.abs(q-A)<=e.EPSILON*Math.max(1,Math.abs(q),Math.abs(A))&&Math.abs(r-D)<=e.EPSILON*Math.max(1,Math.abs(r),Math.abs(D))&&Math.abs(t-B)<=e.EPSILON*Math.max(1,Math.abs(t),Math.abs(B))&&Math.abs(a-b)<=e.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.sub=a.mul=void 0;var e=function(a){if(a&&
a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=ba&&Z?Z(a,c):{};d.get||d.set?ba(b,c,d):b[c]=a[c]}b.default=a;return b}(Ea);a.mul=b;a.sub=d});N(rd);var sd=K(function(c,a){function b(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}function d(a,b,c){var d=b[0],h=b[1],e=b[2],m=b[3],t=b[4],g=b[5],k=b[6],n=b[7],v=b[8],z=b[9],A=b[10],D=b[11],B=b[12],E=b[13],I=b[14];
b=b[15];var G=c[0],u=c[1],Q=c[2],x=c[3];a[0]=G*d+u*t+Q*v+x*B;a[1]=G*h+u*g+Q*z+x*E;a[2]=G*e+u*k+Q*A+x*I;a[3]=G*m+u*n+Q*D+x*b;G=c[4];u=c[5];Q=c[6];x=c[7];a[4]=G*d+u*t+Q*v+x*B;a[5]=G*h+u*g+Q*z+x*E;a[6]=G*e+u*k+Q*A+x*I;a[7]=G*m+u*n+Q*D+x*b;G=c[8];u=c[9];Q=c[10];x=c[11];a[8]=G*d+u*t+Q*v+x*B;a[9]=G*h+u*g+Q*z+x*E;a[10]=G*e+u*k+Q*A+x*I;a[11]=G*m+u*n+Q*D+x*b;G=c[12];u=c[13];Q=c[14];x=c[15];a[12]=G*d+u*t+Q*v+x*B;a[13]=G*h+u*g+Q*z+x*E;a[14]=G*e+u*k+Q*A+x*I;a[15]=G*m+u*n+Q*D+x*b;return a}function e(a,b,c){var d=
b[0],h=b[1],e=b[2],m=b[3],t=d+d,g=h+h,k=e+e;b=d*t;var n=d*g;d*=k;var v=h*g;h*=k;e*=k;t*=m;g*=m;m*=k;a[0]=1-(v+e);a[1]=n+m;a[2]=d-g;a[3]=0;a[4]=n-m;a[5]=1-(b+e);a[6]=h+t;a[7]=0;a[8]=d+g;a[9]=h-t;a[10]=1-(b+v);a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a}function g(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];a[6]=b[6]-c[6];a[7]=b[7]-c[7];a[8]=b[8]-c[8];a[9]=b[9]-c[9];a[10]=b[10]-c[10];a[11]=b[11]-c[11];a[12]=b[12]-c[12];a[13]=b[13]-c[13];
a[14]=b[14]-c[14];a[15]=b[15]-c[15];return a}Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){var a=new k.ARRAY_TYPE(16);k.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0);a[0]=1;a[5]=1;a[10]=1;a[15]=1;return a};a.clone=function(a){var b=new k.ARRAY_TYPE(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];
b[15]=a[15];return b};a.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};a.fromValues=function(a,b,c,d,e,q,r,t,g,w,y,v,z,A,D,B){var h=new k.ARRAY_TYPE(16);h[0]=a;h[1]=b;h[2]=c;h[3]=d;h[4]=e;h[5]=q;h[6]=r;h[7]=t;h[8]=g;h[9]=w;h[10]=y;h[11]=v;h[12]=z;h[13]=A;h[14]=D;h[15]=B;return h};a.set=function(a,b,c,d,e,q,r,t,g,k,y,v,z,A,D,B,E){a[0]=b;a[1]=c;a[2]=
d;a[3]=e;a[4]=q;a[5]=r;a[6]=t;a[7]=g;a[8]=k;a[9]=y;a[10]=v;a[11]=z;a[12]=A;a[13]=D;a[14]=B;a[15]=E;return a};a.identity=b;a.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],h=b[3],e=b[6],m=b[7],t=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=d;a[9]=e;a[11]=b[14];a[12]=h;a[13]=m;a[14]=t}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a};
a.invert=function(a,b){var c=b[0],d=b[1],h=b[2],e=b[3],r=b[4],t=b[5],m=b[6],g=b[7],k=b[8],v=b[9],z=b[10],A=b[11],D=b[12],B=b[13],E=b[14];b=b[15];var I=c*t-d*r,G=c*m-h*r,u=c*g-e*r,Q=d*m-h*t,x=d*g-e*t,C=h*g-e*m,F=k*B-v*D,J=k*E-z*D,K=k*b-A*D,L=v*E-z*B,M=v*b-A*B,N=z*b-A*E,H=I*N-G*M+u*L+Q*K-x*J+C*F;if(!H)return null;H=1/H;a[0]=(t*N-m*M+g*L)*H;a[1]=(h*M-d*N-e*L)*H;a[2]=(B*C-E*x+b*Q)*H;a[3]=(z*x-v*C-A*Q)*H;a[4]=(m*K-r*N-g*J)*H;a[5]=(c*N-h*K+e*J)*H;a[6]=(E*u-D*C-b*G)*H;a[7]=(k*C-z*u+A*G)*H;a[8]=(r*M-t*K+
g*F)*H;a[9]=(d*K-c*M-e*F)*H;a[10]=(D*x-B*u+b*I)*H;a[11]=(v*u-k*x-A*I)*H;a[12]=(t*J-r*L-m*F)*H;a[13]=(c*L-d*J+h*F)*H;a[14]=(B*G-D*Q-E*I)*H;a[15]=(k*Q-v*G+z*I)*H;return a};a.adjoint=function(a,b){var c=b[0],d=b[1],h=b[2],e=b[3],r=b[4],t=b[5],m=b[6],g=b[7],k=b[8],v=b[9],z=b[10],A=b[11],D=b[12],B=b[13],E=b[14];b=b[15];a[0]=t*(z*b-A*E)-v*(m*b-g*E)+B*(m*A-g*z);a[1]=-(d*(z*b-A*E)-v*(h*b-e*E)+B*(h*A-e*z));a[2]=d*(m*b-g*E)-t*(h*b-e*E)+B*(h*g-e*m);a[3]=-(d*(m*A-g*z)-t*(h*A-e*z)+v*(h*g-e*m));a[4]=-(r*(z*b-A*
E)-k*(m*b-g*E)+D*(m*A-g*z));a[5]=c*(z*b-A*E)-k*(h*b-e*E)+D*(h*A-e*z);a[6]=-(c*(m*b-g*E)-r*(h*b-e*E)+D*(h*g-e*m));a[7]=c*(m*A-g*z)-r*(h*A-e*z)+k*(h*g-e*m);a[8]=r*(v*b-A*B)-k*(t*b-g*B)+D*(t*A-g*v);a[9]=-(c*(v*b-A*B)-k*(d*b-e*B)+D*(d*A-e*v));a[10]=c*(t*b-g*B)-r*(d*b-e*B)+D*(d*g-e*t);a[11]=-(c*(t*A-g*v)-r*(d*A-e*v)+k*(d*g-e*t));a[12]=-(r*(v*E-z*B)-k*(t*E-m*B)+D*(t*z-m*v));a[13]=c*(v*E-z*B)-k*(d*E-h*B)+D*(d*z-h*v);a[14]=-(c*(t*E-m*B)-r*(d*E-h*B)+D*(d*m-h*t));a[15]=c*(t*z-m*v)-r*(d*z-h*v)+k*(d*m-h*t);return a};
a.determinant=function(a){var b=a[0],c=a[1],d=a[2],h=a[3],e=a[4],r=a[5],t=a[6],g=a[7],k=a[8],y=a[9],v=a[10],z=a[11],A=a[12],D=a[13],B=a[14];a=a[15];return(b*r-c*e)*(v*a-z*B)-(b*t-d*e)*(y*a-z*D)+(b*g-h*e)*(y*B-v*D)+(c*t-d*r)*(k*a-z*A)-(c*g-h*r)*(k*B-v*A)+(d*g-h*t)*(k*D-y*A)};a.multiply=d;a.translate=function(a,b,c){var d=c[0],h=c[1];c=c[2];if(b===a)a[12]=b[0]*d+b[4]*h+b[8]*c+b[12],a[13]=b[1]*d+b[5]*h+b[9]*c+b[13],a[14]=b[2]*d+b[6]*h+b[10]*c+b[14],a[15]=b[3]*d+b[7]*h+b[11]*c+b[15];else{var e=b[0];var r=
b[1];var t=b[2];var g=b[3];var m=b[4];var k=b[5];var v=b[6];var n=b[7];var A=b[8];var D=b[9];var B=b[10];var E=b[11];a[0]=e;a[1]=r;a[2]=t;a[3]=g;a[4]=m;a[5]=k;a[6]=v;a[7]=n;a[8]=A;a[9]=D;a[10]=B;a[11]=E;a[12]=e*d+m*h+A*c+b[12];a[13]=r*d+k*h+D*c+b[13];a[14]=t*d+v*h+B*c+b[14];a[15]=g*d+n*h+E*c+b[15]}return a};a.scale=function(a,b,c){var d=c[0],h=c[1];c=c[2];a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;a[4]=b[4]*h;a[5]=b[5]*h;a[6]=b[6]*h;a[7]=b[7]*h;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*
c;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};a.rotate=function(a,b,c,d){var e=d[0],h=d[1];d=d[2];var r=Math.sqrt(e*e+h*h+d*d);if(r<k.EPSILON)return null;r=1/r;e*=r;h*=r;d*=r;var t=Math.sin(c);var g=Math.cos(c);var m=1-g;c=b[0];r=b[1];var n=b[2];var v=b[3];var p=b[4];var A=b[5];var D=b[6];var B=b[7];var E=b[8];var I=b[9];var G=b[10];var u=b[11];var Q=e*e*m+g;var x=h*e*m+d*t;var C=d*e*m-h*t;var F=e*h*m-d*t;var H=h*h*m+g;var J=d*h*m+e*t;var K=e*d*m+h*t;e=h*d*m-e*t;h=d*d*m+g;a[0]=c*Q+p*
x+E*C;a[1]=r*Q+A*x+I*C;a[2]=n*Q+D*x+G*C;a[3]=v*Q+B*x+u*C;a[4]=c*F+p*H+E*J;a[5]=r*F+A*H+I*J;a[6]=n*F+D*H+G*J;a[7]=v*F+B*H+u*J;a[8]=c*K+p*e+E*h;a[9]=r*K+A*e+I*h;a[10]=n*K+D*e+G*h;a[11]=v*K+B*e+u*h;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);return a};a.rotateX=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);var e=b[4],h=b[5],r=b[6],t=b[7],g=b[8],k=b[9],m=b[10],v=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=e*c+g*d;a[5]=h*c+
k*d;a[6]=r*c+m*d;a[7]=t*c+v*d;a[8]=g*c-e*d;a[9]=k*c-h*d;a[10]=m*c-r*d;a[11]=v*c-t*d;return a};a.rotateY=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);var e=b[0],h=b[1],r=b[2],t=b[3],g=b[8],k=b[9],m=b[10],v=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=e*c-g*d;a[1]=h*c-k*d;a[2]=r*c-m*d;a[3]=t*c-v*d;a[8]=e*d+g*c;a[9]=h*d+k*c;a[10]=r*d+m*c;a[11]=t*d+v*c;return a};a.rotateZ=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);var e=b[0],h=b[1],
r=b[2],t=b[3],g=b[4],k=b[5],m=b[6],v=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=e*c+g*d;a[1]=h*c+k*d;a[2]=r*c+m*d;a[3]=t*c+v*d;a[4]=g*c-e*d;a[5]=k*c-h*d;a[6]=m*c-r*d;a[7]=v*c-t*d;return a};a.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};a.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b[1];
a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.fromRotation=function(a,b,c){var d=c[0],e=c[1];c=c[2];var h=Math.sqrt(d*d+e*e+c*c);if(h<k.EPSILON)return null;h=1/h;d*=h;e*=h;c*=h;h=Math.sin(b);b=Math.cos(b);var r=1-b;a[0]=d*d*r+b;a[1]=e*d*r+c*h;a[2]=c*d*r-e*h;a[3]=0;a[4]=d*e*r-c*h;a[5]=e*e*r+b;a[6]=c*e*r+d*h;a[7]=0;a[8]=d*c*r+e*h;a[9]=e*c*r-d*h;a[10]=c*c*r+b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.fromXRotation=function(a,b){var c=Math.sin(b);
b=Math.cos(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=c;a[7]=0;a[8]=0;a[9]=-c;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.fromYRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=0;a[2]=-c;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=c;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.fromZRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=0;a[3]=0;a[4]=-c;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=
0;a[15]=1;return a};a.fromRotationTranslation=e;a.fromQuat2=function(a,b){var c=new k.ARRAY_TYPE(3),d=-b[0],h=-b[1],q=-b[2],r=b[3],t=b[4],g=b[5],m=b[6],y=b[7],v=d*d+h*h+q*q+r*r;0<v?(c[0]=2*(t*r+y*d+g*q-m*h)/v,c[1]=2*(g*r+y*h+m*d-t*q)/v,c[2]=2*(m*r+y*q+t*h-g*d)/v):(c[0]=2*(t*r+y*d+g*q-m*h),c[1]=2*(g*r+y*h+m*d-t*q),c[2]=2*(m*r+y*q+t*h-g*d));e(a,b,c);return a};a.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a};a.getScaling=function(a,b){var c=b[0],d=b[1],e=b[2],h=b[4],r=b[5],t=
b[6],g=b[8],k=b[9];b=b[10];a[0]=Math.sqrt(c*c+d*d+e*e);a[1]=Math.sqrt(h*h+r*r+t*t);a[2]=Math.sqrt(g*g+k*k+b*b);return a};a.getRotation=function(a,b){var c=b[0]+b[5]+b[10];0<c?(c=2*Math.sqrt(c+1),a[3]=.25*c,a[0]=(b[6]-b[9])/c,a[1]=(b[8]-b[2])/c,a[2]=(b[1]-b[4])/c):b[0]>b[5]&&b[0]>b[10]?(c=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/c,a[0]=.25*c,a[1]=(b[1]+b[4])/c,a[2]=(b[8]+b[2])/c):b[5]>b[10]?(c=2*Math.sqrt(1+b[5]-b[0]-b[10]),a[3]=(b[8]-b[2])/c,a[0]=(b[1]+b[4])/c,a[1]=.25*c,a[2]=(b[6]+b[9])/c):
(c=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/c,a[0]=(b[8]+b[2])/c,a[1]=(b[6]+b[9])/c,a[2]=.25*c);return a};a.fromRotationTranslationScale=function(a,b,c,d){var e=b[0],h=b[1],r=b[2],t=b[3],g=e+e,k=h+h,m=r+r;b=e*g;var v=e*k;e*=m;var n=h*k;h*=m;r*=m;g*=t;k*=t;t*=m;m=d[0];var p=d[1];d=d[2];a[0]=(1-(n+r))*m;a[1]=(v+t)*m;a[2]=(e-k)*m;a[3]=0;a[4]=(v-t)*p;a[5]=(1-(b+r))*p;a[6]=(h+g)*p;a[7]=0;a[8]=(e+k)*d;a[9]=(h-g)*d;a[10]=(1-(b+n))*d;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};a.fromRotationTranslationScaleOrigin=
function(a,b,c,d,e){var l=b[0],h=b[1],t=b[2],g=b[3],k=l+l,m=h+h,v=t+t;b=l*k;var n=l*m,p=l*v;l=h*m;h*=v;var D=t*v;t=g*k;m*=g;var B=g*v,E=d[0],I=d[1];v=d[2];d=e[0];g=e[1];e=e[2];k=(1-(l+D))*E;var G=(n+B)*E;E*=p-m;n=(n-B)*I;D=(1-(b+D))*I;I*=h+t;p=(p+m)*v;h=(h-t)*v;b=(1-(b+l))*v;a[0]=k;a[1]=G;a[2]=E;a[3]=0;a[4]=n;a[5]=D;a[6]=I;a[7]=0;a[8]=p;a[9]=h;a[10]=b;a[11]=0;a[12]=c[0]+d-(k*d+n*g+p*e);a[13]=c[1]+g-(G*d+D*g+h*e);a[14]=c[2]+e-(E*d+I*g+b*e);a[15]=1;return a};a.fromQuat=function(a,b){var c=b[0],d=b[1],
e=b[2];b=b[3];var h=c+c,g=d+d,t=e+e;c*=h;var k=d*h;d*=g;var m=e*h,y=e*g;e*=t;h*=b;g*=b;b*=t;a[0]=1-d-e;a[1]=k+b;a[2]=m-g;a[3]=0;a[4]=k-b;a[5]=1-c-e;a[6]=y+h;a[7]=0;a[8]=m+g;a[9]=y-h;a[10]=1-c-d;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.frustum=function(a,b,c,d,e,q,g){var l=1/(c-b),h=1/(e-d),r=1/(q-g);a[0]=2*q*l;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*q*h;a[6]=0;a[7]=0;a[8]=(c+b)*l;a[9]=(e+d)*h;a[10]=(g+q)*r;a[11]=-1;a[12]=0;a[13]=0;a[14]=g*q*2*r;a[15]=0;return a};a.perspective=function(a,b,c,
d,e){b=1/Math.tan(b/2);a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[11]=-1;a[12]=0;a[13]=0;a[15]=0;null!=e&&Infinity!==e?(c=1/(d-e),a[10]=(e+d)*c,a[14]=2*e*d*c):(a[10]=-1,a[14]=-2*d);return a};a.perspectiveFromFieldOfView=function(a,b,c,d){var e=Math.tan(b.upDegrees*Math.PI/180),h=Math.tan(b.downDegrees*Math.PI/180),g=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*Math.PI/180);var t=2/(g+b),k=2/(e+h);a[0]=t;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=k;a[6]=0;a[7]=
0;a[8]=-((g-b)*t*.5);a[9]=(e-h)*k*.5;a[10]=d/(c-d);a[11]=-1;a[12]=0;a[13]=0;a[14]=d*c/(c-d);a[15]=0;return a};a.ortho=function(a,b,c,d,e,g,r){var l=1/(b-c),h=1/(d-e),q=1/(g-r);a[0]=-2*l;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*h;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*q;a[11]=0;a[12]=(b+c)*l;a[13]=(e+d)*h;a[14]=(r+g)*q;a[15]=1;return a};a.lookAt=function(a,c,d,e){var l=c[0],h=c[1];c=c[2];var g=e[0];var t=e[1];var m=e[2];var w=d[0];e=d[1];var y=d[2];if(Math.abs(l-w)<k.EPSILON&&Math.abs(h-e)<k.EPSILON&&Math.abs(c-
y)<k.EPSILON)return b(a);d=l-w;e=h-e;w=c-y;var v=1/Math.sqrt(d*d+e*e+w*w);d*=v;e*=v;w*=v;y=t*w-m*e;m=m*d-g*w;g=g*e-t*d;(v=Math.sqrt(y*y+m*m+g*g))?(v=1/v,y*=v,m*=v,g*=v):g=m=y=0;t=e*g-w*m;var n=w*y-d*g;var p=d*m-e*y;(v=Math.sqrt(t*t+n*n+p*p))?(v=1/v,t*=v,n*=v,p*=v):p=n=t=0;a[0]=y;a[1]=t;a[2]=d;a[3]=0;a[4]=m;a[5]=n;a[6]=e;a[7]=0;a[8]=g;a[9]=p;a[10]=w;a[11]=0;a[12]=-(y*l+m*h+g*c);a[13]=-(t*l+n*h+p*c);a[14]=-(d*l+e*h+w*c);a[15]=1;return a};a.targetTo=function(a,b,c,d){var e=b[0],h=b[1];b=b[2];var g=d[0],
t=d[1],k=d[2];d=e-c[0];var m=h-c[1];c=b-c[2];var y=d*d+m*m+c*c;0<y&&(y=1/Math.sqrt(y),d*=y,m*=y,c*=y);var v=t*c-k*m;k=k*d-g*c;g=g*m-t*d;y=v*v+k*k+g*g;0<y&&(y=1/Math.sqrt(y),v*=y,k*=y,g*=y);a[0]=v;a[1]=k;a[2]=g;a[3]=0;a[4]=m*g-c*k;a[5]=c*v-d*g;a[6]=d*k-m*v;a[7]=0;a[8]=d;a[9]=m;a[10]=c;a[11]=0;a[12]=e;a[13]=h;a[14]=b;a[15]=1;return a};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+
", "+a[14]+", "+a[15]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};a.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];a[8]=b[8]+c[8];a[9]=
b[9]+c[9];a[10]=b[10]+c[10];a[11]=b[11]+c[11];a[12]=b[12]+c[12];a[13]=b[13]+c[13];a[14]=b[14]+c[14];a[15]=b[15]+c[15];return a};a.subtract=g;a.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12]*c;a[13]=b[13]*c;a[14]=b[14]*c;a[15]=b[15]*c;return a};a.multiplyScalarAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;a[4]=
b[4]+c[4]*d;a[5]=b[5]+c[5]*d;a[6]=b[6]+c[6]*d;a[7]=b[7]+c[7]*d;a[8]=b[8]+c[8]*d;a[9]=b[9]+c[9]*d;a[10]=b[10]+c[10]*d;a[11]=b[11]+c[11]*d;a[12]=b[12]+c[12]*d;a[13]=b[13]+c[13]*d;a[14]=b[14]+c[14]*d;a[15]=b[15]+c[15]*d;return a};a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};a.equals=function(a,
b){var c=a[0],d=a[1],e=a[2],g=a[3],h=a[4],t=a[5],V=a[6],m=a[7],y=a[8],v=a[9],z=a[10],A=a[11],D=a[12],B=a[13],E=a[14];a=a[15];var I=b[0],G=b[1],u=b[2],x=b[3],C=b[4],F=b[5],H=b[6],J=b[7],K=b[8],L=b[9],M=b[10],N=b[11],O=b[12],P=b[13],R=b[14];b=b[15];return Math.abs(c-I)<=k.EPSILON*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(d-G)<=k.EPSILON*Math.max(1,Math.abs(d),Math.abs(G))&&Math.abs(e-u)<=k.EPSILON*Math.max(1,Math.abs(e),Math.abs(u))&&Math.abs(g-x)<=k.EPSILON*Math.max(1,Math.abs(g),Math.abs(x))&&
Math.abs(h-C)<=k.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(t-F)<=k.EPSILON*Math.max(1,Math.abs(t),Math.abs(F))&&Math.abs(V-H)<=k.EPSILON*Math.max(1,Math.abs(V),Math.abs(H))&&Math.abs(m-J)<=k.EPSILON*Math.max(1,Math.abs(m),Math.abs(J))&&Math.abs(y-K)<=k.EPSILON*Math.max(1,Math.abs(y),Math.abs(K))&&Math.abs(v-L)<=k.EPSILON*Math.max(1,Math.abs(v),Math.abs(L))&&Math.abs(z-M)<=k.EPSILON*Math.max(1,Math.abs(z),Math.abs(M))&&Math.abs(A-N)<=k.EPSILON*Math.max(1,Math.abs(A),Math.abs(N))&&Math.abs(D-
O)<=k.EPSILON*Math.max(1,Math.abs(D),Math.abs(O))&&Math.abs(B-P)<=k.EPSILON*Math.max(1,Math.abs(B),Math.abs(P))&&Math.abs(E-R)<=k.EPSILON*Math.max(1,Math.abs(E),Math.abs(R))&&Math.abs(a-b)<=k.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.sub=a.mul=void 0;var k=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=ba&&Z?Z(a,c):{};d.get||d.set?ba(b,c,d):b[c]=a[c]}b.default=a;return b}(Ea);a.mul=d;a.sub=g});N(sd);var td=K(function(c,
a){function b(){var a=new r.ARRAY_TYPE(3);r.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0);return a}function d(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)}function e(a,b,c){var d=new r.ARRAY_TYPE(3);d[0]=a;d[1]=b;d[2]=c;return d}function g(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];return a}function k(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];return a}function h(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];return a}function m(a,b){var c=b[0]-a[0],d=b[1]-a[1];
a=b[2]-a[2];return Math.sqrt(c*c+d*d+a*a)}function n(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return c*c+d*d+a*a}function p(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a}function l(a,b){var c=b[0],d=b[1],e=b[2];c=c*c+d*d+e*e;0<c&&(c=1/Math.sqrt(c));a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a}function q(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}Object.defineProperty(a,"__esModule",{value:!0});a.create=b;a.clone=function(a){var b=new r.ARRAY_TYPE(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.length=
d;a.fromValues=e;a.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a};a.set=function(a,b,c,d){a[0]=b;a[1]=c;a[2]=d;return a};a.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];return a};a.subtract=g;a.multiply=k;a.divide=h;a.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);a[2]=Math.ceil(b[2]);return a};a.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);a[2]=Math.floor(b[2]);return a};a.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],
c[1]);a[2]=Math.min(b[2],c[2]);return a};a.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);return a};a.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);a[2]=Math.round(b[2]);return a};a.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a};a.scaleAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;return a};a.distance=m;a.squaredDistance=n;a.squaredLength=p;a.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];
a[2]=-b[2];return a};a.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];return a};a.normalize=l;a.dot=q;a.cross=function(a,b,c){var d=b[0],e=b[1];b=b[2];var l=c[0],g=c[1];c=c[2];a[0]=e*c-b*g;a[1]=b*l-d*c;a[2]=d*g-e*l;return a};a.lerp=function(a,b,c,d){var e=b[0],l=b[1];b=b[2];a[0]=e+d*(c[0]-e);a[1]=l+d*(c[1]-l);a[2]=b+d*(c[2]-b);return a};a.hermite=function(a,b,c,d,e,l){var g=l*l,h=g*(2*l-3)+1,q=g*(l-2)+l,k=g*(l-1);l=g*(3-2*l);a[0]=b[0]*h+c[0]*q+d[0]*k+e[0]*l;a[1]=b[1]*h+c[1]*q+d[1]*k+e[1]*
l;a[2]=b[2]*h+c[2]*q+d[2]*k+e[2]*l;return a};a.bezier=function(a,b,c,d,e,l){var g=1-l,h=g*g,q=l*l,k=h*g;h*=3*l;g*=3*q;l*=q;a[0]=b[0]*k+c[0]*h+d[0]*g+e[0]*l;a[1]=b[1]*k+c[1]*h+d[1]*g+e[1]*l;a[2]=b[2]*k+c[2]*h+d[2]*g+e[2]*l;return a};a.random=function(a,b){b=b||1;var c=2*r.RANDOM()*Math.PI,d=2*r.RANDOM()-1,e=Math.sqrt(1-d*d)*b;a[0]=Math.cos(c)*e;a[1]=Math.sin(c)*e;a[2]=d*b;return a};a.transformMat4=function(a,b,c){var d=b[0],e=b[1];b=b[2];var l=c[3]*d+c[7]*e+c[11]*b+c[15];l=l||1;a[0]=(c[0]*d+c[4]*e+
c[8]*b+c[12])/l;a[1]=(c[1]*d+c[5]*e+c[9]*b+c[13])/l;a[2]=(c[2]*d+c[6]*e+c[10]*b+c[14])/l;return a};a.transformMat3=function(a,b,c){var d=b[0],e=b[1];b=b[2];a[0]=d*c[0]+e*c[3]+b*c[6];a[1]=d*c[1]+e*c[4]+b*c[7];a[2]=d*c[2]+e*c[5]+b*c[8];return a};a.transformQuat=function(a,b,c){var d=c[0],e=c[1],l=c[2],g=b[0],h=b[1];b=b[2];var q=e*b-l*h,k=l*g-d*b,r=d*h-e*g;c=2*c[3];a[0]=g+q*c+2*(e*r-l*k);a[1]=h+k*c+2*(l*q-d*r);a[2]=b+r*c+2*(d*k-e*q);return a};a.rotateX=function(a,b,c,d){var e=[],l=[];e[0]=b[0]-c[0];
e[1]=b[1]-c[1];e[2]=b[2]-c[2];l[0]=e[0];l[1]=e[1]*Math.cos(d)-e[2]*Math.sin(d);l[2]=e[1]*Math.sin(d)+e[2]*Math.cos(d);a[0]=l[0]+c[0];a[1]=l[1]+c[1];a[2]=l[2]+c[2];return a};a.rotateY=function(a,b,c,d){var e=[],l=[];e[0]=b[0]-c[0];e[1]=b[1]-c[1];e[2]=b[2]-c[2];l[0]=e[2]*Math.sin(d)+e[0]*Math.cos(d);l[1]=e[1];l[2]=e[2]*Math.cos(d)-e[0]*Math.sin(d);a[0]=l[0]+c[0];a[1]=l[1]+c[1];a[2]=l[2]+c[2];return a};a.rotateZ=function(a,b,c,d){var e=[],l=[];e[0]=b[0]-c[0];e[1]=b[1]-c[1];e[2]=b[2]-c[2];l[0]=e[0]*Math.cos(d)-
e[1]*Math.sin(d);l[1]=e[0]*Math.sin(d)+e[1]*Math.cos(d);l[2]=e[2];a[0]=l[0]+c[0];a[1]=l[1]+c[1];a[2]=l[2]+c[2];return a};a.angle=function(a,b){a=e(a[0],a[1],a[2]);b=e(b[0],b[1],b[2]);l(a,a);l(b,b);b=q(a,b);return 1<b?0:-1>b?Math.PI:Math.acos(b)};a.zero=function(a){a[0]=0;a[1]=0;a[2]=0;return a};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]};a.equals=function(a,b){var c=a[0],d=a[1];a=a[2];var e=b[0],l=b[1];b=b[2];
return Math.abs(c-e)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(e))&&Math.abs(d-l)<=r.EPSILON*Math.max(1,Math.abs(d),Math.abs(l))&&Math.abs(a-b)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.forEach=a.sqrLen=a.len=a.sqrDist=a.dist=a.div=a.mul=a.sub=void 0;var r=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=ba&&Z?Z(a,c):{};d.get||d.set?ba(b,c,d):b[c]=a[c]}b.default=a;return b}(Ea);a.sub=g;a.mul=k;a.div=h;a.dist=m;
a.sqrDist=n;a.len=d;a.sqrLen=p;c=function(){var a=b();return function(b,c,d,e,l,g){c||(c=3);d||(d=0);for(e=e?Math.min(e*c+d,b.length):b.length;d<e;d+=c)a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],l(a,a,g),b[d]=a[0],b[d+1]=a[1],b[d+2]=a[2];return b}}();a.forEach=c});N(td);var ud=K(function(c,a){function b(){var a=new p.ARRAY_TYPE(4);p.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0);return a}function d(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];return a}function e(a,b,c){a[0]=
b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];a[3]=b[3]*c[3];return a}function g(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];a[3]=b[3]/c[3];return a}function k(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];a=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+a*a)}function h(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];a=b[3]-a[3];return c*c+d*d+e*e+a*a}function m(a){var b=a[0],c=a[1],d=a[2];a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)}function n(a){var b=a[0],c=a[1],d=a[2];a=a[3];return b*b+c*c+d*d+a*a}Object.defineProperty(a,
"__esModule",{value:!0});a.create=b;a.clone=function(a){var b=new p.ARRAY_TYPE(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.fromValues=function(a,b,c,d){var e=new p.ARRAY_TYPE(4);e[0]=a;e[1]=b;e[2]=c;e[3]=d;return e};a.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a};a.set=function(a,b,c,d,e){a[0]=b;a[1]=c;a[2]=d;a[3]=e;return a};a.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];return a};a.subtract=d;a.multiply=e;a.divide=g;a.ceil=function(a,
b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);a[2]=Math.ceil(b[2]);a[3]=Math.ceil(b[3]);return a};a.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);a[2]=Math.floor(b[2]);a[3]=Math.floor(b[3]);return a};a.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);a[3]=Math.min(b[3],c[3]);return a};a.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);a[3]=Math.max(b[3],c[3]);return a};a.round=function(a,b){a[0]=
Math.round(b[0]);a[1]=Math.round(b[1]);a[2]=Math.round(b[2]);a[3]=Math.round(b[3]);return a};a.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;return a};a.scaleAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;return a};a.distance=k;a.squaredDistance=h;a.length=m;a.squaredLength=n;a.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=-b[3];return a};a.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];a[3]=1/b[3];return a};
a.normalize=function(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var l=c*c+d*d+e*e+b*b;0<l&&(l=1/Math.sqrt(l));a[0]=c*l;a[1]=d*l;a[2]=e*l;a[3]=b*l;return a};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};a.cross=function(a,b,c,d){var e=c[0]*d[1]-c[1]*d[0],l=c[0]*d[2]-c[2]*d[0],g=c[0]*d[3]-c[3]*d[0],h=c[1]*d[2]-c[2]*d[1],k=c[1]*d[3]-c[3]*d[1];c=c[2]*d[3]-c[3]*d[2];d=b[0];var q=b[1],r=b[2];b=b[3];a[0]=q*c-r*k+b*h;a[1]=-(d*c)+r*g-b*l;a[2]=d*k-q*g+b*e;a[3]=-(d*h)+q*l-r*e;return a};a.lerp=
function(a,b,c,d){var e=b[0],l=b[1],g=b[2];b=b[3];a[0]=e+d*(c[0]-e);a[1]=l+d*(c[1]-l);a[2]=g+d*(c[2]-g);a[3]=b+d*(c[3]-b);return a};a.random=function(a,b){b=b||1;do{var c=2*p.RANDOM()-1;var d=2*p.RANDOM()-1;var e=c*c+d*d}while(1<=e);do{var l=2*p.RANDOM()-1;var g=2*p.RANDOM()-1;var h=l*l+g*g}while(1<=h);e=Math.sqrt((1-e)/h);a[0]=b*c;a[1]=b*d;a[2]=b*l*e;a[3]=b*g*e;return a};a.transformMat4=function(a,b,c){var d=b[0],e=b[1],l=b[2];b=b[3];a[0]=c[0]*d+c[4]*e+c[8]*l+c[12]*b;a[1]=c[1]*d+c[5]*e+c[9]*l+c[13]*
b;a[2]=c[2]*d+c[6]*e+c[10]*l+c[14]*b;a[3]=c[3]*d+c[7]*e+c[11]*l+c[15]*b;return a};a.transformQuat=function(a,b,c){var d=b[0],e=b[1],l=b[2],g=c[0],h=c[1],k=c[2];c=c[3];var q=c*d+h*l-k*e,r=c*e+k*d-g*l,m=c*l+g*e-h*d;d=-g*d-h*e-k*l;a[0]=q*c+d*-g+r*-k-m*-h;a[1]=r*c+d*-h+m*-g-q*-k;a[2]=m*c+d*-k+q*-h-r*-g;a[3]=b[3];return a};a.zero=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===
b[1]&&a[2]===b[2]&&a[3]===b[3]};a.equals=function(a,b){var c=a[0],d=a[1],e=a[2];a=a[3];var l=b[0],g=b[1],h=b[2];b=b[3];return Math.abs(c-l)<=p.EPSILON*Math.max(1,Math.abs(c),Math.abs(l))&&Math.abs(d-g)<=p.EPSILON*Math.max(1,Math.abs(d),Math.abs(g))&&Math.abs(e-h)<=p.EPSILON*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(a-b)<=p.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.forEach=a.sqrLen=a.len=a.sqrDist=a.dist=a.div=a.mul=a.sub=void 0;var p=function(a){if(a&&a.__esModule)return a;var b={};if(null!=
a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=ba&&Z?Z(a,c):{};d.get||d.set?ba(b,c,d):b[c]=a[c]}b.default=a;return b}(Ea);a.sub=d;a.mul=e;a.div=g;a.dist=k;a.sqrDist=h;a.len=m;a.sqrLen=n;c=function(){var a=b();return function(b,c,d,e,l,g){c||(c=4);d||(d=0);for(e=e?Math.min(e*c+d,b.length):b.length;d<e;d+=c)a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],a[3]=b[d+3],l(a,a,g),b[d]=a[0],b[d+1]=a[1],b[d+2]=a[2],b[d+3]=a[3];return b}}();a.forEach=c});N(ud);var vd=K(function(c,a){function b(a){if(a&&
a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=ba&&Z?Z(a,c):{};d.get||d.set?ba(b,c,d):b[c]=a[c]}b.default=a;return b}function d(){var a=new m.ARRAY_TYPE(4);m.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0);a[3]=1;return a}function e(a,b,c){c*=.5;var d=Math.sin(c);a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=Math.cos(c);return a}function g(a,b,c){var d=b[0],e=b[1],l=b[2];b=b[3];var g=c[0],h=c[1],k=c[2];c=c[3];a[0]=d*c+b*g+e*k-l*h;a[1]=e*c+
b*h+l*g-d*k;a[2]=l*c+b*k+d*h-e*g;a[3]=b*c-d*g-e*h-l*k;return a}function k(a,b,c,d){var e=b[0],l=b[1],g=b[2];b=b[3];var h=c[0],k=c[1],q=c[2];c=c[3];var r=e*h+l*k+g*q+b*c;0>r&&(r=-r,h=-h,k=-k,q=-q,c=-c);if(1-r>m.EPSILON){var t=Math.acos(r);var n=Math.sin(t);r=Math.sin((1-d)*t)/n;d=Math.sin(d*t)/n}else r=1-d;a[0]=r*e+d*h;a[1]=r*l+d*k;a[2]=r*g+d*q;a[3]=r*b+d*c;return a}function h(a,b){var c=b[0]+b[4]+b[8];if(0<c)c=Math.sqrt(c+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*
c;else{var d=0;b[4]>b[0]&&(d=1);b[8]>b[3*d+d]&&(d=2);var e=(d+1)%3,l=(d+2)%3;c=Math.sqrt(b[3*d+d]-b[3*e+e]-b[3*l+l]+1);a[d]=.5*c;c=.5/c;a[3]=(b[3*e+l]-b[3*l+e])*c;a[e]=(b[3*e+d]+b[3*d+e])*c;a[l]=(b[3*l+d]+b[3*d+l])*c}return a}Object.defineProperty(a,"__esModule",{value:!0});a.create=d;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=e;a.getAxisAngle=function(a,b){var c=2*Math.acos(b[3]),d=Math.sin(c/2);d>m.EPSILON?(a[0]=b[0]/d,a[1]=b[1]/d,a[2]=b[2]/d):(a[0]=1,a[1]=0,a[2]=
0);return c};a.multiply=g;a.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],l=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c+b*g;a[1]=e*c+l*g;a[2]=l*c-e*g;a[3]=b*c-d*g;return a};a.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],l=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c-l*g;a[1]=e*c+b*g;a[2]=l*c+d*g;a[3]=b*c-e*g;return a};a.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],l=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c+e*g;a[1]=e*c-d*g;a[2]=l*c+b*g;a[3]=b*c-l*g;return a};a.calculateW=
function(a,b){var c=b[0],d=b[1];b=b[2];a[0]=c;a[1]=d;a[2]=b;a[3]=Math.sqrt(Math.abs(1-c*c-d*d-b*b));return a};a.slerp=k;a.random=function(a){var b=m.RANDOM(),c=m.RANDOM(),d=m.RANDOM(),e=Math.sqrt(1-b);b=Math.sqrt(b);a[0]=e*Math.sin(2*Math.PI*c);a[1]=e*Math.cos(2*Math.PI*c);a[2]=b*Math.sin(2*Math.PI*d);a[3]=b*Math.cos(2*Math.PI*d);return a};a.invert=function(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var l=c*c+d*d+e*e+b*b;l=l?1/l:0;a[0]=-c*l;a[1]=-d*l;a[2]=-e*l;a[3]=b*l;return a};a.conjugate=function(a,
b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a};a.fromMat3=h;a.fromEuler=function(a,b,c,d){var e=.5*Math.PI/180;b*=e;c*=e;d*=e;e=Math.sin(b);b=Math.cos(b);var l=Math.sin(c);c=Math.cos(c);var g=Math.sin(d);d=Math.cos(d);a[0]=e*c*d-b*l*g;a[1]=b*l*d+e*c*g;a[2]=b*c*g-e*l*d;a[3]=b*c*d+e*l*g;return a};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};a.setAxes=a.sqlerp=a.rotationTo=a.equals=a.exactEquals=a.normalize=a.sqrLen=a.squaredLength=a.len=a.length=a.lerp=a.dot=a.scale=
a.mul=a.add=a.set=a.copy=a.fromValues=a.clone=void 0;var m=b(Ea),n=b(rd),p=b(td);c=b(ud);a.clone=c.clone;a.fromValues=c.fromValues;a.copy=c.copy;a.set=c.set;a.add=c.add;a.mul=g;a.scale=c.scale;a.dot=c.dot;a.lerp=c.lerp;var l=c.length;a.length=l;a.len=l;l=c.squaredLength;a.squaredLength=l;a.sqrLen=l;var q=c.normalize;a.normalize=q;a.exactEquals=c.exactEquals;a.equals=c.equals;c=function(){var a=p.create(),b=p.fromValues(1,0,0),c=p.fromValues(0,1,0);return function(d,l,g){var h=p.dot(l,g);if(-.999999>
h)return p.cross(a,b,l),1E-6>p.len(a)&&p.cross(a,c,l),p.normalize(a,a),e(d,a,Math.PI),d;if(.999999<h)return d[0]=0,d[1]=0,d[2]=0,d[3]=1,d;p.cross(a,l,g);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=1+h;return q(d,d)}}();a.rotationTo=c;c=function(){var a=d(),b=d();return function(c,d,e,l,g,h){k(a,d,g,h);k(b,e,l,h);k(c,a,b,2*h*(1-h));return c}}();a.sqlerp=c;c=function(){var a=n.create();return function(b,c,d,e){a[0]=d[0];a[3]=d[1];a[6]=d[2];a[1]=e[0];a[4]=e[1];a[7]=e[2];a[2]=-c[0];a[5]=-c[1];a[8]=-c[2];return q(b,
h(b,a))}}();a.setAxes=c});N(vd);var ff=K(function(c,a){function b(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=ba&&Z?Z(a,c):{};d.get||d.set?ba(b,c,d):b[c]=a[c]}b.default=a;return b}function d(a,b,c){var d=.5*c[0],e=.5*c[1];c=.5*c[2];var l=b[0],g=b[1],h=b[2];b=b[3];a[0]=l;a[1]=g;a[2]=h;a[3]=b;a[4]=d*b+e*h-c*g;a[5]=e*b+c*l-d*h;a[6]=c*b+d*g-e*l;a[7]=-d*l-e*g-c*h;return a}function e(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=
b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];return a}function g(a,b,c){var d=b[0],e=b[1],l=b[2],g=b[3],h=c[4],k=c[5],q=c[6],r=c[7],m=b[4],n=b[5],p=b[6];b=b[7];var G=c[0],u=c[1],x=c[2];c=c[3];a[0]=d*c+g*G+e*x-l*u;a[1]=e*c+g*u+l*G-d*x;a[2]=l*c+g*x+d*u-e*G;a[3]=g*c-d*G-e*u-l*x;a[4]=d*r+g*h+e*q-l*k+m*c+b*G+n*x-p*u;a[5]=e*r+g*k+l*h-d*q+n*c+b*u+p*G-m*x;a[6]=l*r+g*q+d*k-e*h+p*c+b*x+m*u-n*G;a[7]=g*r-d*h-e*k-l*q+b*c-m*G-n*u-p*x;return a}Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){var a=new k.ARRAY_TYPE(8);
k.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[4]=0,a[5]=0,a[6]=0,a[7]=0);a[3]=1;return a};a.clone=function(a){var b=new k.ARRAY_TYPE(8);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];return b};a.fromValues=function(a,b,c,d,e,g,h,m){var l=new k.ARRAY_TYPE(8);l[0]=a;l[1]=b;l[2]=c;l[3]=d;l[4]=e;l[5]=g;l[6]=h;l[7]=m;return l};a.fromRotationTranslationValues=function(a,b,c,d,e,g,h){var l=new k.ARRAY_TYPE(8);l[0]=a;l[1]=b;l[2]=c;l[3]=d;e*=.5;g*=.5;h*=.5;l[4]=e*d+g*
c-h*b;l[5]=g*d+h*a-e*c;l[6]=h*d+e*b-g*a;l[7]=-e*a-g*b-h*c;return l};a.fromRotationTranslation=d;a.fromTranslation=function(a,b){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=.5*b[0];a[5]=.5*b[1];a[6]=.5*b[2];a[7]=0;return a};a.fromRotation=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=0;a[5]=0;a[6]=0;a[7]=0;return a};a.fromMat4=function(a,b){var c=h.create();m.getRotation(c,b);var e=new k.ARRAY_TYPE(3);m.getTranslation(e,b);d(a,c,e);return a};a.copy=e;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=
1;a[4]=0;a[5]=0;a[6]=0;a[7]=0;return a};a.set=function(a,b,c,d,e,g,h,k,m){a[0]=b;a[1]=c;a[2]=d;a[3]=e;a[4]=g;a[5]=h;a[6]=k;a[7]=m;return a};a.getDual=function(a,b){a[0]=b[4];a[1]=b[5];a[2]=b[6];a[3]=b[7];return a};a.setDual=function(a,b){a[4]=b[0];a[5]=b[1];a[6]=b[2];a[7]=b[3];return a};a.getTranslation=function(a,b){var c=b[4],d=b[5],e=b[6],g=b[7],h=-b[0],l=-b[1],k=-b[2];b=b[3];a[0]=2*(c*b+g*h+d*k-e*l);a[1]=2*(d*b+g*l+e*h-c*k);a[2]=2*(e*b+g*k+c*l-d*h);return a};a.translate=function(a,b,c){var d=
b[0],e=b[1],g=b[2],h=b[3],l=.5*c[0],k=.5*c[1];c=.5*c[2];var q=b[4],m=b[5],r=b[6];b=b[7];a[0]=d;a[1]=e;a[2]=g;a[3]=h;a[4]=h*l+e*c-g*k+q;a[5]=h*k+g*l-d*c+m;a[6]=h*c+d*k-e*l+r;a[7]=-d*l-e*k-g*c+b;return a};a.rotateX=function(a,b,c){var d=-b[0],e=-b[1],g=-b[2],l=b[3],k=b[4],q=b[5],m=b[6],r=b[7],n=k*l+r*d+q*g-m*e,p=q*l+r*e+m*d-k*g,I=m*l+r*g+k*e-q*d;k=r*l-k*d-q*e-m*g;h.rotateX(a,b,c);d=a[0];e=a[1];g=a[2];l=a[3];a[4]=n*l+k*d+p*g-I*e;a[5]=p*l+k*e+I*d-n*g;a[6]=I*l+k*g+n*e-p*d;a[7]=k*l-n*d-p*e-I*g;return a};
a.rotateY=function(a,b,c){var d=-b[0],e=-b[1],g=-b[2],l=b[3],k=b[4],q=b[5],m=b[6],r=b[7],n=k*l+r*d+q*g-m*e,p=q*l+r*e+m*d-k*g,I=m*l+r*g+k*e-q*d;k=r*l-k*d-q*e-m*g;h.rotateY(a,b,c);d=a[0];e=a[1];g=a[2];l=a[3];a[4]=n*l+k*d+p*g-I*e;a[5]=p*l+k*e+I*d-n*g;a[6]=I*l+k*g+n*e-p*d;a[7]=k*l-n*d-p*e-I*g;return a};a.rotateZ=function(a,b,c){var d=-b[0],e=-b[1],g=-b[2],l=b[3],k=b[4],q=b[5],m=b[6],r=b[7],n=k*l+r*d+q*g-m*e,p=q*l+r*e+m*d-k*g,I=m*l+r*g+k*e-q*d;k=r*l-k*d-q*e-m*g;h.rotateZ(a,b,c);d=a[0];e=a[1];g=a[2];l=
a[3];a[4]=n*l+k*d+p*g-I*e;a[5]=p*l+k*e+I*d-n*g;a[6]=I*l+k*g+n*e-p*d;a[7]=k*l-n*d-p*e-I*g;return a};a.rotateByQuatAppend=function(a,b,c){var d=c[0],e=c[1],g=c[2];c=c[3];var h=b[0],l=b[1],k=b[2],q=b[3];a[0]=h*c+q*d+l*g-k*e;a[1]=l*c+q*e+k*d-h*g;a[2]=k*c+q*g+h*e-l*d;a[3]=q*c-h*d-l*e-k*g;h=b[4];l=b[5];k=b[6];q=b[7];a[4]=h*c+q*d+l*g-k*e;a[5]=l*c+q*e+k*d-h*g;a[6]=k*c+q*g+h*e-l*d;a[7]=q*c-h*d-l*e-k*g;return a};a.rotateByQuatPrepend=function(a,b,c){var d=b[0],e=b[1],g=b[2];b=b[3];var h=c[0],k=c[1],l=c[2],
q=c[3];a[0]=d*q+b*h+e*l-g*k;a[1]=e*q+b*k+g*h-d*l;a[2]=g*q+b*l+d*k-e*h;a[3]=b*q-d*h-e*k-g*l;h=c[4];k=c[5];l=c[6];q=c[7];a[4]=d*q+b*h+e*l-g*k;a[5]=e*q+b*k+g*h-d*l;a[6]=g*q+b*l+d*k-e*h;a[7]=b*q-d*h-e*k-g*l;return a};a.rotateAroundAxis=function(a,b,c,d){if(Math.abs(d)<k.EPSILON)return e(a,b);var g=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);d*=.5;var h=Math.sin(d),l=h*c[0]/g,q=h*c[1]/g;c=h*c[2]/g;d=Math.cos(d);g=b[0];h=b[1];var m=b[2],r=b[3];a[0]=g*d+r*l+h*c-m*q;a[1]=h*d+r*q+m*l-g*c;a[2]=m*d+r*c+g*q-h*l;
a[3]=r*d-g*l-h*q-m*c;g=b[4];h=b[5];m=b[6];b=b[7];a[4]=g*d+b*l+h*c-m*q;a[5]=h*d+b*q+m*l-g*c;a[6]=m*d+b*c+g*q-h*l;a[7]=b*d-g*l-h*q-m*c;return a};a.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];return a};a.multiply=g;a.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;return a};a.lerp=function(a,b,c,d){var e=1-d;0>n(b,c)&&(d=-d);a[0]=b[0]*e+
c[0]*d;a[1]=b[1]*e+c[1]*d;a[2]=b[2]*e+c[2]*d;a[3]=b[3]*e+c[3]*d;a[4]=b[4]*e+c[4]*d;a[5]=b[5]*e+c[5]*d;a[6]=b[6]*e+c[6]*d;a[7]=b[7]*e+c[7]*d;return a};a.invert=function(a,b){var c=p(b);a[0]=-b[0]/c;a[1]=-b[1]/c;a[2]=-b[2]/c;a[3]=b[3]/c;a[4]=-b[4]/c;a[5]=-b[5]/c;a[6]=-b[6]/c;a[7]=b[7]/c;return a};a.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];a[4]=-b[4];a[5]=-b[5];a[6]=-b[6];a[7]=b[7];return a};a.normalize=function(a,b){var c=p(b);if(0<c){c=Math.sqrt(c);var d=b[0]/c,e=b[1]/c,g=
b[2]/c,h=b[3]/c,k=b[4],l=b[5],m=b[6];b=b[7];var q=d*k+e*l+g*m+h*b;a[0]=d;a[1]=e;a[2]=g;a[3]=h;a[4]=(k-d*q)/c;a[5]=(l-e*q)/c;a[6]=(m-g*q)/c;a[7]=(b-h*q)/c}return a};a.str=function(a){return"quat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+")"};a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]};a.equals=function(a,b){var c=a[0],d=a[1],e=a[2],g=a[3],h=a[4],l=a[5],m=a[6];a=a[7];var q=
b[0],n=b[1],p=b[2],E=b[3],I=b[4],G=b[5],u=b[6];b=b[7];return Math.abs(c-q)<=k.EPSILON*Math.max(1,Math.abs(c),Math.abs(q))&&Math.abs(d-n)<=k.EPSILON*Math.max(1,Math.abs(d),Math.abs(n))&&Math.abs(e-p)<=k.EPSILON*Math.max(1,Math.abs(e),Math.abs(p))&&Math.abs(g-E)<=k.EPSILON*Math.max(1,Math.abs(g),Math.abs(E))&&Math.abs(h-I)<=k.EPSILON*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(l-G)<=k.EPSILON*Math.max(1,Math.abs(l),Math.abs(G))&&Math.abs(m-u)<=k.EPSILON*Math.max(1,Math.abs(m),Math.abs(u))&&Math.abs(a-
b)<=k.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.sqrLen=a.squaredLength=a.len=a.length=a.dot=a.mul=a.setReal=a.getReal=void 0;var k=b(Ea),h=b(vd),m=b(sd);a.getReal=h.copy;a.setReal=h.copy;a.mul=g;var n=h.dot;a.dot=n;c=h.length;a.length=c;a.len=c;var p=h.squaredLength;a.squaredLength=p;a.sqrLen=p});N(ff);var gf=K(function(c,a){function b(){var a=new p.ARRAY_TYPE(2);p.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0);return a}function d(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];return a}function e(a,b,c){a[0]=
b[0]*c[0];a[1]=b[1]*c[1];return a}function g(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];return a}function k(a,b){var c=b[0]-a[0];a=b[1]-a[1];return Math.sqrt(c*c+a*a)}function h(a,b){var c=b[0]-a[0];a=b[1]-a[1];return c*c+a*a}function m(a){var b=a[0];a=a[1];return Math.sqrt(b*b+a*a)}function n(a){var b=a[0];a=a[1];return b*b+a*a}Object.defineProperty(a,"__esModule",{value:!0});a.create=b;a.clone=function(a){var b=new p.ARRAY_TYPE(2);b[0]=a[0];b[1]=a[1];return b};a.fromValues=function(a,b){var c=new p.ARRAY_TYPE(2);
c[0]=a;c[1]=b;return c};a.copy=function(a,b){a[0]=b[0];a[1]=b[1];return a};a.set=function(a,b,c){a[0]=b;a[1]=c;return a};a.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];return a};a.subtract=d;a.multiply=e;a.divide=g;a.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);return a};a.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);return a};a.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);return a};a.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=
Math.max(b[1],c[1]);return a};a.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);return a};a.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;return a};a.scaleAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;return a};a.distance=k;a.squaredDistance=h;a.length=m;a.squaredLength=n;a.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];return a};a.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];return a};a.normalize=function(a,b){var c=b[0],d=b[1];c=c*c+d*d;0<c&&(c=1/Math.sqrt(c));a[0]=b[0]*
c;a[1]=b[1]*c;return a};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};a.cross=function(a,b,c){b=b[0]*c[1]-b[1]*c[0];a[0]=a[1]=0;a[2]=b;return a};a.lerp=function(a,b,c,d){var e=b[0];b=b[1];a[0]=e+d*(c[0]-e);a[1]=b+d*(c[1]-b);return a};a.random=function(a,b){b=b||1;var c=2*p.RANDOM()*Math.PI;a[0]=Math.cos(c)*b;a[1]=Math.sin(c)*b;return a};a.transformMat2=function(a,b,c){var d=b[0];b=b[1];a[0]=c[0]*d+c[2]*b;a[1]=c[1]*d+c[3]*b;return a};a.transformMat2d=function(a,b,c){var d=b[0];b=b[1];a[0]=c[0]*d+
c[2]*b+c[4];a[1]=c[1]*d+c[3]*b+c[5];return a};a.transformMat3=function(a,b,c){var d=b[0];b=b[1];a[0]=c[0]*d+c[3]*b+c[6];a[1]=c[1]*d+c[4]*b+c[7];return a};a.transformMat4=function(a,b,c){var d=b[0];b=b[1];a[0]=c[0]*d+c[4]*b+c[12];a[1]=c[1]*d+c[5]*b+c[13];return a};a.rotate=function(a,b,c,d){var e=b[0]-c[0];b=b[1]-c[1];var g=Math.sin(d);d=Math.cos(d);a[0]=e*d-b*g+c[0];a[1]=e*g+b*d+c[1];return a};a.angle=function(a,b){var c=a[0];a=a[1];var d=b[0];b=b[1];var e=c*c+a*a;0<e&&(e=1/Math.sqrt(e));var g=d*
d+b*b;0<g&&(g=1/Math.sqrt(g));c=(c*d+a*b)*e*g;return 1<c?0:-1>c?Math.PI:Math.acos(c)};a.zero=function(a){a[0]=0;a[1]=0;return a};a.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]};a.equals=function(a,b){var c=a[0];a=a[1];var d=b[0];b=b[1];return Math.abs(c-d)<=p.EPSILON*Math.max(1,Math.abs(c),Math.abs(d))&&Math.abs(a-b)<=p.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.forEach=a.sqrLen=a.sqrDist=a.dist=a.div=a.mul=a.sub=a.len=void 0;var p=
function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=ba&&Z?Z(a,c):{};d.get||d.set?ba(b,c,d):b[c]=a[c]}b.default=a;return b}(Ea);a.len=m;a.sub=d;a.mul=e;a.div=g;a.dist=k;a.sqrDist=h;a.sqrLen=n;c=function(){var a=b();return function(b,c,d,e,g,h){c||(c=2);d||(d=0);for(e=e?Math.min(e*c+d,b.length):b.length;d<e;d+=c)a[0]=b[d],a[1]=b[d+1],g(a,a,h),b[d]=a[0],b[d+1]=a[1];return b}}();a.forEach=c});N(gf);var Aa=K(function(c,a){function b(a){if(a&&
a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=ba&&Z?Z(a,c):{};d.get||d.set?ba(b,c,d):b[c]=a[c]}b.default=a;return b}Object.defineProperty(a,"__esModule",{value:!0});a.vec4=a.vec3=a.vec2=a.quat2=a.quat=a.mat4=a.mat3=a.mat2d=a.mat2=a.glMatrix=void 0;c=b(Ea);a.glMatrix=c;c=b(df);a.mat2=c;c=b(ef);a.mat2d=c;c=b(rd);a.mat3=c;c=b(sd);a.mat4=c;c=b(vd);a.quat=c;c=b(ff);a.quat2=c;c=b(gf);a.vec2=c;c=b(td);a.vec3=c;c=b(ud);a.vec4=c});N(Aa);var zc=
Aa.vec4,Sb=Aa.vec3,zh=Aa.vec2,Ah=Aa.quat2,Bh=Aa.quat,R=Aa.mat4,Ch=Aa.mat3,Dh=Aa.mat2d,Eh=Aa.mat2,Fh=Aa.glMatrix;Ab.deviation=function(c,a,b,d){var e=a&&a.length,g=Math.abs(Pc(c,0,e?a[0]*b:c.length,b));if(e){e=0;for(var k=a.length;e<k;e++)g-=Math.abs(Pc(c,a[e]*b,e<k-1?a[e+1]*b:c.length,b))}for(e=a=0;e<d.length;e+=3){k=d[e]*b;var h=d[e+1]*b,m=d[e+2]*b;a+=Math.abs((c[k]-c[m])*(c[h+1]-c[k+1])-(c[k]-c[h])*(c[m+1]-c[k+1]))}return 0===g&&0===a?0:Math.abs((a-g)/g)};Ab.flatten=function(c){for(var a=c[0][0].length,
b={vertices:[],holes:[],dimensions:a},d=0,e=0;e<c.length;e++){for(var g=0;g<c[e].length;g++)for(var k=0;k<a;k++)b.vertices.push(c[e][g][k]);0<e&&(d+=c[e-1].length,b.holes.push(d))}return b};Ab.default=Ab;var hf="undefined"===typeof Te?"__target":Te(),$f=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,dc=window.URL||window.webkitURL,rb=window.Worker;if(rb){var jf=Wd("self.onmessage = function () {}"),kf=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw Error("Not available");
var wd=new rb(jf);wd.postMessage(kf,[kf.buffer])}catch(c){rb=null}finally{dc.revokeObjectURL(jf),wd&&wd.terminate()}}var Gh=new function(c,a){return function(b){var d=this;if(a){if(rb&&!b)return b=(""+a).replace(/^function.+?{/,"").slice(0,-1),b=Wd(b),this[hf]=new rb(b),dc.revokeObjectURL(b),this[hf];var e={postMessage:function(a){d.onmessage&&setTimeout(function(){return d.onmessage({data:a,target:e})})}};a.call(e);this.postMessage=function(a){setTimeout(function(){return e.onmessage({data:a,target:d})})};
this.isThisThread=!0}else return new rb(c)}}("./worker.js",function(c,a){}),lf={window:1,windowAnimation:2,gradual:3,ripple:4,water:6},Ac=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b,c));b._isShow=!0;c=b.getOptions();if("windowAnimation"===c.style||"ripple"===c.style||0<c.riseTime)b.autoUpdate=!0;b.selectedColor=[-1,-1,-1];b.textureCache={};return b}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{color:"rgba(50, 50, 230, 1.0)",opacity:.8,isTextureFull:!1,
topColor:"rgba(76, 76, 76, 76)",textureScale:1,useLight:!0,riseTime:0}}},{key:"initialize",value:function(a){this.gl=a;var b=this.getOptions();this.dataMgr=new ab(this,this.gl);this.texture=null;this.isUseTexture=!1;var c=[];b.enablePicked&&c.push("PICK");b.texture&&c.push("USE_TEXTURE");this.program=new S(this.gl,{vertexShader:"precision highp float;uniform vec4 uSelectedColor;attribute vec4 a_pos;attribute vec3 a_normal;attribute vec4 a_color;attribute vec4 a_pre_color;attribute float a_height;attribute float a_pre_height;\n#if defined(USE_TEXTURE)\nattribute vec2 a_texture_coord;\n#endif\nuniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;uniform mat4 u_normal_matrix;uniform vec3 u_side_light_dir;uniform bool u_use_lighting;uniform bool u_use_texture;uniform vec3 u_ripple_center;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform float dataTime;uniform float riseTime;uniform vec2 uMapCenter;uniform float uMapZoom;varying float v_height;varying vec4 v_color;varying vec3 v_position;varying vec2 v_texture_coord;const vec3 point_color=vec3(0.06,0.06,0.06);const vec3 light_color=vec3(0.53,0.53,0.53);const vec3 light_color_2=vec3(0.4,0.4,0.4);const vec3 uAmbientColor=vec3(0.8,0.8,0.8);const vec3 uLightingDirection=vec3(0.0,1.0,1.0);const vec3 uDirectionalColor=vec3(1.0,1.0,1.0);float getTransitionValue(float pre_value,float to_value,float dataTime,float riseTime){float result=0.0;if(pre_value==to_value){result=to_value;}else{if(riseTime>0.0&&dataTime<riseTime){result=(pre_value+(to_value-pre_value)*(dataTime/riseTime));}else{result=to_value;}}return result;}void main(){vec4 pos=a_pos;pos.z=pos.z+pos.w*getTransitionValue(a_pre_height,a_height,dataTime,riseTime);v_position=pos.xyz;v_height=a_height;\n#if defined(USE_TEXTURE)\nif(u_use_texture){v_texture_coord=a_texture_coord;}\n#endif\nvec4 position=u_proj_matrix*u_mv_matrix*vec4(pos.xyz,1.0);gl_Position=position;vec4 icolor=a_color;\n#if defined(PICK)\nif(mapvIsPicked()){icolor=uSelectedColor;}\n#endif\nif(u_use_lighting){vec3 N=normalize(vec3(u_normal_matrix*vec4(a_normal,1.0)));vec4 point_dir=u_mv_matrix*vec4(0,1,0,0);vec3 L_point=normalize(point_dir.xyz);float lambert_point=max(0.0,dot(N,-L_point));vec4 light_dir=u_mv_matrix*vec4(u_side_light_dir,0);vec3 L=normalize(light_dir.xyz);float lambert=max(0.0,dot(N,-L));if(pos.z<5.0){float deepGradientColor=(5.0-pos.z)/8.0;lambert=lambert-deepGradientColor;}vec4 light_dir_2=u_mv_matrix*vec4(0,0,-1,0);vec3 L2=normalize(light_dir_2.xyz);float lambert_2=max(0.0,dot(N,-L2));if(a_pre_color.r==a_color.r&&a_pre_color.g==a_color.g&&a_pre_color.b==a_color.b){}else{if(riseTime>0.0&&dataTime<riseTime){icolor.r=a_pre_color.r+(a_color.r-a_pre_color.r)*(dataTime/riseTime);icolor.g=a_pre_color.g+(a_color.g-a_pre_color.g)*(dataTime/riseTime);icolor.b=a_pre_color.b+(a_color.b-a_pre_color.b)*(dataTime/riseTime);}}v_color.rgb=icolor.rgb+icolor.rgb*light_color*lambert+icolor.rgb*light_color_2*lambert_2+icolor.rgb*point_color*lambert_point;v_color.a=icolor.a;if(u_use_texture){mat3 normalMatrix=mat3(u_normal_matrix);vec3 transformedNormal=normalMatrix*a_normal;vec3 dir=uLightingDirection;dir=vec3(normalMatrix*vec3(0.0,-1.0,2.0));float directionalLightWeighting=max(dot(normalize(transformedNormal),normalize(dir)),0.0);vec4 vLightWeighting;vLightWeighting=vec4(uAmbientColor+uDirectionalColor*directionalLightWeighting,1.0);v_color=vLightWeighting;}}else{v_color=icolor;}}",
fragmentShader:"precision highp float;varying vec4 v_color;varying vec3 v_position;varying float v_height;varying vec2 v_texture_coord;uniform vec3 u_ripple_center;uniform vec4 top_color;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform sampler2D u_sampler;uniform bool u_use_lighting;uniform bool u_use_texture;void main(){vec4 color=vec4(v_color);vec4 textureColor=vec4(1.0,1.0,1.0,1.0);if(u_use_texture){if(style==6.0){float x=v_texture_coord.s;float y=v_texture_coord.t;vec2 cPos=-1.0+2.0*gl_FragCoord.xy/MAPV_resolution;float cLength=length(cPos);vec2 uv=gl_FragCoord.xy/MAPV_resolution+(cPos/cLength)*cos(cLength*12.0-time/1000.0*4.0)*0.03;textureColor=texture2D(u_sampler,uv/2.0+vec2(x,y));}else{textureColor=texture2D(u_sampler,vec2(v_texture_coord.s,v_texture_coord.t));}if(u_use_lighting){color=vec4(textureColor*v_color*1.1);}else{color=textureColor;}}if(style==1.0||style==2.0){float t=time/1000.0;float diffDistance=5.0;float modX=mod(v_position.x,diffDistance*2.0);float modZ=mod(v_position.z,diffDistance*2.0);if(modX<diffDistance&&modZ<diffDistance&&v_position.z<v_height){color*=1.05;if(time>0.0&&style==2.0){float iX=ceil(v_position.x/diffDistance);float iZ=ceil(v_position.z/diffDistance);float timeDistance=8.0;t+=tan(sin(iZ));color*=(1.0+mod(t,timeDistance)/timeDistance);}}color.a=alpha;}else if(style==5.0){float t=time/1000.0;float diffDistance=10.0;float modZ=mod(v_position.z-t*40.0,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.5);if(v_position.z/v_height<0.3){color.r+=0.2;color.g+=0.2;color.b+=0.2;}if(modZ<diffDistance*2.0-4.0){discard;}}else if(style==3.0){float diffDistance=10.0;float modX=mod(v_position.x,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.3);}else if(style==4.0){float dis=distance(u_ripple_center,v_position);float rSize=400.0;if(v_position.z>=v_height){color=top_color;}if(dis>u_radius-rSize&&dis<u_radius+rSize){color*=(1.0-abs(dis-u_radius)/rSize)*2.0+1.0;}}else if(style==6.0){}gl_FragColor=color;}",
defines:c},this);this.vertexBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.colorBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.heightBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.textureBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.indexBuffer=new H({gl:a,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});c=[{name:"a_pos",buffer:this.vertexBuffer,stride:28,size:4,type:"FLOAT",offset:0},{name:"a_normal",buffer:this.vertexBuffer,
size:3,stride:28,type:"FLOAT",offset:16},{name:"a_color",buffer:this.colorBuffer,size:4,stride:32,type:"FLOAT",offset:0},{name:"a_pre_color",buffer:this.colorBuffer,size:4,stride:32,type:"FLOAT",offset:16},{name:"a_height",buffer:this.heightBuffer,size:1,stride:8,type:"FLOAT",offset:0},{name:"a_pre_height",buffer:this.heightBuffer,size:1,stride:8,type:"FLOAT",offset:4}];b.texture&&c.push({name:"a_texture_coord",buffer:this.textureBuffer,size:2,stride:8,type:"FLOAT",offset:0});c=c.concat(this.getCommonAttributes());
this.vertexArray=new wa({gl:a,program:this.program,attributes:c});this.initializeTime=new Date;this.normalMatrix=R.create()}},{key:"onChanged",value:function(a,c){var b=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){b.loadTexture(function(){b.dataMgr.parseData(c);b.dataTime=new Date;b.webglLayer.render()})},0))}},{key:"render",value:function(a){var b=a.gl,c=a.projectionMatrix,g=a.viewMatrix;if(this._isShow){var k=this.getData();if(k&&
!(0>=k.length)){k=this.getOptions();var h=this.program;h.use(b);if(!k.texture||this.texture){b.disable(b.CULL_FACE);k.blend&&(b.enable(b.BLEND),b.blendFunc(b.ONE,b.ONE),b.blendEquation(b.FUNC_ADD));0===k.height&&(b.enable(b.BLEND),b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA));var m=0;k.style&&lf[k.style]&&(m=lf[k.style]);"gradual"===k.style?(b.depthMask(!1),b.enable(b.BLEND),b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA)):b.depthMask(!0);var n=this.normizedColor(k.topColor);if("ripple"===k.style&&
k.rippleLayer&&k.rippleLayer.data&&k.rippleLayer.data[0]){var p=this.normizedPoint(k.rippleLayer.data[0].geometry.coordinates);h.setUniforms({u_ripple_center:[p[0],p[1],0],u_radius:k.rippleLayer.options.size*k.rippleLayer.currentScale})}p=Sb.fromValues(0,-1,2);k.lightDir&&(p=Sb.fromValues(k.lightDir[0],k.lightDir[1],k.lightDir[2]));var l=this.normalMatrix;R.invert(l,g);R.transpose(l,l);h.setUniforms(W(this.getCommonUniforms(a),{u_normal_matrix:l,u_sampler:this.texture,u_proj_matrix:c,u_mv_matrix:g,
style:m,top_color:n,u_use_lighting:k.useLight,u_use_texture:this.isUseTexture,alpha:void 0===k.opacity?.8:parseFloat(k.opacity),time:new Date-this.initializeTime,dataTime:new Date-this.dataTime,riseTime:k.riseTime,u_side_light_dir:p}));a=this.dataMgr.getData();0<a.vertex.length&&(this.vertexArray.bind(),this.indexBuffer.bind(),b.drawElements(b.TRIANGLES,a.index.length,b.UNSIGNED_INT,0))}}}else this.webglLayer.clear()}},{key:"loadTexture",value:function(a){var b=this,c=this.getOptions();c.texture?
(this.isUseTexture=!0,Ma(this.gl,c.texture,function(c,d){b.image=d;b.texture=c;a&&a();b.webglLayer.render()})):(this.isUseTexture=!1,this.image=this.texture=null,a&&a())}}]);return a}(ca);ab.prototype.initData=function(){this.outBuilding3d={pickColorVertex:[],vertex:[],texture:[],color:[],height:[],index:[]}};ab.prototype.getData=function(){return this.outBuilding3d};ab.prototype.initWorker=function(){this.worker=new Gh;this.worker.onmessage=function(c){}};ab.prototype.parseData=function(c){var a=
this;this.initData();for(var b=this.shapeLayer.getOptions(),d=0;d<c.length;d++){var e=c[d],g=e.height||0;"properties"in e&&"height"in e.properties&&(g=e.properties.height);g*=1;var k=e.color||b.color;"properties"in e&&"color"in e.properties&&(k=e.properties.color);"[object Function]"===Object.prototype.toString.call(k)&&(k=k(e));k=this.shapeLayer.normizedColor(k);var h=void 0;b.enablePicked&&(h=this.shapeLayer.indexToRgb(d));var m=void 0,n=void 0;b.riseTime&&(n=e.preColor,"properties"in e&&"preColor"in
e.properties&&(n=e.properties.preColor),m=e.preHeight,"properties"in e&&"preHeight"in e.properties&&(m=e.properties.preHeight),void 0===m&&(m=0));if(e.geometry.coordinates)if("MultiPolygon"===e.geometry.type)for(var p=e.geometry.coordinates,l=function(b){var c=[],d=[];e.geometry.coordinates[b][0].forEach(function(b){b=a.shapeLayer.normizedPoint(b);c.push(b[0],b[1]);d.push(b[2])});a.parseBuilding3d(c,d,m,g,n,k,h,a.outBuilding3d)},q=0;q<p.length;q++)l(q);else(function(){var b=[],c=[];e.geometry.coordinates[0].forEach(function(d){d=
a.shapeLayer.normizedPoint(d);b.push(d[0],d[1]);c.push(d[2])});a.parseBuilding3d(b,c,m,g,n,k,h,a.outBuilding3d)})()}this.shapeLayer.vertexBuffer.updateData(new Float32Array(this.outBuilding3d.vertex));this.shapeLayer.colorBuffer.updateData(new Float32Array(this.outBuilding3d.color));this.shapeLayer.heightBuffer.updateData(new Float32Array(this.outBuilding3d.height));this.shapeLayer.textureBuffer.updateData(new Float32Array(this.outBuilding3d.texture));this.shapeLayer.indexBuffer.updateData(new Uint32Array(this.outBuilding3d.index));
b.enablePicked&&this.shapeLayer.pickBuffer.updateData(new Float32Array(this.outBuilding3d.pickColorVertex))};ab.prototype.getBounds=function(c){for(var a=c[0],b=c[1],d=c[0],e=c[1],g=0;g<c.length;g+=2)a=Math.min(c[g],a),b=Math.min(c[g+1],b),d=Math.max(c[g],d),e=Math.max(c[g+1],e);return{minX:a,minY:b,maxX:d,maxY:e,width:d-a,height:e-b}};ab.prototype.parseBuilding3d=function(c,a,b,d,e,g,k,h){void 0===b&&(b=d);var m=this.shapeLayer.options,n=h.vertex,p=h.texture,l=h.color,q=h.height,r=h.pickColorVertex;
h=h.index;void 0===e&&(e=g);var t=0,u=0;this.shapeLayer.image&&(t=this.shapeLayer.image.width*m.textureScale,u=this.shapeLayer.image.height*m.textureScale);if("gradual"!=m.style){var w=Ab(c),y=w[0],v=w[1],z=w[2];y=[c[2*y],c[2*y+1],1];v=[c[2*v],c[2*v+1],1];var A=[c[2*z],c[2*z+1],1];z=[];Sb.cross(z,[A[0]-v[0],A[1]-v[1],A[2]-v[2]],[y[0]-v[0],y[1]-v[1],y[2]-v[2]]);v=n.length/7;if(m.texture)var D=this.getBounds(c);y=m.isTextureFull;A=0;for(var B=c.length;A<B;A+=2)n.push(c[A],c[A+1],a[A/2],1,z[0],z[1],
z[2]),l.push(g[0],g[1],g[2],g[3],e[0],e[1],e[2],e[3]),q.push(d,b),m.texture&&(y?(p.push((c[A]-D.minX)/D.width),p.push((c[A+1]-D.minY)/D.height)):(p.push((c[A]-D.minX)/t),p.push((c[A+1]-D.minY)/u))),k&&r.push(k[0]/255,k[1]/255,k[2]/255);D=0;for(z=w.length;D<z;D++)h.push(w[D]+v)}if(!(d===b&&0>=d))for(w=0,D=c.length;w<D;w+=2){z=n.length/7;var E=c[w],I=c[w+1];v=[E,I,a[w/2],0];A=[E,I,a[w/2],1];B=w+2;var G=w+3;w===D-2&&(B=0,G=1);B=c[B];G=c[G];E=Math.sqrt(Math.pow(B-E,2),Math.pow(G-I,2));I=[B,G,a[w/2],0];
B=[B,G,a[w/2],1];G=[];Sb.cross(G,[I[0]-v[0],I[1]-v[1],I[2]-v[2]],[A[0]-v[0],A[1]-v[1],A[2]-v[2]]);n.push(v[0],v[1],v[2],v[3]);n.push(G[0],G[1],G[2]);n.push(A[0],A[1],A[2],A[3]);n.push(G[0],G[1],G[2]);n.push(I[0],I[1],I[2],I[3]);n.push(G[0],G[1],G[2]);n.push(B[0],B[1],B[2],B[3]);n.push(G[0],G[1],G[2]);l.push(g[0],g[1],g[2],g[3]);l.push(e[0],e[1],e[2],e[3]);l.push(g[0],g[1],g[2],g[3]);l.push(e[0],e[1],e[2],e[3]);l.push(g[0],g[1],g[2],g[3]);l.push(e[0],e[1],e[2],e[3]);l.push(g[0],g[1],g[2],g[3]);l.push(e[0],
e[1],e[2],e[3]);q.push(d);q.push(b);q.push(d);q.push(b);q.push(d);q.push(b);q.push(d);q.push(b);m.texture&&(y?(p.push(0,0),p.push(0,1),p.push(1,0),p.push(1,1)):(p.push(0,0),p.push(0,d/u),p.push(E/t,0),p.push(E/t,d/u)));k&&(r.push(k[0]/255,k[1]/255,k[2]/255),r.push(k[0]/255,k[1]/255,k[2]/255),r.push(k[0]/255,k[1]/255,k[2]/255),r.push(k[0]/255,k[1]/255,k[2]/255));h.push(z,z+2,z+3,z,z+3,z+1)}};var mf=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b,c));b.preHeightMapper=
{};b.preColorMapper={};return b}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return W(Ya(a.prototype.__proto__||L(a.prototype),"getDefaultOptions",this).call(this),{style:"grid",gridSize:500,height:function(){return 1E3},color:function(){return"rgb(200, 200, 20)"}})}},{key:"generateGrid",value:function(a,c){var b=c.gridSize,d=[],k={};c=a.length;for(var h=this.getPointOffset(),m=0;m<c;m++){var n=this.normizedPoint(a[m].geometry.coordinates);n=~~((n[0]+h[0])/b)+"_"+~~((n[1]+h[1])/b);void 0===
k[n]&&(k[n]=0);var p=~~a[m].count||1;"properties"in a[m]&&"count"in a[m].properties&&(p=~~a[m].properties.count);k[n]+=p}Ba(k).forEach(function(a){var c=a.split("_");d.push([c[0]*b+b/2,c[1]*b+b/2,k[a]])});return d}},{key:"onChanged",value:function(b,c){c=this.processData(c);Ya(a.prototype.__proto__||L(a.prototype),"onChanged",this).call(this,b,c)}},{key:"getGridDataRange",value:function(){var a=this.gridData,c=void 0,e=void 0;a[0]&&(c=a[0][2],e=a[0][2]);for(var g=a.length,k=0;k<g;k++){var h=a[k];
c=Math.max(h[2],c);e=Math.min(h[2],e)}return{max:c/2,min:e}}},{key:"processData",value:function(a){var b=this.getOptions(),c=b.style,g=b.gridSize,k=[];this.gridData=k;if("normal"===c){c=this.getPointOffset();for(var h=0;h<a.length;h++){var m=this.normizedPoint(a[h].geometry.coordinates),n=m[0]+c[0];m=m[1]+c[1];var p=~~a[h].count||1;"properties"in a[h]&&"count"in a[h].properties&&(p=~~a[h].properties.count);var l=a[h].color;"properties"in a[h]&&"color"in a[h].properties&&(l=~~a[h].properties.color);
k.push([n,m,p,l])}}else k=this.generateGrid(a,b);a=[];this._preHeightMapper={};this._preColorMapper={};for(c=0;c<k.length;c++)h=k[c],h[0]=h[0],h[1]=h[1],n=h[2],b.height&&(n="function"===typeof b.height?b.height({count:h[2]}):b.height),m=g/2-5,p=h[3],b.color&&(p="function"===typeof b.color?b.color({count:h[2],color:h[3]}):da(p).unitArray()),l="p"+h[0]+h[1],a.push({geometry:{type:"Polygon",coordinates:[[[h[0]-m,h[1]-m],[h[0]-m,h[1]+m],[h[0]+m,h[1]+m],[h[0]+m,h[1]-m]]]},color:p,preHeight:this.preHeightMapper[l],
preColor:this.preColorMapper[l],height:n}),this._preHeightMapper[l]=n,this._preColorMapper[l]=p;this.preHeightMapper=this._preHeightMapper;this.preColorMapper=this._preColorMapper;return a}}]);return a}(Ac),sb=function(c){function a(b){F(this,a);return O(this,(a.__proto__||L(a)).call(this,b))}P(a,c);J(a,[{key:"initialize",value:function(a){var b=this;this.children&&this.children.forEach(function(c){c.map=b.map;c.setWebglLayer(b.getWebglLayer());c.commonInitialize&&c.commonInitialize(a);c.initialize&&
c.initialize(a);c.onOptionsChanged(c.getOptions());c.onDataChanged(c.getData());c.onChanged(c.getOptions(),c.getData())})}},{key:"isRequestAnimation",value:function(){if(void 0!==this.autoUpdate)return Ya(a.prototype.__proto__||L(a.prototype),"isRequestAnimation",this).call(this);for(var b=!1,c=0;c<this.children.length;c++)if(this.children[c].isRequestAnimation()){b=!0;break}return b}},{key:"render",value:function(a){this.children&&this.children.forEach(function(b){b.render(a)})}}]);return a}(qd),
Hh=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b,c));b.gridLayer=new mf(b.getGridOptions());b.children=[b.gridLayer];b.options.riseTime&&(b.autoUpdate=!0);return b}P(a,c);J(a,[{key:"onDataChanged",value:function(a){this.gridLayer.setData(a)}},{key:"getGridOptions",value:function(){var a=this.getOptions(),c=a.max,e=a.min;void 0===c&&(e=this.gridLayer.getGridDataRange(),c=e.max,e=e.min);var g=new la({max:c,min:e,gradient:a.gradient,maxSize:a.maxHeight,minSize:a.minHeight});
a.height=function(a){var b=g.getSize(a.count);"properties"in a&&"count"in a.properties&&(b=g.getSize(a.properties.count));return b};a.color=function(a){var b=g.getImageData(a.count);"properties"in a&&"count"in a.properties&&(b=g.getImageData(a.properties.count));return[b[0]/255,b[1]/255,b[2]/255]};return a}},{key:"onOptionsChanged",value:function(a){this.gridLayer.setOptions(this.getGridOptions())}},{key:"getDefaultOptions",value:function(){return{style:"grid",gridSize:500,maxHeight:8E3,minHeight:200,
gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}}]);return a}(sb),nf=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b,c));b.bufferData=[];return b}P(a,c);J(a,[{key:"initialize",value:function(a){this.gl=a;var b=this.getOptions();this.program=new S(this.gl,{vertexShader:"uniform mat4 u_matrix;attribute vec3 aPos;attribute vec4 aColor;varying vec4 vColor;\n#if defined(DASH)\nvarying vec3 vPos;\n#endif\nvoid main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos,1.0);\n#if defined(DASH)\nvPos=aPos;\n#endif\n}",
fragmentShader:"precision highp float;varying vec4 vColor;varying vec3 vPos;void main(){\n#if defined(DASH)\nif(mod(vPos.x,3.0)<1.5){discard;}\n#endif\ngl_FragColor=vColor;}",defines:b.useDash?["DASH"]:""},this);this.buffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.vertexArray=new wa({gl:a,program:this.program,attributes:[{stride:28,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:28,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12}]})}},{key:"onChanged",
value:function(a,c){var b=this;if(this.gl){var d=[],k=function(a,c){if(a)for(var e=0;e<a.length-1;e++){var g=b.normizedPoint(a[e]);d.push(g[0]);d.push(g[1]);d.push(g[2]);d.push(c[0],c[1],c[2],c[3]);g=b.normizedPoint(a[e+1]);d.push(g[0]);d.push(g[1]);d.push(g[2]);d.push(c[0],c[1],c[2],c[3])}};a=a.color;for(var h=0;h<c.length;h++){var m=c[h].color||a;"properties"in c[h]&&"color"in c[h].properties&&(m=c[h].properties.color);"[object Function]"===Object.prototype.toString.call(m)&&(m=m(c[h]));m=this.normizedColor(m);
var n=c[h].geometry,p=n.coordinates;if("MultiPolygon"===n.type){if(p)for(n=0;n<p.length;n++)k(p[n][0],m)}else if("Polygon"===n.type)p&&k(p[0],m);else if("MultiLineString"===n.type){if(p)for(n=0;n<p.length;n++)k(p[n],m)}else k(p,m)}this.bufferData=d;this.buffer.updateData(new Float32Array(d))}}},{key:"render",value:function(a){var b=a.gl;a=a.matrix;if(this.bufferData&&!(0>=this.bufferData.length)){var c=this.program;c.use(b);this.vertexArray.bind();c.setUniforms({u_matrix:a});a=this.getOptions().blend;
b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);a&&"lighter"===a?b.blendFunc(b.SRC_ALPHA,b.ONE):b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);b.drawArrays(b.LINES,0,this.bufferData.length/7);b.disable(b.BLEND)}}}]);return a}(ca),Ih=rc.f("species"),Jh=K(function(c){c.exports={"default":Ih,__esModule:!0}});N(Jh);var of="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{},Ga=[],xa=[],eg="undefined"!==typeof Uint8Array?Uint8Array:Array,Sc=!1,Kh={}.toString,
ce=Array.isArray||function(c){return"[object Array]"==Kh.call(c)};u.TYPED_ARRAY_SUPPORT=void 0!==of.TYPED_ARRAY_SUPPORT?of.TYPED_ARRAY_SUPPORT:!0;u.poolSize=8192;u._augment=function(c){c.__proto__=u.prototype;return c};u.from=function(c,a,b){return $d(null,c,a,b)};u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array);u.alloc=function(c,a,b){be(c);c=0>=c?Na(null,c):void 0!==a?"string"===typeof b?Na(null,c).fill(a,b):Na(null,c).fill(a):Na(null,c);return c};u.allocUnsafe=
function(c){return Tc(null,c)};u.allocUnsafeSlow=function(c){return Tc(null,c)};u.isBuffer=function(c){return null!=c&&(!!c._isBuffer||me(c)||"function"===typeof c.readFloatLE&&"function"===typeof c.slice&&me(c.slice(0,0)))};u.compare=function(c,a){if(!Ha(c)||!Ha(a))throw new TypeError("Arguments must be Buffers");if(c===a)return 0;for(var b=c.length,d=a.length,e=0,g=Math.min(b,d);e<g;++e)if(c[e]!==a[e]){b=c[e];d=a[e];break}return b<d?-1:d<b?1:0};u.isEncoding=function(c){switch(String(c).toLowerCase()){case "hex":case "utf8":case "utf-8":case "ascii":case "latin1":case "binary":case "base64":case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return!0;
default:return!1}};u.concat=function(c,a){if(!ce(c))throw new TypeError('"list" argument must be an Array of Buffers');if(0===c.length)return u.alloc(0);var b;if(void 0===a)for(b=a=0;b<c.length;++b)a+=c[b].length;a=u.allocUnsafe(a);var d=0;for(b=0;b<c.length;++b){var e=c[b];if(!Ha(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(a,d);d+=e.length}return a};u.byteLength=ae;u.prototype._isBuffer=!0;u.prototype.swap16=function(){var c=this.length;if(0!==c%2)throw new RangeError("Buffer size must be a multiple of 16-bits");
for(var a=0;a<c;a+=2)bb(this,a,a+1);return this};u.prototype.swap32=function(){var c=this.length;if(0!==c%4)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var a=0;a<c;a+=4)bb(this,a,a+3),bb(this,a+1,a+2);return this};u.prototype.swap64=function(){var c=this.length;if(0!==c%8)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var a=0;a<c;a+=8)bb(this,a,a+7),bb(this,a+1,a+6),bb(this,a+2,a+5),bb(this,a+3,a+4);return this};u.prototype.toString=function(){var c=
this.length|0;return 0===c?"":0===arguments.length?ee(this,0,c):cg.apply(this,arguments)};u.prototype.equals=function(c){if(!Ha(c))throw new TypeError("Argument must be a Buffer");return this===c?!0:0===u.compare(this,c)};u.prototype.inspect=function(){var c="";0<this.length&&(c=this.toString("hex",0,50).match(/.{2}/g).join(" "),50<this.length&&(c+=" ... "));return"<Buffer "+c+">"};u.prototype.compare=function(c,a,b,d,e){if(!Ha(c))throw new TypeError("Argument must be a Buffer");void 0===a&&(a=0);
void 0===b&&(b=c?c.length:0);void 0===d&&(d=0);void 0===e&&(e=this.length);if(0>a||b>c.length||0>d||e>this.length)throw new RangeError("out of range index");if(d>=e&&a>=b)return 0;if(d>=e)return-1;if(a>=b)return 1;a>>>=0;b>>>=0;d>>>=0;e>>>=0;if(this===c)return 0;var g=e-d,k=b-a,h=Math.min(g,k);d=this.slice(d,e);c=c.slice(a,b);for(a=0;a<h;++a)if(d[a]!==c[a]){g=d[a];k=c[a];break}return g<k?-1:k<g?1:0};u.prototype.includes=function(c,a,b){return-1!==this.indexOf(c,a,b)};u.prototype.indexOf=function(c,
a,b){return fe(this,c,a,b,!0)};u.prototype.lastIndexOf=function(c,a,b){return fe(this,c,a,b,!1)};u.prototype.write=function(c,a,b,d){if(void 0===a)d="utf8",b=this.length,a=0;else if(void 0===b&&"string"===typeof a)d=a,b=this.length,a=0;else if(isFinite(a))a|=0,isFinite(b)?(b|=0,void 0===d&&(d="utf8")):(d=b,b=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var e=this.length-a;if(void 0===b||b>e)b=e;if(0<c.length&&(0>b||0>a)||a>this.length)throw new RangeError("Attempt to write outside buffer bounds");
d||(d="utf8");for(e=!1;;)switch(d){case "hex":a:{a=Number(a)||0;d=this.length-a;b?(b=Number(b),b>d&&(b=d)):b=d;d=c.length;if(0!==d%2)throw new TypeError("Invalid hex string");b>d/2&&(b=d/2);for(d=0;d<b;++d){e=parseInt(c.substr(2*d,2),16);if(isNaN(e)){c=d;break a}this[a+d]=e}c=d}return c;case "utf8":case "utf-8":return Fb(fc(c,this.length-a),this,a,b);case "ascii":return Fb(le(c),this,a,b);case "latin1":case "binary":return Fb(le(c),this,a,b);case "base64":return Fb(de(c),this,a,b);case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":d=
c;e=this.length-a;for(var g=[],k=0;k<d.length&&!(0>(e-=2));++k){var h=d.charCodeAt(k);c=h>>8;h%=256;g.push(h);g.push(c)}return Fb(g,this,a,b);default:if(e)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase();e=!0}};u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var he=4096;u.prototype.slice=function(c,a){var b=this.length;c=~~c;a=void 0===a?b:~~a;0>c?(c+=b,0>c&&(c=0)):c>b&&(c=b);0>a?(a+=b,0>a&&(a=0)):a>b&&(a=b);a<c&&(a=c);if(u.TYPED_ARRAY_SUPPORT)a=
this.subarray(c,a),a.__proto__=u.prototype;else{b=a-c;a=new u(b,void 0);for(var d=0;d<b;++d)a[d]=this[d+c]}return a};u.prototype.readUIntLE=function(c,a,b){c|=0;a|=0;b||ha(c,a,this.length);b=this[c];for(var d=1,e=0;++e<a&&(d*=256);)b+=this[c+e]*d;return b};u.prototype.readUIntBE=function(c,a,b){c|=0;a|=0;b||ha(c,a,this.length);b=this[c+--a];for(var d=1;0<a&&(d*=256);)b+=this[c+--a]*d;return b};u.prototype.readUInt8=function(c,a){a||ha(c,1,this.length);return this[c]};u.prototype.readUInt16LE=function(c,
a){a||ha(c,2,this.length);return this[c]|this[c+1]<<8};u.prototype.readUInt16BE=function(c,a){a||ha(c,2,this.length);return this[c]<<8|this[c+1]};u.prototype.readUInt32LE=function(c,a){a||ha(c,4,this.length);return(this[c]|this[c+1]<<8|this[c+2]<<16)+16777216*this[c+3]};u.prototype.readUInt32BE=function(c,a){a||ha(c,4,this.length);return 16777216*this[c]+(this[c+1]<<16|this[c+2]<<8|this[c+3])};u.prototype.readIntLE=function(c,a,b){c|=0;a|=0;b||ha(c,a,this.length);b=this[c];for(var d=1,e=0;++e<a&&
(d*=256);)b+=this[c+e]*d;b>=128*d&&(b-=Math.pow(2,8*a));return b};u.prototype.readIntBE=function(c,a,b){c|=0;a|=0;b||ha(c,a,this.length);b=a;for(var d=1,e=this[c+--b];0<b&&(d*=256);)e+=this[c+--b]*d;e>=128*d&&(e-=Math.pow(2,8*a));return e};u.prototype.readInt8=function(c,a){a||ha(c,1,this.length);return this[c]&128?-1*(255-this[c]+1):this[c]};u.prototype.readInt16LE=function(c,a){a||ha(c,2,this.length);c=this[c]|this[c+1]<<8;return c&32768?c|4294901760:c};u.prototype.readInt16BE=function(c,a){a||
ha(c,2,this.length);c=this[c+1]|this[c]<<8;return c&32768?c|4294901760:c};u.prototype.readInt32LE=function(c,a){a||ha(c,4,this.length);return this[c]|this[c+1]<<8|this[c+2]<<16|this[c+3]<<24};u.prototype.readInt32BE=function(c,a){a||ha(c,4,this.length);return this[c]<<24|this[c+1]<<16|this[c+2]<<8|this[c+3]};u.prototype.readFloatLE=function(c,a){a||ha(c,4,this.length);return ec(this,c,!0,23,4)};u.prototype.readFloatBE=function(c,a){a||ha(c,4,this.length);return ec(this,c,!1,23,4)};u.prototype.readDoubleLE=
function(c,a){a||ha(c,8,this.length);return ec(this,c,!0,52,8)};u.prototype.readDoubleBE=function(c,a){a||ha(c,8,this.length);return ec(this,c,!1,52,8)};u.prototype.writeUIntLE=function(c,a,b,d){c=+c;a|=0;b|=0;d||pa(this,c,a,b,Math.pow(2,8*b)-1,0);d=1;var e=0;for(this[a]=c&255;++e<b&&(d*=256);)this[a+e]=c/d&255;return a+b};u.prototype.writeUIntBE=function(c,a,b,d){c=+c;a|=0;b|=0;d||pa(this,c,a,b,Math.pow(2,8*b)-1,0);d=b-1;var e=1;for(this[a+d]=c&255;0<=--d&&(e*=256);)this[a+d]=c/e&255;return a+b};
u.prototype.writeUInt8=function(c,a,b){c=+c;a|=0;b||pa(this,c,a,1,255,0);u.TYPED_ARRAY_SUPPORT||(c=Math.floor(c));this[a]=c&255;return a+1};u.prototype.writeUInt16LE=function(c,a,b){c=+c;a|=0;b||pa(this,c,a,2,65535,0);u.TYPED_ARRAY_SUPPORT?(this[a]=c&255,this[a+1]=c>>>8):gc(this,c,a,!0);return a+2};u.prototype.writeUInt16BE=function(c,a,b){c=+c;a|=0;b||pa(this,c,a,2,65535,0);u.TYPED_ARRAY_SUPPORT?(this[a]=c>>>8,this[a+1]=c&255):gc(this,c,a,!1);return a+2};u.prototype.writeUInt32LE=function(c,a,b){c=
+c;a|=0;b||pa(this,c,a,4,4294967295,0);u.TYPED_ARRAY_SUPPORT?(this[a+3]=c>>>24,this[a+2]=c>>>16,this[a+1]=c>>>8,this[a]=c&255):hc(this,c,a,!0);return a+4};u.prototype.writeUInt32BE=function(c,a,b){c=+c;a|=0;b||pa(this,c,a,4,4294967295,0);u.TYPED_ARRAY_SUPPORT?(this[a]=c>>>24,this[a+1]=c>>>16,this[a+2]=c>>>8,this[a+3]=c&255):hc(this,c,a,!1);return a+4};u.prototype.writeIntLE=function(c,a,b,d){c=+c;a|=0;d||(d=Math.pow(2,8*b-1),pa(this,c,a,b,d-1,-d));d=0;var e=1,g=0;for(this[a]=c&255;++d<b&&(e*=256);)0>
c&&0===g&&0!==this[a+d-1]&&(g=1),this[a+d]=(c/e>>0)-g&255;return a+b};u.prototype.writeIntBE=function(c,a,b,d){c=+c;a|=0;d||(d=Math.pow(2,8*b-1),pa(this,c,a,b,d-1,-d));d=b-1;var e=1,g=0;for(this[a+d]=c&255;0<=--d&&(e*=256);)0>c&&0===g&&0!==this[a+d+1]&&(g=1),this[a+d]=(c/e>>0)-g&255;return a+b};u.prototype.writeInt8=function(c,a,b){c=+c;a|=0;b||pa(this,c,a,1,127,-128);u.TYPED_ARRAY_SUPPORT||(c=Math.floor(c));0>c&&(c=255+c+1);this[a]=c&255;return a+1};u.prototype.writeInt16LE=function(c,a,b){c=+c;
a|=0;b||pa(this,c,a,2,32767,-32768);u.TYPED_ARRAY_SUPPORT?(this[a]=c&255,this[a+1]=c>>>8):gc(this,c,a,!0);return a+2};u.prototype.writeInt16BE=function(c,a,b){c=+c;a|=0;b||pa(this,c,a,2,32767,-32768);u.TYPED_ARRAY_SUPPORT?(this[a]=c>>>8,this[a+1]=c&255):gc(this,c,a,!1);return a+2};u.prototype.writeInt32LE=function(c,a,b){c=+c;a|=0;b||pa(this,c,a,4,2147483647,-2147483648);u.TYPED_ARRAY_SUPPORT?(this[a]=c&255,this[a+1]=c>>>8,this[a+2]=c>>>16,this[a+3]=c>>>24):hc(this,c,a,!0);return a+4};u.prototype.writeInt32BE=
function(c,a,b){c=+c;a|=0;b||pa(this,c,a,4,2147483647,-2147483648);0>c&&(c=4294967295+c+1);u.TYPED_ARRAY_SUPPORT?(this[a]=c>>>24,this[a+1]=c>>>16,this[a+2]=c>>>8,this[a+3]=c&255):hc(this,c,a,!1);return a+4};u.prototype.writeFloatLE=function(c,a,b){return je(this,c,a,!0,b)};u.prototype.writeFloatBE=function(c,a,b){return je(this,c,a,!1,b)};u.prototype.writeDoubleLE=function(c,a,b){return ke(this,c,a,!0,b)};u.prototype.writeDoubleBE=function(c,a,b){return ke(this,c,a,!1,b)};u.prototype.copy=function(c,
a,b,d){b||(b=0);d||0===d||(d=this.length);a>=c.length&&(a=c.length);a||(a=0);0<d&&d<b&&(d=b);if(d===b||0===c.length||0===this.length)return 0;if(0>a)throw new RangeError("targetStart out of bounds");if(0>b||b>=this.length)throw new RangeError("sourceStart out of bounds");if(0>d)throw new RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length);c.length-a<d-b&&(d=c.length-a+b);var e=d-b;if(this===c&&b<a&&a<d)for(d=e-1;0<=d;--d)c[d+a]=this[d+b];else if(1E3>e||!u.TYPED_ARRAY_SUPPORT)for(d=
0;d<e;++d)c[d+a]=this[d+b];else Uint8Array.prototype.set.call(c,this.subarray(b,b+e),a);return e};u.prototype.fill=function(c,a,b,d){if("string"===typeof c){"string"===typeof a?(d=a,a=0,b=this.length):"string"===typeof b&&(d=b,b=this.length);if(1===c.length){var e=c.charCodeAt(0);256>e&&(c=e)}if(void 0!==d&&"string"!==typeof d)throw new TypeError("encoding must be a string");if("string"===typeof d&&!u.isEncoding(d))throw new TypeError("Unknown encoding: "+d);}else"number"===typeof c&&(c&=255);if(0>
a||this.length<a||this.length<b)throw new RangeError("Out of range index");if(b<=a)return this;a>>>=0;b=void 0===b?this.length:b>>>0;c||(c=0);if("number"===typeof c)for(d=a;d<b;++d)this[d]=c;else for(c=Ha(c)?c:fc((new u(c,d)).toString()),e=c.length,d=0;d<b-a;++d)this[d+a]=c[d%e];return this};var dg=/[^+\/0-9A-Za-z-_]/g,xd={normal:null,road:function(){var c=document.createElement("canvas");c.width=c.height=32;var a=c.getContext("2d");a.save();a.moveTo(0,0);a.lineTo(20,0);a.lineTo(32,16);a.lineTo(20,
32);a.lineTo(0,32);a.lineTo(10,16);a.fillStyle="#fff";a.fill();a.restore();return c}()},pf=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b,c));b.initData();return b}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{color:"rgba(25, 25, 250, 1)",blend:"normal",width:4,isFlat:!0,antialias:!1,lineJoin:"miter",lineCap:"butt",style:"normal",dashArray:0,dashRatio:0,dashOffset:0}}},{key:"initData",value:function(){this.dataMgr={position:[],prev:[],next:[],direction:[],
color:[],index:[],counter:[],uv:[]}}},{key:"initialize",value:function(a){this.gl=a;var b=this.getOptions(),c=[];b.enablePicked&&c.push("PICK");xd[b.style]&&c.push("USE_TEXTURE");this.program=new S(this.gl,{vertexShader:"precision highp float;uniform mat4 u_matrix;uniform float thickness;uniform int miter;uniform vec4 uSelectedColor;uniform bool uFlat;uniform float zoomUnits;uniform float devicePixelRatio;attribute vec3 position;attribute vec3 next;attribute vec3 previous;attribute float direction;attribute vec4 aColor;attribute float aCounter;\n#if defined(USE_TEXTURE)\nattribute vec2 uv;\n#endif\nvarying vec4 vColor;varying vec2 vNormal;varying float vCounter;varying vec2 vUV;vec2 project(vec4 coord){vec3 screen=coord.xyz/coord.w;vec2 clip=(screen.xy+1.0)/2.0;return clip*MAPV_resolution;}vec4 unproject(vec2 projected,float z,float w){vec2 clip=projected/MAPV_resolution;vec2 screen=clip*2.0-1.0;return vec4(screen*w,z,w);}vec2 calcNormal(vec2 currentScreen,vec2 previousScreen,vec2 nextScreen){vec2 dir=vec2(0.0);if(currentScreen==previousScreen){dir=normalize(nextScreen-currentScreen);}else if(currentScreen==nextScreen){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));if(miter==1){vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;}else{dir=dirA;}}vec2 normal=vec2(-dir.y,dir.x);return normal;}void main(){vColor=aColor;vCounter=aCounter;\n#if defined(USE_TEXTURE)\nvUV=uv;\n#endif\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\nif(uFlat){float len=thickness*zoomUnits;vec2 normal=calcNormal(position.xy,previous.xy,next.xy);normal*=len/2.0;vNormal=normal*direction;gl_Position=u_matrix*vec4(position.xy+normal*direction,position.z,1.0);}else{vec4 previousProjected=u_matrix*vec4(previous,1.0);vec4 currentProjected=u_matrix*vec4(position,1.0);vec4 nextProjected=u_matrix*vec4(next,1.0);vec2 currentScreen=project(currentProjected);vec2 previousScreen=project(previousProjected);vec2 nextScreen=project(nextProjected);float len=thickness*devicePixelRatio;vec2 dir=vec2(0.0);if(currentScreen==previousScreen){dir=normalize(nextScreen-currentScreen);}else if(currentScreen==nextScreen){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));if(miter==1){vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;if(dot(dirA,dirB)>0.75){len=thickness*devicePixelRatio/dot(miter,perp);}}else{dir=dirA;}}vec2 normal=vec2(-dir.y,dir.x);normal*=len/2.0;vNormal=normal*direction;vec2 pos=currentScreen+normal*direction;vec4 finalPos=unproject(pos,currentProjected.z,currentProjected.w);gl_Position=finalPos;}}",
fragmentShader:"precision highp float;uniform bool uUseTexture;uniform bool uAntialias;varying vec4 vColor;varying vec2 vNormal;varying float vCounter;uniform float uDashOffset;uniform float uDashArray;uniform float uDashRatio;uniform float uvDelta;uniform float markerDelta;uniform sampler2D textureImage;varying vec2 vUV;void main(){vec4 color=vColor;if(uAntialias){float blur=1.0;blur=1.0-smoothstep(0.98,1.0,length(vNormal));color.a*=blur;}if(uUseTexture){vec4 texture=vec4(1.0,1.0,1.0,0.0);float uvx=vUV.x;float muvx=mod(uvx,markerDelta);float halfd=markerDelta/2.0;if(muvx>=halfd&&muvx<=halfd+uvDelta){float s=(muvx-halfd)/uvDelta;texture=texture2D(textureImage,vec2(s,vUV.y));color=texture.a>=0.5 ? texture : color;}}if(uDashArray>0.0){color.a*=ceil(mod(vCounter+uDashOffset,uDashArray)-(uDashArray*uDashRatio));}gl_FragColor=color;}",
defines:c},this);this.prevBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.currentBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.nextBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.directionBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.colorBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.counterBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.uvBuffer=new H({gl:a,target:"ARRAY_BUFFER",
usage:"STATIC_DRAW"});this.indexBuffer=new H({gl:a,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});c=[{stride:12,name:"previous",buffer:this.prevBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"position",buffer:this.currentBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"next",buffer:this.nextBuffer,size:3,type:"FLOAT",offset:0},{stride:4,name:"direction",buffer:this.directionBuffer,size:1,type:"FLOAT",offset:0},{stride:16,name:"aColor",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0},
{stride:4,name:"aCounter",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:0}];c=c.concat(this.getCommonAttributes());xd[b.style]&&(c.push({stride:8,name:"uv",buffer:this.uvBuffer,size:2,type:"FLOAT",offset:0}),this.setOptions({texture:xd[b.style]}));this.loadTexture();this.vertexArray=new wa({gl:a,program:this.program,attributes:c})}},{key:"onChanged",value:function(a,c){var b=this;if(this.gl){this.initData();for(var d=a.color,k=[],h=0;h<c.length;h++){var m=[],n=c[h].geometry.coordinates;n&&
0<n.length&&(m="Polygon"===c[h].geometry.type?n[0].map(function(a){return b.normizedPoint(a)}):n.map(function(a){return b.normizedPoint(a)}));n=c[h].color||d;"properties"in c[h]&&"color"in c[h].properties&&(n=c[h].properties.color);"[object Function]"===Object.prototype.toString.call(n)&&(n=n(c[h]));n=this.normizedColor(n);for(var p=this.addMultipleCoords(m),l=0;l<p.length;l++)this.processData(this.dataMgr,p[l],n);if(a.enablePicked)for(n=this.indexToRgb(h),p=0;p<m.length;p++)k.push(n[0]/255,n[1]/
255,n[2]/255),k.push(n[0]/255,n[1]/255,n[2]/255),a.repeat&&(k.push(n[0]/255,n[1]/255,n[2]/255),k.push(n[0]/255,n[1]/255,n[2]/255),k.push(n[0]/255,n[1]/255,n[2]/255),k.push(n[0]/255,n[1]/255,n[2]/255))}this.counterBuffer.updateData(new Float32Array(this.dataMgr.counter));this.currentBuffer.updateData(new Float32Array(this.dataMgr.position));this.prevBuffer.updateData(new Float32Array(this.dataMgr.prev));this.nextBuffer.updateData(new Float32Array(this.dataMgr.next));this.directionBuffer.updateData(new Float32Array(this.dataMgr.direction));
this.colorBuffer.updateData(new Float32Array(this.dataMgr.color));this.indexBuffer.updateData(new Uint32Array(this.dataMgr.index));this.isUseTexture&&this.uvBuffer.updateData(new Float32Array(this.dataMgr.uv));a.enablePicked&&this.pickBuffer.updateData(new Float32Array(k))}}},{key:"processData",value:function(a,c,e){var b,d,h,m,n,p,l,q,r=c.length,t=a.position.length/6,u=oe(c),w=u.arr,y=u.total;u=ya(w.map(function(a){return a/y}));w=w.map(function(a){return[a,0,a,1]});var v=ya(c.map(function(a){return 1}),
!0),z=ya(c),A=ya(c.map(ic(-1))),D=ya(c.map(ic(1)));c=ya(c.map(function(a){return e}));r=ne(r,t);(b=a.uv).push.apply(b,aa(Oa(w)));(d=a.counter).push.apply(d,aa(u));(h=a.position).push.apply(h,aa(Oa(z)));(m=a.prev).push.apply(m,aa(Oa(A)));(n=a.next).push.apply(n,aa(Oa(D)));(p=a.direction).push.apply(p,aa(v));(l=a.color).push.apply(l,aa(Oa(c)));(q=a.index).push.apply(q,aa(r))}},{key:"render",value:function(a){var b=a.gl,c=a.matrix,g=this.dataMgr;if(g&&!(0>=g.index.length)&&this.map){var k=this.getOptions(),
h=this.program;h.use(b);var m=0,n=0;this.isUseTexture&&(n=this.map.getZoomUnits(),m=Math.min(1E3,Math.max(n/.125*8,1)),n=parseFloat((k.width*n).toFixed(2)));h.setUniforms(W(this.getCommonUniforms(a),{u_matrix:c,uFlat:k.isFlat,zoomUnits:this.map.getZoomUnits(),devicePixelRatio:window.devicePixelRatio,miter:1,thickness:k.width,uDashArray:k.dashArray,uDashRatio:k.dashRatio,uDashOffset:k.dashOffset,uAntialias:k.antialias,uUseTexture:this.isUseTexture,textureImage:this.texture,markerDelta:m,uvDelta:n}));
b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);k.blend&&"lighter"===k.blend?b.blendFunc(b.SRC_ALPHA,b.ONE):b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);this.indexBuffer.bind();this.vertexArray.bind();b.drawElements(b.TRIANGLES,g.index.length,b.UNSIGNED_INT,0);b.bindBuffer(b.ARRAY_BUFFER,null);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null);b.disable(b.BLEND)}}},{key:"loadTexture",value:function(a){var b=this,c=this.getOptions();c.texture?(this.isUseTexture=!0,Ma(this.gl,c.texture,function(c,d){b.image=
d;b.texture=c;a&&a();b.webglLayer.render()})):(this.isUseTexture=!1,this.image=this.texture=null,a&&a())}}]);return a}(ca),Lh=function(){function c(a,b){F(this,c);this.layer=a;this.gl=b;this.initData()}J(c,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]};this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",value:function(a,b){this.initData();
var c=a.color,e=a.height,g=a.gradient;a=this.gl;for(var k=0;k<b.length;k++){var h=b[k].geometry.coordinates,m=h.length;this.maxLength=m>this.maxLength?m:this.maxLength;for(var n=[],p=0;p<m;p++){var l=this.layer.normizedPoint(h[p]);n.push(l)}m=b[k].color||c;"properties"in b[k]&&"color"in b[k].properties&&(m=b[k].properties.color);g||"[object Function]"!==Object.prototype.toString.call(m)||(m=m(b[k]));h=this.layer.normizedColor(g?g[0]:m);m=this.layer.normizedColor(g?g[1]:m);p=b[k].height||e;"properties"in
b[k]&&"height"in b[k].properties&&(p=b[k].properties.height);"[object Function]"===Object.prototype.toString.call(p)&&(p=p(b[k]));this.processData(this.outWall3d,n,h,m,p)}for(b=0;b<this.outWall3d.vertex.length;b++){c=[];e=this.outWall3d.vertex[b].length;for(g=0;g<e;g++)c.push.apply(c,aa(this.outWall3d.vertex[b][g]));e=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,e);a.bufferData(a.ARRAY_BUFFER,new Float32Array(c),a.STATIC_DRAW);this.outWall3d.vertexBuffer[b]=e;a.bindBuffer(a.ARRAY_BUFFER,null);e=a.createBuffer();
a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[b]),a.STATIC_DRAW);this.outWall3d.indexBuffer[b]=e;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(a,b,c,e,g){var d=a.vertex[a.vertex.length-1],h=a.index[a.index.length-1],m=b.length;if(!h||65536<=h.length+2*m+2)d=[],h=[],a.vertex.push(d),a.index.push(h);(a=d.length)&&h.push(a-1,a);for(var n=a=0;n<m;n++){var p=[],l=[],q=b[n];p.push(q[0],q[1]);p.push(q[2]?Number(q[2])+
g:g);p.push(q[3]?Number(q[3]):n);p.push(a);p.push(c[0],c[1],c[2],c[3]);l.push(q[0],q[1]);l.push(q[2]?Number(q[2]):0);l.push(q[3]?Number(q[3]):n);l.push(a);l.push(e[0],e[1],e[2],e[3]);q=d.length;d.push(p,l);h.push(q,q+1);n<m-1&&(a+=this.getDistance(b[n],b[n+1]))}}},{key:"getDistance",value:function(a,b){return Math.sqrt(Math.pow(Math.abs(a[0]-b[0]),2)+Math.pow(Math.abs(a[1]-b[1]),2))}}]);return c}(),qf=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b,c));b.startTime=b.options.startTime||
0;b.endTime=b.options.endTime;b.time=b.startTime;b.autoUpdate=!0;return b}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(a){this.gl=a;this.dataMgr=new Lh(this,this.gl);this.program=new S(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute float aDistance;attribute vec4 aColor;varying vec4 vColor;varying float vHeight;varying float vTime;varying float vDistance;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vHeight=aPos.z;vColor=aColor;vDistance=aDistance;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",
fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;varying float vDistance;varying float vHeight;uniform float currentTime;void main(){if(vTime>1.0||vTime<0.0){}float radius=2.5;float distance=vDistance+currentTime*20.0;float modDistance=mod(distance,9.0);float alpha=1.0;if(modDistance>radius*2.0){discard;}else{float x=abs(modDistance-radius);float y=abs(vHeight-radius);float dis=sqrt(pow(x,2.0)+pow(y,2.0));if(dis>radius){discard;}alpha=dis/radius;}gl_FragColor=vec4(vColor.rgb,1.0-alpha);}"})}},
{key:"onChanged",value:function(a,c){this.gl&&(this.dataMgr.onLayerChange(a,c),void 0===a.endTime&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(a){var b=a.gl,c=a.matrix;if((a=this.dataMgr.getData())&&!(0>=a.vertex.length)){var g=this.getOptions(),k=this.program;b.useProgram(k.program);b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);b.enableVertexAttribArray(k.attributes.aPos);b.enableVertexAttribArray(k.attributes.aDistance);
b.enableVertexAttribArray(k.attributes.aColor);b.uniformMatrix4fv(k.uniforms.u_matrix,!1,c);b.uniform1f(k.uniforms.currentTime,this.time);b.uniform1f(k.uniforms.trailLength,g.trailLength);for(c=0;c<a.vertex.length;c++)if(!(0>=a.vertex[c].length)){var h=a.vertex[c],m=(new Float32Array(h[0])).BYTES_PER_ELEMENT;h=m*h[0].length;b.bindBuffer(b.ARRAY_BUFFER,a.vertexBuffer[c]);b.vertexAttribPointer(k.attributes.aPos,4,b.FLOAT,!1,h,0);b.vertexAttribPointer(k.attributes.aDistance,1,b.FLOAT,!1,h,4*m);b.vertexAttribPointer(k.attributes.aColor,
4,b.FLOAT,!1,h,5*m);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,a.indexBuffer[c]);b.drawElements(b.TRIANGLE_STRIP,a.index[c].length,b.UNSIGNED_SHORT,0);b.bindBuffer(b.ARRAY_BUFFER,null);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null)}b.disable(b.BLEND);this.time+=g.step;this.time>this.endTime&&(this.time=this.startTime);b.useProgram(null)}}}]);return a}(ca),Mh=K(function(c,a){a.__esModule=!0;var b=Qa&&Qa.__esModule?Qa:{default:Qa};a.default=function(a,c,g){c in a?(0,b.default)(a,c,{value:g,enumerable:!0,configurable:!0,
writable:!0}):a[c]=g;return a}}),tb=N(Mh),Tb,Ub,Nh=(Tb={},tb(Tb,1,1),tb(Tb,2,1),tb(Tb,3,1),Tb),Oh=(Ub={},tb(Ub,1,1),tb(Ub,2,1),tb(Ub,3,1),Ub),ib=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b,c));b.bufferMap={};b.bufferData=[];b.autoUpdate=!0;return b}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{color:[1,1,1,.8],speed:1,size:5,pointFade:!0,pointFadeBuffer:1,minLineLength:2,animationType:2,shapeType:2,depthTest:!1}}},{key:"initialize",value:function(a){this.gl=
a;var b=this.getOptions();this.updateUniformsFromOptions(b);this.program=new S(this.gl,{vertexShader:"precision highp float;attribute vec3 aPos;attribute vec3 aNextPos;attribute float aIndex;attribute float aNextIndex;attribute float aLength;uniform float uSize;uniform mat4 u_matrix;uniform float uElapsedSteps;uniform int uAnimationType;uniform int uPointFade;uniform float uPointFadeBuffer;varying float vAddOpacity;void main(){if(uAnimationType==1){if(abs(aIndex-mod(uElapsedSteps,aLength))>.1){gl_Position=vec4(-2.,-2.,0,1.0);return;}gl_Position=u_matrix*vec4(aPos.xyz,1.0);vAddOpacity=1.;}else if(uAnimationType==2){float lineLength=aLength-1.;float cIndex=mod(uElapsedSteps,lineLength);float rest=cIndex-aIndex;if(rest<1.&&rest>=0.){if(uPointFade==1){if(cIndex<uPointFadeBuffer){vAddOpacity=cIndex/uPointFadeBuffer;}else if(cIndex>lineLength-uPointFadeBuffer){vAddOpacity=(lineLength-cIndex)/uPointFadeBuffer;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}else if(uAnimationType==3){float percent=mod(uElapsedSteps,aLength)/aLength;if(percent<=aNextIndex&&percent>=aIndex){if(uPointFade==1){float fadePercent=uPointFadeBuffer*1000./aLength;if(percent<fadePercent){vAddOpacity=percent/fadePercent;}else if(percent>1.-fadePercent){vAddOpacity=(1.-percent)/fadePercent;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}float rest=(percent-aIndex)/(aNextIndex-aIndex);gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}gl_PointSize=uSize;}",
fragmentShader:"precision highp float;uniform vec4 uColor;uniform int ushapeType;varying float vAddOpacity;void main(){if(ushapeType==2){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(uColor.rgb,uColor.a*vAddOpacity);}else if(ushapeType==3){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(uColor.rgb,uColor.a*smoothstep(1.0,0.0,d*2.)*vAddOpacity);}else{gl_FragColor=vec4(uColor.rgb,uColor.a*vAddOpacity);}}"});this.buffer=a.createBuffer();
a.bindBuffer(a.ARRAY_BUFFER,this.buffer)}},{key:"bindAttributeBufferData",value:function(a,c,e,g){var b=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b);e=new Float32Array(e);a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW);this.bufferMap[c]={buffer:b,data:e,elementSize:g}}},{key:"onChanged",value:function(a,c){var b=this.gl;if(b){Array.isArray(c)||(c=[]);this.updateUniformsFromOptions(a);var d=[],k=[],h=[],m=[],n=[];a=a.minLineLength;for(var p=0;p<c.length;p++){var l=c[p].geometry.coordinates,q=l.length;
if(!(q<a)){for(var r=0;r<q;++r){var t=this.normizedPoint(l[r]);d.push(t[0]);d.push(t[1]);d.push(t[2]||0);3!==this.animationType&&(k.push(r),m.push(q))}if(1!==this.animationType){t=d.length-3*q+3;r=d.length;for(l=t;l<r;++l)n.push(d[l]);d.splice(r-3,3);if(2===this.animationType)k.pop(),m.pop();else if(3===this.animationType){t-=3;r=d.length-3;l=0;q=[];for(var u=t;u<=r;u+=3)t=Math.sqrt(Math.pow(n[u]-d[u],2)+Math.pow(n[u+1]-d[u+1],2)+Math.pow(n[u+2]-d[u+2],2)),l+=t,q.push(t);k.push(0);u=r=0;for(var w=
q.length-1;u<w;++u)r+=q[u],t=r/l,k.push(t),h.push(t),m.push(l);h.push(1);m.push(l)}}}}this.bindAttributeBufferData(b,"aPos",d,3);this.bindAttributeBufferData(b,"aIndex",k,1);this.bindAttributeBufferData(b,"aLength",m,1);1!==this.animationType&&(this.bindAttributeBufferData(b,"aNextPos",n,3),3===this.animationType&&this.bindAttributeBufferData(b,"aNextIndex",h,1));this.vertCount=d.length/3}}},{key:"updateUniformsFromOptions",value:function(a){this.color=this.normizedColor(a.color);this.startTime=(new Date).getTime();
Nh[a.animationType]||(a.animationType=2);Oh[a.shapeType]||(a.shapeType=2);if(isNaN(a.minLineLength)||2>a.minLineLength)a.minLineLength=2;this.animationType=a.animationType}},{key:"renderAttributeArr",value:function(a,c,e){if(void 0!==c.attributes[e]){var b=this.bufferMap[e];b&&(a.bindBuffer(a.ARRAY_BUFFER,b.buffer),a.enableVertexAttribArray(c.attributes[e]),a.vertexAttribPointer(c.attributes[e],b.elementSize,a.FLOAT,!1,b.data.BYTES_PER_ELEMENT*b.elementSize,0))}}},{key:"render",value:function(a){var b=
a.gl;a=a.matrix;if(!(0>=this.vertCount)){var c=this.program;b.useProgram(c.program);this.renderAttributeArr(b,c,"aPos");this.renderAttributeArr(b,c,"aIndex");this.renderAttributeArr(b,c,"aLength");1!==this.animationType&&(this.renderAttributeArr(b,c,"aNextPos"),3===this.animationType&&this.renderAttributeArr(b,c,"aNextIndex"));var g=(new Date).getTime()-this.startTime;g=1===this.animationType?Math.round(g/1E3*this.options.speed*20):3===this.animationType?g/1E3*this.options.speed*1E3:g/1E3*this.options.speed;
b.uniformMatrix4fv(c.uniforms.u_matrix,!1,a);b.uniform4f(c.uniforms.uColor,this.color[0],this.color[1],this.color[2],this.color[3]);b.uniform1f(c.uniforms.uSize,this.options.size);b.uniform1f(c.uniforms.uElapsedSteps,g);b.uniform1i(c.uniforms.uAnimationType,this.animationType);b.uniform1i(c.uniforms.ushapeType,this.options.shapeType);b.uniform1i(c.uniforms.uPointFade,this.options.pointFade?1:0);b.uniform1f(c.uniforms.uPointFadeBuffer,this.options.pointFadeBuffer);a=this.options.blend;c=this.options.depthTest;
b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);a&&"lighter"===a?b.blendFunc(b.SRC_ALPHA,b.ONE):b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);c||b.disable(b.DEPTH_TEST);b.drawArrays(b.POINTS,0,this.vertCount);b.bindBuffer(b.ARRAY_BUFFER,null);b.disable(b.BLEND);b.disable(b.DEPTH_TEST);b.useProgram(null)}}}]);return a}(ca);ib.ANIMATION_TYPE_LEAP=1;ib.ANIMATION_TYPE_SMOOTH=2;ib.ANIMATION_TYPE_UNIFORM_SPEED=3;ib.SHAPE_TYPE_SQUARE=1;ib.SHAPE_TYPE_CIRCLE=2;ib.SHAPE_TYPE_CIRCLE_GRADIENT=3;var Ph=function(){function c(a,
b){F(this,c);this.layer=a;this.gl=b;this.initData()}J(c,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]}}},{key:"getData",value:function(){return this.outWall3d}},{key:"onLayerChange",value:function(a,b){this.initData();for(var c=a.color,e=a.height,g=a.gradient,k=a.enablePreciseMap,h=this.gl,m=0;m<b.length;m++){for(var n=b[m].geometry.coordinates,p=n.length,l=[],q=[],r=0,t=0;t<p;t++){var u=this.layer.normizedPoint(n[t]);if(0<t&&k){var w=this.layer.normizedPoint(n[t-
1]);r+=Math.sqrt(Math.pow(u[0]-w[0],2)+Math.pow(u[1]-w[1],2))}l.push(u);q.push(r)}p=b[m].color||c;"properties"in b[m]&&"color"in b[m].properties&&(p=b[m].properties.color);g||"[object Function]"!==Object.prototype.toString.call(p)||(p=p(b[m]));n=this.layer.normizedColor(g?g[0]:p);p=this.layer.normizedColor(g?g[1]:p);r=b[m].height||e;"properties"in b[m]&&"height"in b[m].properties&&(r=b[m].properties.height);"[object Function]"===Object.prototype.toString.call(r)&&(r=r(b[m]));this.processData(this.outWall3d,
a,l,q,n,p,r)}for(a=0;a<this.outWall3d.vertex.length;a++){b=[];c=this.outWall3d.vertex[a].length;for(e=0;e<c;e++)b.push.apply(b,aa(this.outWall3d.vertex[a][e]));c=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,c);h.bufferData(h.ARRAY_BUFFER,new Float32Array(b),h.STATIC_DRAW);this.outWall3d.vertexBuffer[a]=c;h.bindBuffer(h.ARRAY_BUFFER,null);c=h.createBuffer();h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,c);h.bufferData(h.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[a]),h.STATIC_DRAW);this.outWall3d.indexBuffer[a]=
c;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(a,b,c,e,g,k,h){var d=e[e.length-1],n=a.vertex[a.vertex.length-1],p=a.index[a.index.length-1],l=c.length;if(!p||65536<=p.length+2*l+2)n=[],p=[],a.vertex.push(n),a.index.push(p);(a=n.length)&&p.push(a-1,a);for(a=0;a<l;a++){var q=[],r=[],t=c[a];q.push(t[0],t[1],h);q.push(g[0],g[1],g[2],g[3]);r.push(t[0],t[1],0);r.push(k[0],k[1],k[2],k[3]);b.texture&&(t=e[a],b.enablePreciseMap?(q.push(t/d,1),r.push(t/d,0)):(q.push(a/(l-1),
1),r.push(a/(l-1),0)));t=n.length;n.push(q,r);p.push(t,t+1)}}}]);return c}(),Qh=function(c){function a(b,c){F(this,a);return O(this,(a.__proto__||L(a)).call(this,b,c))}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{texture:null,enablePreciseMap:!1,height:100,color:[1,1,1,1]}}},{key:"initialize",value:function(a){this.gl=a;this.dataMgr=new Ph(this,this.gl);this.texture=null;this.isUseTexture=!1;this.vertexLength=10;this.program=new S(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform bool uUseTexture;attribute vec3 aPos;attribute vec4 aColor;attribute vec2 aTextureCoords;varying vec2 vTextureCoords;varying vec4 vColor;void main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}if(uUseTexture){vTextureCoords=aTextureCoords;}gl_Position=u_matrix*vec4(aPos,1.0);}",
fragmentShader:"precision highp float;uniform bool uUseTexture;uniform sampler2D uSampler;varying vec2 vTextureCoords;varying vec4 vColor;void main(){if(uUseTexture){gl_FragColor=vec4(1.0,1.0,1.0,1.0)*texture2D(uSampler,vTextureCoords);}else{gl_FragColor=vColor;}}"});this.loadTexture()}},{key:"onChanged",value:function(a,c){var b=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){b.loadTexture(function(){b.dataMgr.onLayerChange(a,c);
b.webglLayer.render()})},0))}},{key:"render",value:function(a){var b=a.gl,c=a.matrix;if((a=this.dataMgr.getData())&&!(0>=a.vertex.length)){var g=this.getOptions(),k=this.program;b.useProgram(k.program);b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);if(g.texture){if(!this.texture)return;b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,this.texture);b.uniform1i(k.uniforms.uSampler,0);b.depthMask(!0);b.depthFunc(b.LESS)}else b.depthMask(!1);g.texture?
b.enableVertexAttribArray(k.attributes.aTextureCoords):b.disableVertexAttribArray(k.attributes.aTextureCoords);b.enableVertexAttribArray(k.attributes.aPos);b.enableVertexAttribArray(k.attributes.aColor);b.uniformMatrix4fv(k.uniforms.u_matrix,!1,c);b.uniform1i(k.uniforms.uUseTexture,this.isUseTexture);for(c=0;c<a.vertex.length;c++)if(!(0>=a.vertex[c].length)){var h=a.vertex[c],m=(new Float32Array(h[0])).BYTES_PER_ELEMENT;h=m*h[0].length;b.bindBuffer(b.ARRAY_BUFFER,a.vertexBuffer[c]);b.vertexAttribPointer(k.attributes.aPos,
3,b.FLOAT,!1,h,0);b.vertexAttribPointer(k.attributes.aColor,4,b.FLOAT,!1,h,3*m);g.texture&&b.vertexAttribPointer(k.attributes.aTextureCoords,2,b.FLOAT,!1,h,7*m);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,a.indexBuffer[c]);b.drawElements(b.TRIANGLE_STRIP,a.index[c].length,b.UNSIGNED_SHORT,0);b.bindBuffer(b.ARRAY_BUFFER,null);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null)}b.disable(b.BLEND);b.useProgram(null)}}},{key:"loadTexture",value:function(a){var b=this,c=this.getOptions();c.texture?(this.isUseTexture=!0,
Ma(this.gl,c.texture,function(c,d){b.image=d;b.texture=c;a&&a();b.webglLayer.render()})):(this.isUseTexture=!1,this.image=this.texture=null,a&&a())}}]);return a}(ca),Rh=function(){function c(a,b){F(this,c);this.layer=a;this.gl=b;this.initData()}J(c,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]};this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",
value:function(a,b){this.initData();var c=a.color,e=a.height,g=a.gradient;a=this.gl;for(var k=0;k<b.length;k++){var h=b[k].geometry.coordinates,m=h.length;this.maxLength=m>this.maxLength?m:this.maxLength;for(var n=[],p=0;p<m;p++){var l=this.layer.normizedPoint(h[p]);n.push(l)}m=b[k].color||c;"properties"in b[k]&&"color"in b[k].properties&&(m=b[k].properties.color);g||"[object Function]"!==Object.prototype.toString.call(m)||(m=m(b[k]));h=this.layer.normizedColor(g?g[0]:m);m=this.layer.normizedColor(g?
g[1]:m);p=b[k].height||e;"properties"in b[k]&&"height"in b[k].properties&&(p=b[k].properties.height);"[object Function]"===Object.prototype.toString.call(p)&&(p=p(b[k]));this.processData(this.outWall3d,n,h,m,p)}for(b=0;b<this.outWall3d.vertex.length;b++){c=[];e=this.outWall3d.vertex[b].length;for(g=0;g<e;g++)c.push.apply(c,aa(this.outWall3d.vertex[b][g]));e=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,e);a.bufferData(a.ARRAY_BUFFER,new Float32Array(c),a.STATIC_DRAW);this.outWall3d.vertexBuffer[b]=
e;a.bindBuffer(a.ARRAY_BUFFER,null);e=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[b]),a.STATIC_DRAW);this.outWall3d.indexBuffer[b]=e;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(a,b,c,e,g){var d=a.vertex[a.vertex.length-1],h=a.index[a.index.length-1],m=b.length;if(!h||65536<=h.length+2*m+2)d=[],h=[],a.vertex.push(d),a.index.push(h);(a=d.length)&&h.push(a-1,a);for(a=0;a<m;a++){var n=
[],p=[],l=b[a];n.push(l[0],l[1]);n.push(l[2]?Number(l[2])+g:g);n.push(l[3]?Number(l[3]):a);n.push(c[0],c[1],c[2],c[3]);p.push(l[0],l[1]);p.push(l[2]?Number(l[2]):0);p.push(l[3]?Number(l[3]):a);p.push(e[0],e[1],e[2],e[3]);l=d.length;d.push(n,p);h.push(l,l+1)}}}]);return c}(),Sh=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b,c));b.startTime=b.options.startTime||0;b.endTime=b.options.endTime;b.time=b.startTime;b.autoUpdate=!0;return b}P(a,c);J(a,[{key:"getDefaultOptions",
value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(a){this.gl=a;this.dataMgr=new Rh(this,this.gl);this.program=new S(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;varying float vTime;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vColor=aColor;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"})}},
{key:"onChanged",value:function(a,c){this.gl&&(this.dataMgr.onLayerChange(a,c),void 0===a.endTime&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(a){var b=a.gl,c=a.matrix;if((a=this.dataMgr.getData())&&!(0>=a.vertex.length)){var g=this.getOptions(),k=this.program;b.useProgram(k.program);b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);b.enableVertexAttribArray(k.attributes.aPos);b.enableVertexAttribArray(k.attributes.aColor);
b.uniformMatrix4fv(k.uniforms.u_matrix,!1,c);b.uniform1f(k.uniforms.currentTime,this.time);b.uniform1f(k.uniforms.trailLength,g.trailLength);for(c=0;c<a.vertex.length;c++)if(!(0>=a.vertex[c].length)){var h=a.vertex[c],m=(new Float32Array(h[0])).BYTES_PER_ELEMENT;h=m*h[0].length;b.bindBuffer(b.ARRAY_BUFFER,a.vertexBuffer[c]);b.vertexAttribPointer(k.attributes.aPos,4,b.FLOAT,!1,h,0);b.vertexAttribPointer(k.attributes.aColor,4,b.FLOAT,!1,h,4*m);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,a.indexBuffer[c]);b.drawElements(b.TRIANGLE_STRIP,
a.index[c].length,b.UNSIGNED_SHORT,0);b.bindBuffer(b.ARRAY_BUFFER,null);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null)}b.disable(b.BLEND);this.time+=g.step;this.time>this.endTime&&(this.time=this.startTime);b.useProgram(null)}}}]);return a}(ca),Th=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b,c));b.simpleLineLayer=new nf(b.getHeatOptions());b.children=[b.simpleLineLayer];return b}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{blend:"normal",gradient:{0:"rgb(50, 50, 256)",
"0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}},{key:"onDataChanged",value:function(a){this.simpleLineLayer.setData(a)}},{key:"onOptionsChanged",value:function(a){this.simpleLineLayer.setOptions(this.getHeatOptions())}},{key:"getHeatOptions",value:function(){var a=this.getOptions(),c=a.max,e=a.min;void 0===c&&(e=this.getDataRange(),c=e.max,e=e.min);var g=new la({max:c,min:e,gradient:a.gradient});a.color=function(a){var b=~~a.count||1;"properties"in a&&"count"in a.properties&&
(b=~~a.properties.count);a=g.getImageData(b);return[a[0]/255,a[1]/255,a[2]/255,a[3]/255]};return a}},{key:"getDataRange",value:function(){var a=this.getData(),c=0,e=0;a[0]&&(c=~~a[0].count||1,e=~~a[0].count||1);"properties"in a[0]&&"count"in a[0].properties&&(c=~~a[0].properties.count,e=~~a[0].properties.count);for(var g=a.length,k=0;k<g;k++){var h=~~a[k].count||1;"properties"in a[k]&&"count"in a[k].properties&&(h=~~a[k].properties.count);c=Math.max(h,c);e=Math.min(h,e)}return{max:c/2,min:e}}}]);
return a}(sb),Uh=K(function(c,a){(function(a,d){c.exports=d()})(qe,function(){function a(b,d,e,g,h){for(;g>e;){if(600<g-e){var k=g-e+1,l=d-e+1,m=Math.log(k),n=.5*Math.exp(2*m/3);m=.5*Math.sqrt(m*n*(k-n)/k)*(0>l-k/2?-1:1);a(b,d,Math.max(e,Math.floor(d-l*n/k+m)),Math.min(g,Math.floor(d+(k-l)*n/k+m)),h)}k=b[d];l=e;n=g;c(b,e,d);for(0<h(b[g],k)&&c(b,e,g);l<n;){c(b,l,n);l++;for(n--;0>h(b[l],k);)l++;for(;0<h(b[n],k);)n--}0===h(b[e],k)?c(b,e,n):(n++,c(b,n,g));n<=d&&(e=n+1);d<=n&&(g=n-1)}}function c(a,b,c){var d=
a[b];a[b]=a[c];a[c]=d}function e(a,b){return a<b?-1:a>b?1:0}function g(a,b){k(a,0,a.children.length,b,a)}function k(a,b,c,d,e){e||(e=t(null));e.minX=Infinity;e.minY=Infinity;e.maxX=-Infinity;for(e.maxY=-Infinity;b<c;b++){var g=a.children[b];h(e,a.leaf?d(g):g)}return e}function h(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY);return a}function m(a,b){return a.minX-b.minX}function n(a,b){return a.minY-b.minY}function p(a){return(a.maxX-
a.minX)*(a.maxY-a.minY)}function l(a){return a.maxX-a.minX+(a.maxY-a.minY)}function q(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function r(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function t(a){return{children:a,height:1,leaf:!0,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function u(b,c,d,g,h){for(var k=[c,d];k.length;)if(d=k.pop(),c=k.pop(),!(d-c<=g)){var l=c+Math.ceil((d-c)/g/2)*g;a(b,l,c||0,d||b.length-1,h||e);k.push(c,
l,l,d)}}var w=function(a){void 0===a&&(a=9);this._maxEntries=Math.max(4,a);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));this.clear()};w.prototype.all=function(){return this._all(this.data,[])};w.prototype.search=function(a){var b=this.data,c=[];if(!r(a,b))return c;for(var d=this.toBBox,e=[];b;){for(var g=0;g<b.children.length;g++){var h=b.children[g],k=b.leaf?d(h):h;r(a,k)&&(b.leaf?c.push(h):q(a,k)?this._all(h,c):e.push(h))}b=e.pop()}return c};w.prototype.collides=function(a){var b=
this.data;if(!r(a,b))return!1;for(var c=[];b;){for(var d=0;d<b.children.length;d++){var e=b.children[d],g=b.leaf?this.toBBox(e):e;if(r(a,g)){if(b.leaf||q(a,g))return!0;c.push(e)}}b=c.pop()}return!1};w.prototype.load=function(a){if(!a||!a.length)return this;if(a.length<this._minEntries){for(var b=0;b<a.length;b++)this.insert(a[b]);return this}a=this._build(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(b=this.data,
this.data=a,a=b),this._insert(a,this.data.height-a.height-1,!0)):this.data=a;return this};w.prototype.insert=function(a){a&&this._insert(a,this.data.height-1);return this};w.prototype.clear=function(){this.data=t([]);return this};w.prototype.remove=function(a,b){if(!a)return this;for(var c=this.data,d=this.toBBox(a),e=[],g=[],h,k,l;c||e.length;){c||(c=e.pop(),k=e[e.length-1],h=g.pop(),l=!0);if(c.leaf){a:{var m=a;var n=c.children,p=b;if(p){for(var v=0;v<n.length;v++)if(p(m,n[v])){m=v;break a}m=-1}else m=
n.indexOf(m)}if(-1!==m){c.children.splice(m,1);e.push(c);this._condense(e);break}}l||c.leaf||!q(c,d)?k?(h++,c=k.children[h],l=!1):c=null:(e.push(c),g.push(h),h=0,k=c,c=c.children[0])}return this};w.prototype.toBBox=function(a){return a};w.prototype.compareMinX=function(a,b){return a.minX-b.minX};w.prototype.compareMinY=function(a,b){return a.minY-b.minY};w.prototype.toJSON=function(){return this.data};w.prototype.fromJSON=function(a){this.data=a;return this};w.prototype._all=function(a,b){for(var c=
[];a;)a.leaf?b.push.apply(b,a.children):c.push.apply(c,a.children),a=c.pop();return b};w.prototype._build=function(a,b,c,d){var e=c-b+1,h=this._maxEntries;if(e<=h){var k=t(a.slice(b,c+1));g(k,this.toBBox);return k}d||(d=Math.ceil(Math.log(e)/Math.log(h)),h=Math.ceil(e/Math.pow(h,d-1)));k=t([]);k.leaf=!1;k.height=d;e=Math.ceil(e/h);h=e*Math.ceil(Math.sqrt(h));for(u(a,b,c,h,this.compareMinX);b<=c;b+=h){var l=Math.min(b+h-1,c);u(a,b,l,e,this.compareMinY);for(var m=b;m<=l;m+=e)k.children.push(this._build(a,
m,Math.min(m+e-1,l),d-1))}g(k,this.toBBox);return k};w.prototype._chooseSubtree=function(a,b,c,d){for(;;){d.push(b);if(b.leaf||d.length-1===c)break;for(var e=Infinity,g=Infinity,h=void 0,k=0;k<b.children.length;k++){var l=b.children[k],m=p(l),n=(Math.max(l.maxX,a.maxX)-Math.min(l.minX,a.minX))*(Math.max(l.maxY,a.maxY)-Math.min(l.minY,a.minY))-m;n<g?(g=n,e=m<e?m:e,h=l):n===g&&m<e&&(e=m,h=l)}b=h||b.children[0]}return b};w.prototype._insert=function(a,b,c){c=c?a:this.toBBox(a);var d=[],e=this._chooseSubtree(c,
this.data,b,d);e.children.push(a);for(h(e,c);0<=b;)if(d[b].children.length>this._maxEntries)this._split(d,b),b--;else break;this._adjustParentBBoxes(c,d,b)};w.prototype._split=function(a,b){var c=a[b],d=c.children.length,e=this._minEntries;this._chooseSplitAxis(c,e,d);d=this._chooseSplitIndex(c,e,d);d=t(c.children.splice(d,c.children.length-d));d.height=c.height;d.leaf=c.leaf;g(c,this.toBBox);g(d,this.toBBox);b?a[b-1].children.push(d):this._splitRoot(c,d)};w.prototype._splitRoot=function(a,b){this.data=
t([a,b]);this.data.height=a.height+1;this.data.leaf=!1;g(this.data,this.toBBox)};w.prototype._chooseSplitIndex=function(a,b,c){for(var d,e=Infinity,g=Infinity,h=b;h<=c-b;h++){var l=k(a,0,h,this.toBBox),m=k(a,h,c,this.toBBox);var n=Math.max(0,Math.min(l.maxX,m.maxX)-Math.max(l.minX,m.minX))*Math.max(0,Math.min(l.maxY,m.maxY)-Math.max(l.minY,m.minY));l=p(l)+p(m);n<e?(e=n,d=h,g=l<g?l:g):n===e&&l<g&&(g=l,d=h)}return d||c-b};w.prototype._chooseSplitAxis=function(a,b,c){var d=a.leaf?this.compareMinX:m,
e=a.leaf?this.compareMinY:n,g=this._allDistMargin(a,b,c,d);b=this._allDistMargin(a,b,c,e);g<b&&a.children.sort(d)};w.prototype._allDistMargin=function(a,b,c,d){a.children.sort(d);d=this.toBBox;for(var e=k(a,0,b,d),g=k(a,c-b,c,d),m=l(e)+l(g),n=b;n<c-b;n++){var p=a.children[n];h(e,a.leaf?d(p):p);m+=l(e)}for(c=c-b-1;c>=b;c--)e=a.children[c],h(g,a.leaf?d(e):e),m+=l(g);return m};w.prototype._adjustParentBBoxes=function(a,b,c){for(;0<=c;c--)h(b[c],a)};w.prototype._condense=function(a){for(var b=a.length-
1,c;0<=b;b--)0===a[b].children.length?0<b?(c=a[b-1].children,c.splice(c.indexOf(a[b]),1)):this.clear():g(a[b],this.toBBox)};return w})}),ub=window.devicePixelRatio,vb=Math.max(2,ub),yd=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b,c));c=b.canvas=document.createElement("canvas");c=b.ctx=c.getContext("2d");c.textAlign="start";c.textBaseline="top";return b}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{color:"#fff",fontFamily:"Microsoft Yahei",fontSize:14,
isFlat:!1,collides:!0,offset:[0,0],padding:[2,2],margin:[0,0]}}},{key:"initialize",value:function(a){this.gl=a;var b=this.getOptions();this.texture=null;this.program=new S(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform bool uFlat;uniform float zoomUnits;uniform float devicePixelRatio;uniform vec2 offset;attribute vec3 position;attribute float corner;attribute vec2 size;attribute vec2 aTextCoord;varying vec2 vTextCoord;vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x-=size[0];y+=size[1];}else if(corner==2.0){x+=size[0];y+=size[1];}else if(corner==3.0){x+=size[0];y-=size[1];}else{x-=size[0];y-=size[1];}return vec3(x,y,coord.z);}void main(){vec2 pixelOffset=offset*zoomUnits;vTextCoord=aTextCoord;if(uFlat){vec2 halfSize=size/2.0*zoomUnits;vec3 current=transformCoord(position,halfSize,corner);gl_Position=matrix*vec4(current.x+pixelOffset[0],current.y+pixelOffset[1],current.z,1.0);}else{vec4 projection=matrix*vec4(position.x+pixelOffset[0],position.y+pixelOffset[1],position.z,1.0);vec3 screen=projection.xyz/projection.w;vec2 halfSize=size/MAPV_resolution*devicePixelRatio;vec3 current=transformCoord(screen,halfSize,corner);gl_Position=vec4(current,1.0);}}",
fragmentShader:"precision highp float;uniform sampler2D textureImage;uniform vec4 uSelectedColor;varying vec2 vTextCoord;void main(){gl_FragColor=texture2D(textureImage,vec2(vTextCoord.x,1.0-vTextCoord.y));\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}\n#endif\n}",defines:b.enablePicked?["PICK"]:[]},this);this.vertexBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.uvBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.indexBuffer=
new H({gl:a,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});b=[{name:"position",buffer:this.vertexBuffer,size:3,stride:24,type:"FLOAT",offset:0},{name:"corner",buffer:this.vertexBuffer,size:1,stride:24,type:"FLOAT",offset:12},{name:"size",buffer:this.vertexBuffer,size:2,stride:24,type:"FLOAT",offset:16},{name:"aTextCoord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}];b=b.concat(this.getCommonAttributes());this.vertexArray=new wa({gl:a,program:this.program,attributes:b})}},{key:"onChanged",
value:function(a,c){this.gl&&this.processCache(c)}},{key:"processCache",value:function(a){this.cachedData=[];for(var b=0;b<a.length;b++){var c=this.normizedPoint(a[b].geometry.coordinates),g=a[b].text||"";"properties"in a[b]&&"text"in a[b].properties&&(g=a[b].properties.text);c&&g&&this.cachedData.push({point:c,text:g})}}},{key:"render",value:function(a){if(this.cachedData&&this.cachedData.length&&this.map){var b=a.gl,c=a.matrix,g=this.getOptions(),k=this.program;k.use(b);this.updateText(a);b.enable(b.BLEND);
b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);b.disable(b.DEPTH_TEST);var h=this.map.getZoomUnits();k.setUniforms(W(this.getCommonUniforms(a),{matrix:c,devicePixelRatio:ub,textureImage:this.texture,uFlat:g.isFlat,offset:g.offset,zoomUnits:h}));0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),b.drawElements(b.TRIANGLES,this.index.length,b.UNSIGNED_INT,0));b.useProgram(null)}}},{key:"updateText",value:function(a){var b=a.gl,c=a.matrix,g=this.getOptions(),k=g.color,h=g.fontSize,
m=g.fontFamily;a=g.padding;var n=g.margin,p=g.collides;g=g.enablePicked;var l=b.canvas.width,q=b.canvas.height,r=this.canvas;b=this.ctx;b.save();b.scale(vb,vb);b.textBaseline="top";b.font=h+"px "+m;for(var t=new Uh,u=[],w=0;w<this.cachedData.length;w++){var y=this.cachedData[w],v=y.point;y=y.text;var z=gb(v,3);z=zc.clone([z[0],z[1],z[2],1]);zc.transformMat4(z,z,c);zc.scale(z,z,1/z[3]);var A=(z[0]+1)/2*l,D=(-z[1]+1)/2*q,B=b.measureText(y);z=B.width+a[0];B=B.actualBoundingBoxAscent&&B.actualBoundingBoxDescent?
B.actualBoundingBoxDescent-B.actualBoundingBoxAscent:h+a[1];B+=a[1];var E=z+n[0],I=h+n[1];A-=E/2*ub;D-=I/2*ub;E=A+E*ub;I=D+I*ub;if(!(0>E||0>I||A>l||D>q)){if(p){I={minX:A,maxX:E,minY:D,maxY:I};if(t.collides(I))continue;t.insert(I)}u.push({w:z,h:B,point:v,text:y})}}b.restore();n=pe(u);c=zb(n.w);n=zb(n.h);r.width=c*vb;r.height=n*vb;b.save();b.scale(vb,vb);b.textBaseline="top";b.fillStyle=k;b.font=h+"px "+m;k=[];h=[];m=[];r=[];p=0;for(l=u.length;p<l;++p){q=u[p];b.fillText(q.text,q.x+a[0],q.y+a[1]);v=
gb(q.point,3);t=v[0];w=v[1];v=v[2];for(y=0;4>y;y++)k.push(t,w,v),k.push(y),k.push(q.w,q.h);t=q.x/c;w=(q.x+q.w)/c;v=(q.y+q.h)/n;q=q.y/n;h.push(t,v,t,q,w,q,w,v);q=4*p;m.push(q,q+2,q+1,q,q+3,q+2);g&&(q=this.indexToRgb(p),r.push(q[0]/255,q[1]/255,q[2]/255),r.push(q[0]/255,q[1]/255,q[2]/255),r.push(q[0]/255,q[1]/255,q[2]/255),r.push(q[0]/255,q[1]/255,q[2]/255))}b.restore();this.loadTexture();this.index=m;this.vertexBuffer.updateData(new Float32Array(k));this.uvBuffer.updateData(new Float32Array(h));this.indexBuffer.updateData(new Uint32Array(m));
g&&this.pickBuffer.updateData(new Float32Array(r))}},{key:"loadTexture",value:function(){var a=this;this.canvas?Ma(this.gl,this.canvas,function(b){a.texture=b}):this.texture=null}}]);return a}(ca),rf=K(function(c,a){(function(a,d){c.exports=d()})(qe,function(){function a(b,d,e,g,h,k){if(!(h-g<=e)){var l=g+h>>1;c(b,d,l,g,h,k%2);a(b,d,e,g,l-1,k+1);a(b,d,e,l+1,h,k+1)}}function c(a,b,d,g,h,k){for(;h>g;){if(600<h-g){var l=h-g+1,m=d-g+1,n=Math.log(l),p=.5*Math.exp(2*n/3);n=.5*Math.sqrt(n*p*(l-p)/l)*(0>
m-l/2?-1:1);c(a,b,d,Math.max(g,Math.floor(d-m*p/l+n)),Math.min(h,Math.floor(d+(l-m)*p/l+n)),k)}l=b[2*d+k];m=g;p=h;e(a,b,g,d);for(b[2*h+k]>l&&e(a,b,g,h);m<p;){e(a,b,m,p);m++;for(p--;b[2*m+k]<l;)m++;for(;b[2*p+k]>l;)p--}b[2*g+k]===l?e(a,b,g,p):(p++,e(a,b,p,h));p<=d&&(g=p+1);d<=p&&(h=p-1)}}function e(a,b,c,d){g(a,c,d);g(b,2*c,2*d);g(b,2*c+1,2*d+1)}function g(a,b,c){var d=a[b];a[b]=a[c];a[c]=d}function k(a,b){a=a.geometry.coordinates;return{x:a[0]/360+.5,y:n(a[1]),zoom:Infinity,index:b,parentId:-1}}function h(a){var b=
a.id,c=m(a);return{type:"Feature",id:b,properties:c,geometry:{type:"Point",coordinates:[360*(a.x-.5),360*Math.atan(Math.exp((180-360*a.y)*Math.PI/180))/Math.PI-90]}}}function m(a){var b=a.numPoints,c=1E4<=b?Math.round(b/1E3)+"k":1E3<=b?Math.round(b/100)/10+"k":b;return p(p({},a.properties),{cluster:!0,cluster_id:a.id,point_count:b,point_count_abbreviated:c})}function n(a){a=Math.sin(a*Math.PI/180);a=.5-.25*Math.log((1+a)/(1-a))/Math.PI;return 0>a?0:1<a?1:a}function p(a,b){for(var c in b)a[c]=b[c];
return a}function l(a){return a.x}function q(a){return a.y}var r=function(a){return a[0]},t=function(a){return a[1]},u=function(b,c,d,e,g){void 0===c&&(c=r);void 0===d&&(d=t);void 0===e&&(e=64);void 0===g&&(g=Float64Array);this.nodeSize=e;this.points=b;var h=this.ids=new (65536>b.length?Uint16Array:Uint32Array)(b.length);g=this.coords=new g(2*b.length);for(var k=0;k<b.length;k++)h[k]=k,g[2*k]=c(b[k]),g[2*k+1]=d(b[k]);a(h,g,e,0,h.length-1,0)};u.prototype.range=function(a,b,c,d){for(var e=this.ids,
g=this.coords,h=this.nodeSize,k=[0,e.length-1,0],l=[],m,n;k.length;){var p=k.pop(),q=k.pop(),r=k.pop();if(q-r<=h)for(p=r;p<=q;p++)m=g[2*p],n=g[2*p+1],m>=a&&m<=c&&n>=b&&n<=d&&l.push(e[p]);else{var t=Math.floor((r+q)/2);m=g[2*t];n=g[2*t+1];m>=a&&m<=c&&n>=b&&n<=d&&l.push(e[t]);var v=(p+1)%2;if(0===p?a<=m:b<=n)k.push(r),k.push(t-1),k.push(v);if(0===p?c>=m:d>=n)k.push(t+1),k.push(q),k.push(v)}}return l};u.prototype.within=function(a,b,c){for(var d=this.ids,e=this.coords,g=this.nodeSize,h=[0,d.length-1,
0],k=[],l=c*c;h.length;){var m=h.pop(),n=h.pop(),p=h.pop();if(n-p<=g)for(m=p;m<=n;m++){p=e[2*m]-a;var q=e[2*m+1]-b;p*p+q*q<=l&&k.push(d[m])}else{q=Math.floor((p+n)/2);var r=e[2*q],t=e[2*q+1],v=r-a,u=t-b;v*v+u*u<=l&&k.push(d[q]);v=(m+1)%2;if(0===m?a-c<=r:b-c<=t)h.push(p),h.push(q-1),h.push(v);if(0===m?a+c>=r:b+c>=t)h.push(q+1),h.push(n),h.push(v)}}return k};var w={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(a){return a}},y=function(a){this.options=
p(ch(w),a);this.trees=Array(this.options.maxZoom+1)};y.prototype.load=function(a){var b=this.options,c=b.minZoom,d=b.maxZoom;b=b.nodeSize;this.points=a;for(var e=[],g=0;g<a.length;g++)a[g].geometry&&e.push(k(a[g],g));this.trees[d+1]=new u(e,l,q,b,Float32Array);for(a=d;a>=c;a--)e=this._cluster(e,a),this.trees[a]=new u(e,l,q,b,Float32Array);return this};y.prototype.getClusters=function(a,b){var c=((a[0]+180)%360+360)%360-180,d=Math.max(-90,Math.min(90,a[1])),e=180===a[2]?180:((a[2]+180)%360+360)%360-
180,g=Math.max(-90,Math.min(90,a[3]));if(360<=a[2]-a[0])c=-180,e=180;else if(c>e)return c=this.getClusters([c,d,180,g],b),d=this.getClusters([-180,d,e,g],b),c.concat(d);b=this.trees[this._limitZoom(b)];a=[];var k=0;for(d=b.range(c/360+.5,n(g),e/360+.5,n(d));k<d.length;k+=1)e=b.points[d[k]],a.push(e.numPoints?h(e):this.points[e.index]);return a};y.prototype.getChildren=function(a){var b=this._getOriginId(a),c=this._getOriginZoom(a),d=this.trees[c];if(!d)throw Error("No cluster with the specified id.");
var e=d.points[b];if(!e)throw Error("No cluster with the specified id.");b=[];var g=0;for(c=d.within(e.x,e.y,this.options.radius/(this.options.extent*Math.pow(2,c-1)));g<c.length;g+=1)e=d.points[c[g]],e.parentId===a&&b.push(e.numPoints?h(e):this.points[e.index]);if(0===b.length)throw Error("No cluster with the specified id.");return b};y.prototype.getLeaves=function(a,b,c){var d=[];this._appendLeaves(d,a,b||10,c||0,0);return d};y.prototype.getTile=function(a,b,c){var d=this.trees[this._limitZoom(a)];
a=Math.pow(2,a);var e=this.options;e=e.radius/e.extent;var g=(c-e)/a,h=(c+1+e)/a,k={features:[]};this._addTileFeatures(d.range((b-e)/a,g,(b+1+e)/a,h),d.points,b,c,a,k);0===b&&this._addTileFeatures(d.range(1-e/a,g,1,h),d.points,a,c,a,k);b===a-1&&this._addTileFeatures(d.range(0,g,e/a,h),d.points,-1,c,a,k);return k.features.length?k:null};y.prototype.getClusterExpansionZoom=function(a){for(var b=this._getOriginZoom(a)-1;b<=this.options.maxZoom;){a=this.getChildren(a);b++;if(1!==a.length)break;a=a[0].properties.cluster_id}return b};
y.prototype._appendLeaves=function(a,b,c,d,e){var g=0;for(b=this.getChildren(b);g<b.length;g+=1){var h=b[g],k=h.properties;k&&k.cluster?e=e+k.point_count<=d?e+k.point_count:this._appendLeaves(a,k.cluster_id,c,d,e):e<d?e++:a.push(h);if(a.length===c)break}return e};y.prototype._addTileFeatures=function(a,b,c,d,e,g){for(var h=0;h<a.length;h+=1){var k=b[a[h]],l=k.numPoints,n={type:1,geometry:[[Math.round(this.options.extent*(k.x*e-c)),Math.round(this.options.extent*(k.y*e-d))]],tags:l?m(k):this.points[k.index].properties},
p=void 0;l?p=k.id:this.options.generateId?p=k.index:this.points[k.index].id&&(p=this.points[k.index].id);void 0!==p&&(n.id=p);g.features.push(n)}};y.prototype._limitZoom=function(a){return Math.max(this.options.minZoom,Math.min(a,this.options.maxZoom+1))};y.prototype._cluster=function(a,b){var c=[],d=this.options,e=d.reduce;d=d.radius/(d.extent*Math.pow(2,b));for(var g=0;g<a.length;g++){var h=a[g];if(!(h.zoom<=b)){h.zoom=b;for(var k=this.trees[b+1],l=k.within(h.x,h.y,d),m=h.numPoints||1,n=h.x*m,p=
h.y*m,q=e&&1<m?this._map(h,!0):null,r=(g<<5)+(b+1)+this.points.length,t=0;t<l.length;t+=1){var v=k.points[l[t]];if(!(v.zoom<=b)){v.zoom=b;var u=v.numPoints||1;n+=v.x*u;p+=v.y*u;m+=u;v.parentId=r;e&&(q||(q=this._map(h,!0)),e(q,this._map(v)))}}1===m?c.push(h):(h.parentId=r,c.push({x:n/m,y:p/m,zoom:Infinity,id:r,parentId:-1,numPoints:m,properties:q}))}}return c};y.prototype._getOriginId=function(a){return a-this.points.length>>5};y.prototype._getOriginZoom=function(a){return(a-this.points.length)%32};
y.prototype._map=function(a,b){if(a.numPoints)return b?p({},a.properties):a.properties;a=this.points[a.index].properties;var c=this.options.map(a);return b&&c===a?p({},c):c};return y})}),Vh=function(c){function a(b){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b));b.shapeLayer=new Ac(b.options);b.textLayer=new yd(b.options.textOptions);b.children=[b.shapeLayer,b.textLayer];b.max=[];return b}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{size:50,height:0,maxZoom:19,minZoom:5,gradient:{0:"rgb(50, 50, 256)",
"0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"},enableCluster:!1,showText:!0,textOptions:{fontSize:13,color:"white"}}}},{key:"onOptionsChanged",value:function(a){this.textLayer.setOptions(a.textOptions)}},{key:"setOptions",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=this.options.textOptions;a.textOptions&&W(c,a.textOptions);var e=a.minZoom,g=a.maxZoom,k=a.size;e=g&&g!==this.options.maxZoom||e&&e!==this.options.minZoom||k&&k!==this.options.size;
W(this.options,a,{textOptions:c});if(e)this.onChanged(this.options,this.data);else this.refreshLayer();this.onOptionsChanged(this.getOptions())}},{key:"onChanged",value:function(a,c){if(c&&c.length){this.zoom=Math.floor(this.map.map.getZoom());var b=a.maxZoom,d=a.minZoom,k=a.enableCluster;a=a.size;this.zoom>b?this.zoom=b:this.zoom<d&&(this.zoom=d);k&&(this.supercluster=new rf({maxZoom:b,minZoom:d,radius:a/2}),this.supercluster.load(c));this.refreshLayer()}}},{key:"refreshLayer",value:function(){var a=
0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.data,e=this.map.map,g=this.zoom;a.enableCluster&&(c=this.getClusterData(a));if(c&&c.length){var k=a.gradient,h=a.showText,m=a.textOptions,n=a.height,p=a.size;p*=Math.pow(2,18-g);c=gg(c,p,function(a){var b=gb(a,2),c=b[0];b=b[1];-180<=c&&180>=c&&-90<=b&&90>=b&&(b=e.lnglatToMercator(c,b),c=b[0],b=b[1]);a[0]=c;a[1]=b;return a});this.max[g]=Math.max(this.max[g]||0,c.max);var l=
new la({max:this.max[g],min:0,maxSize:n*Math.pow(2,18-g),minSize:0,gradient:k});k=[];if(h){var q=m&&m.format;q="function"===typeof q?q:null;k=c.map(function(a){return{geometry:{coordinates:[a.center.x,a.center.y,l.getSize(a.count)+m.fontSize/2*Math.pow(2,18-g)]},text:q?q(a.count):a.count}})}this.textLayer.setData(k);h=c.map(function(a){for(var b=a.center,d=c.r,e=[],g=0;6>g;g++)e.push(fg({x:b.x,y:b.y},d,g));return{geometry:{type:"Polygon",coordinates:[e]},properties:{height:l.getSize(a.count),color:l.getColor(a.count)}}});
this.shapeLayer.setData(h);a.enablePicked&&a.autoSelect&&this.pick(-1,-1)}}},{key:"getClusterData",value:function(){var a=this.map.map,c=a.getBounds(),e=c.ne;c=c.sw;this.ne=e;this.sw=c;var g=e,k=g.lng;g=g.lat;var h=[];-180<=k&&180>=k&&-90<=g&&90>=g?h=[c.lng,c.lat,e.lng,e.lat]:(e=a.mercatorToLnglat(this.ne.lng,this.ne.lat),c=a.mercatorToLnglat(this.sw.lng,this.sw.lat),h=c.concat(e));return this.supercluster.getClusters(h,this.zoom).map(function(a){var b=0;a.properties&&a.properties.point_count&&(b=
a.properties.point_count);return{geometry:a.geometry,count:b}})}},{key:"pick",value:function(a,c){return this.shapeLayer.pick(a,c)}},{key:"shouldUpdate",value:function(){if(!this.data)return!1;var a=this.map.map,c=Math.floor(a.getZoom()),e=this.options,g=e.maxZoom;e=e.minZoom;c>g?c=g:c<e&&(c=e);if(this.zoom!==c)return this.zoom=c,!0;if(!this.options.enableCluster)return!1;c=a.getBounds();a=c.ne;c=c.sw;if(this.ne.lng!==a.lng||this.ne.lat!==a.lat||this.sw.lng!==c.lng||this.sw.lat!==c.lat)return!0}},
{key:"render",value:function(b){this.shouldUpdate()?this.refreshLayer():Ya(a.prototype.__proto__||L(a.prototype),"render",this).call(this,b)}}]);return a}(sb),Vb=function(){function c(a,b){F(this,c);this.map=a;this.options=b||{}}J(c,[{key:"onResize",value:function(a){}},{key:"onUpdate",value:function(a){throw"\u672a\u5b9e\u73b0onUpdate\u65b9\u6cd5";}},{key:"getContainer",value:function(){throw"\u672a\u5b9e\u73b0getContainer\u65b9\u6cd5";}},{key:"getSize",value:function(){throw"\u672a\u5b9e\u73b0getSize\u65b9\u6cd5";
}},{key:"getTilt",value:function(){throw"\u672a\u5b9e\u73b0getTilt\u65b9\u6cd5";}},{key:"getHeading",value:function(){throw"\u672a\u5b9e\u73b0getHeading\u65b9\u6cd5";}},{key:"getZoomUnits",value:function(){throw"\u672a\u5b9e\u73b0getZoomUnits\u65b9\u6cd5";}},{key:"getCenter",value:function(){throw"\u672a\u5b9e\u73b0getCenter\u65b9\u6cd5";}},{key:"getMapType",value:function(){throw"\u672a\u5b9e\u73b0getMapType\u65b9\u6cd5";}},{key:"lnglatToMercator",value:function(a,b){if("gcj02"===this.options.coordinateSystem)return b=
b*Math.PI/180,b=3189068.5*Math.log((1+Math.sin(b))/(1-Math.sin(b))),[parseFloat((a*Math.PI/180*6378137).toFixed(2)),parseFloat(b.toFixed(2))];a=ua.convertLL2MC({lng:a,lat:b});return[a.lng,a.lat]}}]);return c}(),Wh=function(c){function a(b){F(this,a);return O(this,(a.__proto__||L(a)).call(this,b))}P(a,c);J(a,[{key:"onResize",value:function(a){this.map.addEventListener("resize",a)}},{key:"onMousemove",value:function(a){this.map.addEventListener("mousemove",function(b){a({x:b.x,y:b.y})})}},{key:"onClick",
value:function(a){this.map.addEventListener("click",function(b){a({x:b.x,y:b.y})})}},{key:"onDblClick",value:function(a){this.map.addEventListener("dblclick",function(b){a({x:b.x,y:b.y})})}},{key:"onRightClick",value:function(a){this.map.addEventListener("rightclick",function(b){a({x:b.x,y:b.y})})}},{key:"onUpdate",value:function(a){this.map.addEventListener("update",a);this.map.addEventListener("onearthstatuschange",a)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getSize",
value:function(){return this.map.getSize()}},{key:"getTilt",value:function(){return this.map.getTilt()}},{key:"getHeading",value:function(){return this.map.getHeading()}},{key:"getZoomUnits",value:function(){return this.map.getZoomUnits()}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getCenter",value:function(){var a=this.map.getCenter();-180<=a.lng&&180>=a.lng&&(a=this.map.lnglatToMercator(a.lng,a.lat),a={lng:a[0],lat:a[1]});return a}},{key:"getMapType",value:function(){return this.map.getMapType()}},
{key:"lnglatToMercator",value:function(a,c){return this.map.lnglatToMercator(a,c)}}]);return a}(Vb),Xh=function(c){function a(b){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b));b.div=document.createElement("div");b.div.style.position="absolute";b.div.style.userSelect="none";b.map.getPanes().mapPane.appendChild(b.div);return b}P(a,c);J(a,[{key:"onResize",value:function(a){this.map.addEventListener("resize",a)}},{key:"onMousemove",value:function(a){this.map.addEventListener("mousemove",function(b){a({x:b.pixel.x,
y:b.pixel.y})})}},{key:"onClick",value:function(a){this.map.addEventListener("click",function(b){a({x:b.pixel.x,y:b.pixel.y})})}},{key:"onDblClick",value:function(a){this.map.addEventListener("dblclick",function(b){a({x:b.pixel.x,y:b.pixel.y})})}},{key:"onRightClick",value:function(a){this.map.addEventListener("rightclick",function(b){a({x:b.pixel.x,y:b.pixel.y})})}},{key:"changeCanvas",value:function(){var a=this.map,c=a.getSize(),e=a.getCenter();a=a.pointToOverlayPixel(e);this.div.style.left=a.x-
c.width/2+"px";this.div.style.top=a.y-c.height/2+"px"}},{key:"onUpdate",value:function(a){var b=this;this.map.addEventListener("moveend",function(){b.changeCanvas();a()});this.map.addEventListener("moving",function(){b.changeCanvas();a()});this.map.addEventListener("zoomend",function(){b.changeCanvas();a()})}},{key:"getContainer",value:function(){return this.div}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getTilt",value:function(){return 0}},{key:"getHeading",value:function(){return 0}},
{key:"getZoomUnits",value:function(){return Math.pow(2,18-this.map.getZoom())}},{key:"getCenter",value:function(){var a=this.map.getMapType().getProjection().lngLatToPoint(this.map.getCenter());return{lng:a.x,lat:a.y}}}]);return a}(Vb),Yh=function(c){function a(b){F(this,a);return O(this,(a.__proto__||L(a)).call(this,b))}P(a,c);J(a,[{key:"onResize",value:function(a){window.addEventListener("resize",a)}},{key:"onUpdate",value:function(a){}},{key:"getContainer",value:function(){return this.map.container.getElementsByClassName("cesium-widget")[0]}},
{key:"getSize",value:function(){var a=this.map;return{width:a.canvas.clientWidth,height:a.canvas.clientHeight}}},{key:"getTilt",value:function(){return 180*this.map.camera.pitch/Math.PI+90}},{key:"getHeading",value:function(){return 360-180*this.map.camera.heading/Math.PI}},{key:"getZoomUnits",value:function(){var a=this.map;return 6.8*a.scene.globe.ellipsoid.cartesianToCartographic(a.camera.position).height/6500}},{key:"getZoom",value:function(){return 10}},{key:"getCenter",value:function(){var a=
this.map;a=a.camera.pickEllipsoid(new Cesium.Cartesian2(a.canvas.clientWidth/2,a.canvas.clientHeight/2));a=Cesium.Ellipsoid.WGS84.cartesianToCartographic(a);a=this.getMercator([180*a.longitude/Math.PI,180*a.latitude/Math.PI]);return{lng:a[0],lat:a[1]}}},{key:"getMercator",value:function(a){var b=[];b[0]=a[0]*Math.PI/180*6378137;a=a[1]*Math.PI/180;b[1]=3189068.5*Math.log((1+Math.sin(a))/(1-Math.sin(a)));return b}}]);return a}(Vb),Zh=function(c){function a(b){F(this,a);return O(this,(a.__proto__||L(a)).call(this,
b))}P(a,c);J(a,[{key:"onResize",value:function(a){window.addEventListener("resize",a)}},{key:"onUpdate",value:function(a){}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getCenter",
value:function(){return this.map.center}}]);return a}(Vb),$h=function(c){function a(b,c){F(this,a);return O(this,(a.__proto__||L(a)).call(this,b,c))}P(a,c);J(a,[{key:"onResize",value:function(a){window.addEventListener("resize",a)}},{key:"onUpdate",value:function(a){}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},
{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getCenter",value:function(){return this.map.center}}]);return a}(Vb),sf=function(){function c(a,b){F(this,c);b=b||{};"bmap"===b.mapType?this.map=new Xh(a,b):"blank"===b.mapType?this.map=new Zh(a,b):"cesium"===b.mapType?this.map=new Yh(a,b):"three"===b.mapType?this.map=new $h(a,b):(b.mapType="bmapgl",this.map=new Wh(a,b));this.map.type=b.mapType;this.options=b||{};this.renderArr=
[];(a=b.canvas)||(a=document.createElement("canvas"));this.canvas=a;this.gl=b.gl?b.gl:Rd(a);this.gl.getExtension("OES_element_index_uint");this.changeSize();this.projectionMatrix=R.create(Float64Array);this.orthoMatrix=R.create(Float64Array);this.matrix=R.create(Float64Array);this.viewMatrix=R.create(Float64Array);this.pointToPixelMatrix=R.create(Float64Array);this.pixelToViewMatrix=R.create(Float64Array);this.fovy=35;this._animation=this.animation.bind(this);this._update=this.update.bind(this);this.onInitialize(this.options.onInitialize);
this.options.onRender&&this.renderArr.push(this.options.onRender);this.stateManager=new bf({gl:this.gl});this.pickFBO=new sa(this.gl);this.transferOptions={};this.bind()}J(c,[{key:"bind",value:function(){var a=this,b=this.map;b.onResize(function(){a.changeSize();a.render()});b.onUpdate(this._update);b.onClick&&b.onClick(function(b){a.onClick&&a.onClick(b)});b.onDblClick&&b.onDblClick(function(b){a.onDblClick&&a.onDblClick(b)});b.onRightClick&&b.onRightClick(function(b){a.onRightClick&&a.onRightClick(b)});
b.onMousemove&&b.onMousemove(function(b){a.onMousemove&&a.onMousemove(b)});this.options.canvas||b.getContainer().appendChild(this.canvas)}},{key:"setOptions",value:function(a){this.options=a}},{key:"onInitialize",value:function(a){a&&(this.transferOptions=a.bind(this)(this.gl)||{})}},{key:"bindFramebuffer",value:function(a){var b=this.gl;a?b.bindFramebuffer(b.FRAMEBUFFER,a.framebuffer):b.bindFramebuffer(b.FRAMEBUFFER,null)}},{key:"saveFramebuffer",value:function(){var a=this.gl;this.preFramebuffer=
a.getParameter(a.FRAMEBUFFER_BINDING)}},{key:"restoreFramebuffer",value:function(){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.preFramebuffer)}},{key:"onRender",value:function(a){this.renderArr.push(a)}},{key:"changeSize",value:function(){var a=this.canvas;if(a){var b=a.style,c=this.map.getSize(),e=window.devicePixelRatio;a.width=c.width*e;a.height=c.height*e;b.cssText="position: absolute;left:0;top:0;width:"+c.width+"px;height:"+c.height+"px;z-index:2;";c=this.options;"cesium"!==c.mapType||
c.canvas||(b.pointerEvents="none");this.gl.viewport(0,0,a.width,a.height)}}},{key:"update",value:function(){!1===this.options.autoUpdate||this.isAnimation||this.render()}},{key:"render",value:function(){if(this.map){var a=this.options,b=this.projectionMatrix,c=this.viewMatrix;if("three"===a.mapType)c=this.map.map.camera,b=c.projectionMatrix.elements,c=c.matrixWorldInverse.elements;else if("cesium"===a.mapType){c=this.map.map;var e=c.camera.frustum.projectionMatrix;b=new Float32Array([e[0],e[1],e[2],
e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]);e=c.camera.viewMatrix;c=new Float32Array([e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]])}else"B_EARTH_MAP"===this.map.map.mapType?(b=this.map.map.getEarth().scene._camera.getProjectionMatrix(),c=this.map.map.getEarth().scene._camera.getModelViewMatrix()):(this.updateProjectionMatrix(),this.updateModelViewMatrix());e=R.multiply(this.matrix,b,c);W(this.transferOptions,{gl:this.gl,matrix:e,
pointToPixelMatrix:this.pointToPixelMatrix,pixelToViewMatrix:this.pixelToViewMatrix,projectionMatrix:b,orthoMatrix:this.orthoMatrix,viewMatrix:c,stateManager:this.stateManager});"three"!==a.mapType&&"cesium"!==a.mapType&&!1!==a.autoUpdate&&this.clear();for(a=0;a<this.renderArr.length;a++)this.renderArr[a]&&this.renderArr[a].bind(this)(this.transferOptions)}}},{key:"clear",value:function(a){var b=this.gl,c=this.options.clearColor||[0,0,0,0];b.clearColor(c[0],c[1],c[2],c[3]);a&&(a instanceof Array||
(a=da(a).unitArray()),b.clearColor(a[0],a[1],a[2],a[3]));b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT)}},{key:"updateProjectionMatrix",value:function(){var a=this.gl.canvas.width/this.gl.canvas.height,b=this.options.cameraNear||1,c=this.options.cameraFar||4E3;R.perspective(this.projectionMatrix,ja(this.fovy),a,b,c);a=this.map.getSize();R.ortho(this.orthoMatrix,-a.width/2,a.width/2,-a.height/2,a.height/2,b,c)}},{key:"updateModelViewMatrix",value:function(){var a=this.map,b=this.viewMatrix,c=this.pointToPixelMatrix,
e=this.pixelToViewMatrix;R.identity(b);R.identity(c);R.identity(e);var g=a.getSize();g=Math.round(-g.height/(2*Math.tan(ja(this.fovy)/2)));R.translate(e,e,[0,0,g]);R.rotate(e,e,ja(a.getTilt()),[-1,0,0]);R.rotate(e,e,ja(a.getHeading()),[0,0,-1]);g=a.getCenter();var k=this.options.pointOffset||[0,0];a=a.getZoomUnits();R.translate(c,c,[(k[0]-g.lng)/a,(k[1]-g.lat)/a,0]);a=1/a;R.scale(c,c,[a,a,a]);R.multiply(b,e,c)}},{key:"destroy",value:function(){this.stopAnimation();this.map.getContainer().removeChild(this.canvas);
this.canvas=null}},{key:"animation",value:function(){this.isAnimation&&(this.render(),window.requestAnimationFrame(this._animation))}},{key:"startAnimation",value:function(){this.isAnimation||(this.isAnimation=!0,window.requestAnimationFrame(this._animation))}},{key:"stopAnimation",value:function(){this.isAnimation=!1}}]);return c}(),tf={circle:1,square:2},zd=function(c){function a(b){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b));b.bufferData=[];return b}P(a,c);J(a,[{key:"getDefaultOptions",
value:function(){return{color:[.1,.1,.9,1],blend:"normal",shape:"circle",size:5}}},{key:"initialize",value:function(a){this.gl=a;var b=this.getOptions();this.program=new S(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 uMatrix;varying vec4 vColor;uniform vec4 uSelectedColor;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=uMatrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}",
fragmentShader:"varying vec4 vColor;uniform int uShape;void main(void){vec4 color=vColor;if(uShape==1){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}float blur=1.0;blur=1.0-smoothstep(0.49,0.5,d);color.a*=blur;gl_FragColor=color;}else{gl_FragColor=color;}}",defines:b.enablePicked?["PICK"]:[]},this);this.buffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});b=[{stride:32,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:32,name:"aColor",buffer:this.buffer,
size:4,type:"FLOAT",offset:12},{stride:32,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:28}];b=b.concat(this.getCommonAttributes());this.vertexArray=new wa({gl:a,program:this.program,attributes:b})}},{key:"onChanged",value:function(a,c){if(this.gl){for(var b=[],d=a.color,k=a.size,h=0;h<c.length;h++){var m=this.normizedPoint(c[h].geometry.coordinates),n=c[h].color||d;"properties"in c[h]&&"color"in c[h].properties&&(n=c[h].properties.color);"[object Function]"===Object.prototype.toString.call(n)&&
(n=n(c[h]));n=this.normizedColor(n);var p=c[h].size||k;"properties"in c[h]&&"size"in c[h].properties&&(p=c[h].properties.size);p="[object Function]"===Object.prototype.toString.call(p)?p(c[h]):Number(p);m=this.addMultipleCoords(m);for(var l=0;l<m.length;l++){var q=m[l];b.push(q[0],q[1],Number(q[2]||0));b.push(n[0],n[1],n[2],n[3]);b.push(p*window.devicePixelRatio)}}this.bufferData=b;this.buffer.updateData(new Float32Array(b));a.enablePicked&&this.parsePickData(c)}}},{key:"parsePickData",value:function(a){var b=
this.getOptions(),c=[];if(b.enablePicked)for(var g=0;g<a.length;g++){var k=this.indexToRgb(g);c.push(k[0]/255,k[1]/255,k[2]/255);b.repeat&&(c.push(k[0]/255,k[1]/255,k[2]/255),c.push(k[0]/255,k[1]/255,k[2]/255))}b.enablePicked&&this.pickBuffer.updateData(new Float32Array(c))}},{key:"destroy",value:function(){this.buffer=this.program=this.bufferData=null}},{key:"render",value:function(a){var b=a.gl,c=a.matrix,g=a.isPickRender;if(!(0>=this.bufferData.length)){this.getOptions();var k=this.program;k.use(b);
this.vertexArray.bind();var h=1;this.options.shape&&tf[this.options.shape]&&(h=tf[this.options.shape]);a=this.getCommonUniforms(a);a=W(a,{uShape:h,uMatrix:c});k.setUniforms(a);c=this.options.blend;g?b.disable(b.BLEND):(b.enable(b.BLEND),b.blendEquation(b.FUNC_ADD),c&&"lighter"===c?b.blendFunc(b.SRC_ALPHA,b.ONE):b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA));b.drawArrays(b.POINTS,0,this.bufferData.length/8)}}}]);return a}(ca),ai=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,
b,c));b.bufferDataArr=[];b.indexDataArr=[];b.vertexBuffer=[];b.indexBuffer=[];b.position=[];b.opacity=1;b.currentScale=1;b.autoUpdate=!0;return b}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],size:5,segs:32,scale:2,unit:"m",step:.1}}},{key:"initialize",value:function(a){this.gl=a;this.program=new S(this.gl,{vertexShader:"uniform mat4 u_projectionMatrix;uniform mat4 u_modelViewMatrix;uniform mat4 u_modelMatrix;uniform float u_opacity;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;void main(){vColor=aColor;vColor.a=u_opacity;gl_Position=u_projectionMatrix*u_modelViewMatrix*u_modelMatrix*vec4(aPos.xyz,1.0);}",
fragmentShader:"precision highp float;varying vec4 vColor;void main(){if(vColor.a==0.0){discard;}gl_FragColor=vColor;}"})}},{key:"onChanged",value:function(a,c){var b=this.gl;if(b&&(this.currentScale=this.opacity=1,(this.data=c)&&c.length)){var d=a.color,k=a.segs;a=a.size;for(var h=360/k,m=0;m<c.length;m++){var n=[],p=[],l=this.normizedPoint(c[m].geometry.coordinates),q=c[m].color||d;"properties"in c[m]&&"color"in c[m].properties&&(q=c[m].properties.color);q=this.normizedColor(q);var r="[object Function]"===
Object.prototype.toString.call(a)?a(c[m]):Number(a);var t=l[0],u=l[1];n.push(0,0,-.5);n.push(q[0],q[1],q[2],0);for(var w=1,x=0;w<=k;w++,x+=h)n.push(l[0]-t+Math.cos(Math.PI/180*x)*r,l[1]-u+Math.sin(Math.PI/180*x)*r,-.5),n.push(q[0],q[1],q[2],this.opacity),w===k?p.push(0,0+w,1):p.push(0,0+w,0+w+1);q=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,q);b.bufferData(b.ARRAY_BUFFER,new Float32Array(n),b.STATIC_DRAW);this.vertexBuffer[m]=q;this.bufferDataArr[m]=n;b.bindBuffer(b.ARRAY_BUFFER,null);n=b.createBuffer();
b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,n);b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(p),b.STATIC_DRAW);this.indexBuffer[m]=n;this.indexDataArr[m]=p;b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null);this.position[m]=[l[0],l[1]]}this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(a){var b=a.gl,c=a.projectionMatrix,g=a.viewMatrix;a=this.program;b.useProgram(a.program);b.uniformMatrix4fv(a.uniforms.u_projectionMatrix,!1,c);b.uniformMatrix4fv(a.uniforms.u_modelViewMatrix,!1,g);c=this.opacity;
void 0!==this.options.opacity&&(c=this.options.opacity);b.uniform1f(a.uniforms.u_opacity,c);b.enable(b.BLEND);b.blendFunc(b.SRC_ALPHA,b.DST_ALPHA);b.blendEquation(b.FUNC_ADD);b.enableVertexAttribArray(a.attributes.aPos);b.enableVertexAttribArray(a.attributes.aColor);for(c=0;c<this.bufferDataArr.length;c++)if(!(0>=this.bufferDataArr[c].length)){g=(new Float32Array(this.bufferDataArr[c])).BYTES_PER_ELEMENT;b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer[c]);b.vertexAttribPointer(a.attributes.aColor,4,
b.FLOAT,!1,7*g,3*g);b.vertexAttribPointer(a.attributes.aPos,3,b.FLOAT,!1,7*g,0);g=this.position[c];var k=R.create(),h=[this.currentScale,this.currentScale,this.currentScale];"px"===this.options.unit&&this.map&&(h=this.map.getZoomUnits(),h=[this.currentScale*h,this.currentScale*h,this.currentScale]);R.identity(k);R.translate(k,k,[g[0],g[1],0]);R.scale(k,k,h);b.uniformMatrix4fv(a.uniforms.u_modelMatrix,!1,k);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer[c]);b.drawElements(b.TRIANGLES,this.indexDataArr[c].length,
b.UNSIGNED_SHORT,0);b.bindBuffer(b.ARRAY_BUFFER,null);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null)}b.disable(b.BLEND);c=this.getOptions();a=c.scale;c=c.step;this.opacity-=c/10;this.currentScale+=a*c;0>this.opacity&&(this.currentScale=this.opacity=1);b.useProgram(null)}}]);return a}(ca),bi=function(c){function a(b){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b));b.bufferData=[];b.date=new Date;b.autoUpdate=!0;return b}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],
blend:"normal",size:20,unit:"px",duration:2}}},{key:"initialize",value:function(a){this.gl=a;var b=this.getOptions();this.program=new S(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 uMatrix;uniform vec4 uSelectedColor;uniform float uTime;uniform float duration;uniform float zoomUnits;varying vec4 vColor;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}float percent=mod(uTime,duration)/duration;vColor.a=1.-percent;gl_Position=uMatrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize/zoomUnits*percent;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}",
fragmentShader:"varying vec4 vColor;void main(void){vec4 color=vColor;float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}float blur=1.0;blur=1.0-smoothstep(0.49,0.5,d);color.a*=blur;gl_FragColor=color;}",defines:b.enablePicked?["PICK"]:[]},this);this.buffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});b=[{stride:32,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:32,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12},{stride:32,name:"aSize",
buffer:this.buffer,size:1,type:"FLOAT",offset:28}];b=b.concat(this.getCommonAttributes());this.vertexArray=new wa({gl:a,program:this.program,attributes:b})}},{key:"onChanged",value:function(a,c){if(this.gl){for(var b=[],d=a.color,k=a.size,h=0;h<c.length;h++){var m=c[h].geometry.coordinates,n=c[h].color||d;"properties"in c[h]&&"color"in c[h].properties&&(n=c[h].properties.color);"[object Function]"===Object.prototype.toString.call(n)&&(n=n(c[h]));n=this.normizedColor(n);m=this.normizedPoint(m);var p=
c[h].size||k;"properties"in c[h]&&"size"in c[h].properties&&(p=c[h].properties.size);p="[object Function]"===Object.prototype.toString.call(p)?p(c[h]):Number(p);b.push(m[0],m[1],Number(m[2]||0));b.push(n[0],n[1],n[2],n[3]);b.push(p*window.devicePixelRatio)}this.bufferData=b;this.buffer.updateData(new Float32Array(b));a.enablePicked&&this.parsePickData(c)}}},{key:"parsePickData",value:function(a){var b=this.getOptions(),c=[];if(b.enablePicked)for(var g=0;g<a.length;g++){var k=this.indexToRgb(g);c.push(k[0]/
255,k[1]/255,k[2]/255)}b.enablePicked&&this.pickBuffer.updateData(new Float32Array(c))}},{key:"destroy",value:function(){this.buffer=this.program=this.bufferData=null}},{key:"render",value:function(a){var b=a.gl,c=a.matrix,g=a.isPickRender;if(!(0>=this.bufferData.length)){var k=this.getOptions(),h=this.program;h.use(b);this.vertexArray.bind();a=this.getCommonUniforms(a);var m=1;"m"===k.unit&&this.map&&(m=this.map.getZoomUnits());a=W(a,{zoomUnits:m,uTime:(new Date-this.date)/1E3,duration:k.duration,
uMatrix:c});h.setUniforms(a);c=this.options.blend;g?b.disable(b.BLEND):(b.enable(b.BLEND),b.blendEquation(b.FUNC_ADD),c&&"lighter"===c?b.blendFunc(b.SRC_ALPHA,b.ONE):b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA));b.drawArrays(b.POINTS,0,this.bufferData.length/8)}}}]);return a}(ca),ci=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b,c));b.bufferData=[];b.startTime=b.options.startTime||0;b.endTime=b.options.endTime;b.time=b.startTime;b.segs=b.options.segs||10;b.autoUpdate=
!0;return b}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{color:[.9,.1,.1,1],trailLength:3,height:100,step:.1,segs:10}}},{key:"setTime",value:function(a){this.time=a}},{key:"initialize",value:function(a){this.gl=a;this.program=new S(this.gl,{vertexShader:"precision mediump float;attribute vec4 aPos;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vTime=1.0-((currentTime-aPos.w)/trailLength);}",
fragmentShader:"precision mediump float;uniform vec3 uFragColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(uFragColor,1.0*vTime);}"});this.buffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(a,c){var b=this.gl;if(b){this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer);for(var d=[],k=a.height,h=0;h<c.length;h++){var m=c[h].geometry.coordinates;var n="[object Function]"===Object.prototype.toString.call(k)?
k(c[h]):Number(k);for(var p=0,l=0;l<this.segs;l++){var q=this.normizedPoint(m);d.push(q[0],q[1],p);void 0===m[2]?d.push(l):d.push(Number(m[2]));p+=n/this.segs;d.push(q[0],q[1],p);void 0===m[2]?d.push(l+1):d.push(Number(m[2]))}}void 0===a.endTime&&(this.endTime=this.segs);this.bufferData=d;b.bufferData(b.ARRAY_BUFFER,new Float32Array(d),b.STATIC_DRAW);this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(a){var b=a.gl,c=a.matrix;a=this.program;b.useProgram(a.program);b.uniformMatrix4fv(a.uniforms.u_matrix,
!1,c);b.bindBuffer(b.ARRAY_BUFFER,this.buffer);b.enableVertexAttribArray(a.attributes.aPos);b.vertexAttribPointer(a.attributes.aPos,4,b.FLOAT,!1,0,0);c=this.normizedColor(this.options.color);b.uniform3f(a.uniforms.uFragColor,c[0],c[1],c[2]);b.uniform1f(a.uniforms.currentTime,this.time);b.uniform1f(a.uniforms.trailLength,this.options.trailLength);b.enable(b.BLEND);b.polygonOffset(2,1);b.blendFunc(b.SRC_ALPHA,b.ONE);b.blendEquation(b.FUNC_ADD);b.drawArrays(b.LINES,0,this.bufferData.length/4);b.bindBuffer(b.ARRAY_BUFFER,
null);b.disable(b.BLEND);this.time+=this.options.step;this.time>1.5*this.endTime&&(this.time=this.startTime);b.useProgram(null)}}]);return a}(ca),di=function(c){function a(b){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b));b.pointLayer=new zd(b.options);b.textLayer=new yd(b.options.textOptions);b.children=[b.pointLayer,b.textLayer];return b}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{minSize:25,maxSize:40,clusterRadius:200,showText:!0,maxZoom:19,minZoom:4,gradient:{0:"rgb(50, 50, 256)",
"0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"},textOptions:{fontSize:12,color:"white"}}}},{key:"onOptionsChanged",value:function(a){this.textLayer.setOptions(a.textOptions)}},{key:"setOptions",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=this.options.textOptions;a.textOptions&&W(c,a.textOptions);var e=a.minZoom,g=a.maxZoom,k=a.clusterRadius;e=g&&g!==this.options.maxZoom||e&&e!==this.options.minZoom||k&&k!==this.options.clusterRadius;
W(this.options,a,{textOptions:c});if(e)this.onChanged(this.options,this.data);else this.refreshCluster();this.onOptionsChanged(this.getOptions())}},{key:"onChanged",value:function(a,c){c&&c.length&&(this.supercluster=new rf({maxZoom:a.maxZoom,minZoom:a.minZoom,radius:a.clusterRadius,extent:256}),this.supercluster.load(c),this.supercluster.trees.forEach(function(a){var b=0,c=Infinity;a.points.forEach(function(a){b=Math.max(a.numPoints||0,b);c=Math.min(a.numPoints||Infinity,c)});a.max=b;a.min=c}),this.refreshCluster())}},
{key:"refreshCluster",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options,c=this.getClusterData(a);c&&c.length&&(this.pointLayer.setData(c),this.textLayer.setData(a.showText?c:[]),a.enablePicked&&a.autoSelect&&this.pick(-1,-1))}},{key:"getClusterData",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options,c=this.map.map,e=c.getBounds(),g=e.ne;e=e.sw;this.ne=g;this.sw=e;var k=g,h=k.lng;k=k.lat;-180<=h&&180>=h&&-90<=k&&90>=k?
g=[e.lng,e.lat,g.lng,g.lat]:(g=c.mercatorToLnglat(this.ne.lng,this.ne.lat),e=c.mercatorToLnglat(this.sw.lng,this.sw.lat),g=e.concat(g));c=Math.floor(c.getZoom());g=this.supercluster.getClusters(g,c);this.zoom!==c&&0<g.length&&(this.zoom=c,h=this.supercluster.trees,e=h[c]&&h[c].max||this.max,c=h[c]&&h[c].min||this.min,e!==c&&(this.max=e,this.min=c));return this.processData(g,a)}},{key:"processData",value:function(a,c){var b=c.defaultColor,d=c.defaultSize,k=c.gradient,h=c.minSize,m=c.textOptions,n=
new la({max:this.max,min:~~this.min||1,minSize:h||8,maxSize:c.maxSize||30,gradient:k});b=b||k[0]||"black";d=d||.5*h||5;var p=m&&m.format;p="function"===typeof p?p:null;return a.map(function(a){var c=d,e=b,g=0;a.properties&&a.properties.point_count&&(g=a.properties.point_count,c=n.getSize(g)||c,e=n.getColor(g),g=p?p(g):g);return{geometry:a.geometry,properties:{text:g,size:c,color:e}}})}},{key:"pick",value:function(a,c){return this.pointLayer.pick(a,c)}},{key:"shouldUpdate",value:function(){if(!this.data||
!this.supercluster)return!1;var a=this.map.map;if(this.zoom!==Math.floor(a.getZoom()))return!0;var c=a.getBounds();a=c.ne;c=c.sw;if(this.ne.lng!==a.lng||this.ne.lat!==a.lat||this.sw.lng!==c.lng||this.sw.lat!==c.lat)return!0}},{key:"render",value:function(b){this.shouldUpdate()?this.refreshCluster():Ya(a.prototype.__proto__||L(a.prototype),"render",this).call(this,b)}}]);return a}(sb),ei=function(c){function a(b,c){F(this,a);return O(this,(a.__proto__||L(a)).call(this,b,c))}P(a,c);J(a,[{key:"getDefaultOptions",
value:function(){return W(Ya(a.prototype.__proto__||L(a.prototype),"getDefaultOptions",this).call(this),{style:"grid",gridSize:500,gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}})}},{key:"onChanged",value:function(b,c){this.gl&&(c=this.processData(c,b),Ya(a.prototype.__proto__||L(a.prototype),"onChanged",this).call(this,b,c))}},{key:"generateGrid",value:function(a,c){var b=c.gridSize,d=[],k={};c=a.length;for(var h=this.getPointOffset(),m=0;m<
c;m++){var n=this.normizedPoint(a[m].geometry.coordinates);n=~~((n[0]+h[0])/b)+"_"+~~((n[1]+h[1])/b);void 0===k[n]&&(k[n]=0);var p=~~a[m].count||1;"properties"in a[m]&&"count"in a[m].properties&&(p=~~a[m].properties.count);k[n]+=p}Ba(k).forEach(function(a){var c=a.split("_");d.push([c[0]*b+b/2,c[1]*b+b/2,k[a]])});return d}},{key:"processData",value:function(a,c){var b=[];if("normal"===c.style)for(var d=this.getPointOffset(),k=0;k<a.length;k++){var h=this.normizedPoint(a[k].geometry.coordinates),m=
h[0]+d[0];h=h[1]+d[1];var n=~~a[k].count||1;"properties"in a[k]&&"count"in a[k].properties&&(n=~~a[k].properties.count);b.push([m,h,n])}else b=this.generateGrid(a,c);d=a=0;if(void 0!==c.max&&void 0!==c.min)a=c.max,d=c.min;else{b[0]&&(a=b[0][2],d=b[0][2]);k=b.length;for(m=0;m<k;m++)h=b[m],a=Math.max(h[2],a),d=Math.min(h[2],d);a/=2}c=new la({max:~~a,min:d,gradient:c.gradient});a=[];for(d=0;d<b.length;d++)k=b[d],k[0]=k[0],k[1]=k[1],m=c.getImageData(k[2]),a.push({geometry:{type:"Point",coordinates:[k[0],
k[1]]},color:[m[0]/255,m[1]/255,m[2]/255,m[3]/255]});return a}}]);return a}(zd),fi=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b,c));b.bufferData=[];return b}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1]}}},{key:"onChanged",value:function(a,c){if(a=this.gl){this.buffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.buffer);for(var b=[],d=0;20>d;d++)for(var k=5*d,h=0;h<c.length;h++)for(var m=c[h].geometry.coordinates,n=0;n<m.length-
1;n++){var p=this.normizedPoint(m[n]);b.push(p[0]);b.push(p[1]);b.push(Number(k));p=this.normizedPoint(m[n+1]);b.push(p[0]);b.push(p[1]);b.push(Number(k))}a.bufferData(a.ARRAY_BUFFER,new Float32Array(b),a.STATIC_DRAW);this.bufferData=b;a.bindBuffer(a.ARRAY_BUFFER,null)}}},{key:"initialize",value:function(a){this.gl=a;this.program=new S(a,{vertexShader:"uniform mat4 uMatrix;attribute vec3 aPos;void main(){gl_PointSize=10.0;gl_Position=uMatrix*vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform vec4 uFragColor;void main(){gl_FragColor=uFragColor;}"});
this.buffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.buffer)}},{key:"render",value:function(a){var b=a.gl;a=a.matrix;var c=this.program;b.useProgram(c.program);var g=this.normizedColor(this.options.color);b.uniform4f(c.uniforms.uFragColor,g[0],g[1],g[2],g[3]);b.uniformMatrix4fv(c.uniforms.uMatrix,!1,a);b.bindBuffer(b.ARRAY_BUFFER,this.buffer);b.enableVertexAttribArray(c.attributes.aPos);b.vertexAttribPointer(c.attributes.aPos,3,b.FLOAT,!1,0,0);b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);
b.blendFunc(b.ONE,b.ONE);b.drawArrays(b.LINES,0,this.bufferData.length/3);b.bindBuffer(b.ARRAY_BUFFER,null)}}]);return a}(ca),uf={circle:1,square:2},gi=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b,c));b.bufferData=[];b.startTime=b.options.startTime||0;b.endTime=b.options.endTime;b.time=b.startTime;b.autoUpdate=!0;return b}P(a,c);J(a,[{key:"initialize",value:function(a){this.gl=a;this.program=new S(this.gl,{vertexShader:"attribute vec4 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 u_matrix;varying vec4 vColor;uniform float currentTime;uniform float trailLength;varying float vTime;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize;vTime=1.0-((currentTime-aPos.w)/trailLength);}",
fragmentShader:"precision highp float;varying vec4 vColor;uniform int uShape;varying float vTime;void main(void){if(vTime>1.0||vTime<0.0){discard;}if(uShape==1){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d<0.5){gl_FragColor=vColor;}else{discard;}}else{gl_FragColor=vec4(vColor.rgb,vColor.a*vTime);}}"});this.f32BufferData=new Float32Array;this.buffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(a,c){var b=this.gl;if(b){this.buffer=b.createBuffer();
b.bindBuffer(b.ARRAY_BUFFER,this.buffer);for(var d=[],k=a.color||[.1,.1,.9,1],h=a.size||5,m=0;m<c.length;m++){var n=c[m].geometry.coordinates,p=c[m].color||k;"[object Function]"===Object.prototype.toString.call(p)&&(p=p(c[m]));"properties"in c[m]&&"color"in c[m].properties&&(p=c[m].properties.color);p=this.normizedColor(p);var l=this.normizedPoint(n),q=h;q="[object Function]"===Object.prototype.toString.call(q)?q(c[m]):Number(q);var r=c[m].time||m;"properties"in c[m]&&"time"in c[m].properties&&(r=
c[m].properties.time);d.push(l[0],l[1],Number(n[2]||0),r);d.push(p[0],p[1],p[2],p[3]);d.push(q*window.devicePixelRatio)}void 0===a.endTime&&(this.endTime=c.length);this.bufferData=d;this.f32BufferData=new Float32Array(d);b.bufferData(b.ARRAY_BUFFER,this.f32BufferData,b.STATIC_DRAW)}}},{key:"render",value:function(a){var b=a.gl,c=a.matrix;0>=this.bufferData.length||(a=this.program,b.useProgram(a.program),b.uniformMatrix4fv(a.uniforms.u_matrix,!1,c),b.bindBuffer(b.ARRAY_BUFFER,this.buffer),c=this.f32BufferData.BYTES_PER_ELEMENT,
b.enableVertexAttribArray(a.attributes.aPos),b.vertexAttribPointer(a.attributes.aPos,4,b.FLOAT,!1,9*c,0),b.enableVertexAttribArray(a.attributes.aColor),b.vertexAttribPointer(a.attributes.aColor,4,b.FLOAT,!1,9*c,4*c),b.enableVertexAttribArray(a.attributes.aSize),b.vertexAttribPointer(a.attributes.aSize,1,b.FLOAT,!1,9*c,8*c),b.uniform1f(a.uniforms.currentTime,this.time),b.uniform1f(a.uniforms.trailLength,this.options.trailLength||3),c=1,this.options.shape&&uf[this.options.shape]&&(c=uf[this.options.shape]),
b.uniform1i(a.uniforms.uShape,c),a=this.options.blend,b.enable(b.BLEND),b.blendEquation(b.FUNC_ADD),a&&"lighter"===a?b.blendFunc(b.SRC_ALPHA,b.ONE):b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA),b.drawArrays(b.POINTS,0,this.bufferData.length/9),b.bindBuffer(b.ARRAY_BUFFER,null),b.disable(b.BLEND),b.useProgram(null),this.time+=this.options.step||.1,this.time>this.endTime&&(this.time=this.startTime))}}]);return a}(ca),hi=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b,
c));b.bufferData=[];b.startTime=b.options.startTime||0;b.endTime=b.options.endTime;b.time=b.startTime;b.autoUpdate=!0;return b}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1],trailLength:3,step:.1}}},{key:"initialize",value:function(a){this.gl=a;this.program=new S(this.gl,{vertexShader:"precision highp float;attribute vec4 aPos;attribute vec4 aColor;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;varying vec4 vColor;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vColor=aColor;vTime=1.0-((currentTime-aPos.w)/trailLength);}",
fragmentShader:"precision highp float;uniform vec3 uFragColor;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"},this);this.buffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.buffer)}},{key:"setTime",value:function(a){this.time=a}},{key:"onChanged",value:function(a,c){var b=this.gl;if(b){this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer);for(var d=[],k=0,h=this.options.color,m=0;m<c.length;m++){var n=
c[m].geometry.coordinates;c[m].color&&(h=c[m].color);"properties"in c[m]&&"color"in c[m].properties&&(h=c[m].properties.color);"[object Function]"===Object.prototype.toString.call(h)&&(h=h(c[m]));h=this.normizedColor(h);n.length>k&&(k=n.length);for(var p=0;p<n.length-1;p++){var l=this.normizedPoint(n[p]);d.push(l[0]);d.push(l[1]);d.push(l[2]);void 0===n[p][3]?d.push(p):d.push(Number(n[p][3]));d.push(h[0]);d.push(h[1]);d.push(h[2]);d.push(h[3]);l=this.normizedPoint(n[p+1]);d.push(l[0]);d.push(l[1]);
d.push(l[2]);void 0===n[p+1][3]?d.push(p+1):d.push(Number(n[p+1][3]));d.push(h[0]);d.push(h[1]);d.push(h[2]);d.push(h[3])}}void 0===a.endTime&&(this.endTime=k);this.bufferData=d;this.f32BufferData=new Float32Array(d);b.bufferData(b.ARRAY_BUFFER,this.f32BufferData,b.STATIC_DRAW)}}},{key:"render",value:function(a){var b=a.gl,c=a.matrix;a=this.program;a.use(b);b.uniformMatrix4fv(a.uniforms.u_matrix,!1,c);b.bindBuffer(b.ARRAY_BUFFER,this.buffer);c=this.f32BufferData.BYTES_PER_ELEMENT;b.enableVertexAttribArray(a.attributes.aPos);
b.vertexAttribPointer(a.attributes.aPos,4,b.FLOAT,!1,8*c,0);b.enableVertexAttribArray(a.attributes.aColor);b.vertexAttribPointer(a.attributes.aColor,4,b.FLOAT,!1,8*c,4*c);c=this.normizedColor(this.options.color);b.uniform3f(a.uniforms.uFragColor,c[0],c[1],c[2]);b.uniform1f(a.uniforms.currentTime,this.time);b.uniform1f(a.uniforms.trailLength,this.options.trailLength);b.enable(b.BLEND);b.polygonOffset(2,1);"lighter"===this.options.blend?b.blendFunc(b.ONE,b.ONE):b.blendFunc(b.SRC_ALPHA,b.ONE);b.blendEquation(b.FUNC_ADD);
b.drawArrays(b.LINES,0,this.bufferData.length/8);b.bindBuffer(b.ARRAY_BUFFER,null);this.time+=this.options.step;this.time>this.endTime&&(this.time=this.startTime);b.useProgram(null)}}]);return a}(ca),vf=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b,c));b.initData();b.date=new Date;b.autoUpdate=!0;return b}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{color:"rgba(25, 25, 250, 1)",blend:"normal",width:2,isFlat:!0,antialias:!1,lineJoin:"miter",lineCap:"butt",
interval:.1,duration:2,trailLength:.5,zoom:4}}},{key:"initData",value:function(){this.dataMgr={position:[],prev:[],next:[],direction:[],color:[],index:[],counter:[]}}},{key:"initialize",value:function(a){this.gl=a;var b=this.getOptions();this.program=new S(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float thickness;uniform int miter;uniform vec4 uSelectedColor;attribute vec3 position;attribute vec3 next;attribute vec3 previous;attribute float direction;attribute vec4 aColor;attribute float aCounter;attribute vec2 uv;varying vec4 vColor;varying vec2 vNormal;varying float vCounter;vec2 project(vec4 coord){vec3 screen=coord.xyz/coord.w;vec2 clip=(screen.xy+1.0)/2.0;return clip*MAPV_resolution;}vec4 unproject(vec2 projected,float z,float w){vec2 clip=projected/MAPV_resolution;vec2 screen=clip*2.0-1.0;return vec4(screen*w,z,w);}void main(){vColor=aColor;vCounter=aCounter;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\nvec4 previousProjected=u_matrix*vec4(previous,1.0);vec4 currentProjected=u_matrix*vec4(position,1.0);vec4 nextProjected=u_matrix*vec4(next,1.0);vec2 currentScreen=project(currentProjected);vec2 previousScreen=project(previousProjected);vec2 nextScreen=project(nextProjected);float len=thickness;float orientation=direction;vec2 dir=vec2(0.0);if(currentScreen==previousScreen){dir=normalize(nextScreen-currentScreen);}else if(currentScreen==nextScreen){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));if(miter==1){vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;}else{dir=dirA;}}vec2 normal=vec2(-dir.y,dir.x);vNormal=normal*orientation;normal*=len/2.0;vec2 pos=currentScreen+normal*orientation;vec4 finalPos=unproject(pos,currentProjected.z,currentProjected.w);gl_Position=finalPos;}",
fragmentShader:"precision highp float;uniform bool uAntialias;uniform bool uAnimate;uniform float uTime;uniform float duration;uniform float interval;uniform float trailLength;varying vec4 vColor;varying vec2 vNormal;varying float vCounter;void main(){vec4 color=vColor;if(uAntialias){float blur=1.0;blur=1.0-smoothstep(0.98,1.0,length(vNormal));color.a*=blur;}if(uAnimate){float alpha=1.0-fract(mod(1.0-vCounter,interval)*(1.0/interval)+uTime/duration);alpha=(alpha+trailLength-1.0)/trailLength;color.a*=alpha;}gl_FragColor=color;}",
defines:b.enablePicked?["PICK"]:[]},this);this.prevBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.currentBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.nextBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.directionBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.colorBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.counterBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.indexBuffer=
new H({gl:a,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});b=[{stride:12,name:"previous",buffer:this.prevBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"position",buffer:this.currentBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"next",buffer:this.nextBuffer,size:3,type:"FLOAT",offset:0},{stride:4,name:"direction",buffer:this.directionBuffer,size:1,type:"FLOAT",offset:0},{stride:16,name:"aColor",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0},{stride:4,name:"aCounter",buffer:this.counterBuffer,
size:1,type:"FLOAT",offset:0}];b=b.concat(this.getCommonAttributes());this.vertexArray=new wa({gl:a,program:this.program,attributes:b})}},{key:"onChanged",value:function(a,c){var b=this;if(this.gl){this.initData();for(var d=1,k=[],h=0;h<c.length;h++){var m=[],n=c[h].geometry.coordinates;n&&0<n.length&&(m="Polygon"===c[h].geometry.type?n[0].map(function(a){return b.normizedPoint(a)}):n.map(function(a){return b.normizedPoint(a)}));m=oe(m);n=m.total;k[h]=m.arr;d=Math.max(n,d)}h=[];m=a.color;for(n=0;n<
c.length;n++){var p=[],l=c[n].geometry.coordinates;l&&0<l.length&&(p="Polygon"===c[n].geometry.type?l[0].map(function(a){return b.normizedPoint(a)}):l.map(function(a){return b.normizedPoint(a)}));l=c[n].color||m;"properties"in c[n]&&"color"in c[n].properties&&(l=c[n].properties.color);"[object Function]"===Object.prototype.toString.call(l)&&(l=l(c[n]));l=this.normizedColor(l);for(var q=this.addMultipleCoords(p),r=0;r<q.length;r++)this.processData(this.dataMgr,q[r],k[n],d,l);if(a.enablePicked)for(l=
this.indexToRgb(n),q=0;q<p.length;q++)h.push(l[0]/255,l[1]/255,l[2]/255),h.push(l[0]/255,l[1]/255,l[2]/255),a.repeat&&(h.push(l[0]/255,l[1]/255,l[2]/255),h.push(l[0]/255,l[1]/255,l[2]/255),h.push(l[0]/255,l[1]/255,l[2]/255),h.push(l[0]/255,l[1]/255,l[2]/255))}this.counterBuffer.updateData(new Float32Array(this.dataMgr.counter));this.currentBuffer.updateData(new Float32Array(this.dataMgr.position));this.prevBuffer.updateData(new Float32Array(this.dataMgr.prev));this.nextBuffer.updateData(new Float32Array(this.dataMgr.next));
this.directionBuffer.updateData(new Float32Array(this.dataMgr.direction));this.colorBuffer.updateData(new Float32Array(this.dataMgr.color));this.indexBuffer.updateData(new Uint32Array(this.dataMgr.index));a.enablePicked&&this.pickBuffer.updateData(new Float32Array(h))}}},{key:"processData",value:function(a,c,e,g,k){var b,d,n,p,l,q,r,t=c.length,u=a.position.length/6;e=ya(e.map(function(a){return a/g}));var w=ya(c.map(function(a){return 1}),!0),x=ya(c),v=ya(c.map(ic(-1))),z=ya(c.map(ic(1)));c=ya(c.map(function(a){return k}));
t=ne(t,u);(b=a.counter).push.apply(b,aa(e));(d=a.position).push.apply(d,aa(Oa(x)));(n=a.prev).push.apply(n,aa(Oa(v)));(p=a.next).push.apply(p,aa(Oa(z)));(l=a.direction).push.apply(l,aa(w));(q=a.color).push.apply(q,aa(Oa(c)));(r=a.index).push.apply(r,aa(t))}},{key:"render",value:function(a){var b=a.gl,c=a.matrix,g=this.dataMgr;if(g&&!(0>=g.index.length)){var k=this.getOptions(),h=this.program;h.use(b);var m=this.map?this.map.getZoom()>=k.zoom&&this.autoUpdate?!0:!1:!0;h.setUniforms(W(this.getCommonUniforms(a),
{u_matrix:c,miter:1,thickness:k.width,uAntialias:k.antialias,uTime:(new Date-this.date)/1E3,uAnimate:m,duration:k.duration,interval:k.interval,trailLength:k.trailLength}));b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);k.blend&&"lighter"===k.blend?b.blendFunc(b.SRC_ALPHA,b.ONE):b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);this.indexBuffer.bind();this.vertexArray.bind();b.drawElements(b.TRIANGLES,g.index.length,b.UNSIGNED_INT,0);b.bindBuffer(b.ARRAY_BUFFER,null);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,
null);b.disable(b.BLEND)}}}]);return a}(ca),ii=function(c){function a(b,c){F(this,a);return O(this,(a.__proto__||L(a)).call(this,b,c))}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(a){this.gl=a;var b=this.getOptions();this.texture=null;this.program=new S(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute vec2 a_texture_coord;uniform sampler2D uTerrain;uniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;varying vec2 v_texture_coord;void main(){v_texture_coord=a_texture_coord;vec3 pos=a_pos.xyz;\n#if defined(TERRAIN)\nvec4 terrainColor=texture2D(uTerrain,vec2(v_texture_coord.s,v_texture_coord.t));vec3 rgb=terrainColor.rgb*256.0;pos.z=-10000.0+((rgb.r*256.0*256.0+rgb.g*256.0+rgb.b)*0.1);pos.z=pos.z-60.0;\n#endif\nvec4 position=u_proj_matrix*u_mv_matrix*vec4(pos,1.0);gl_Position=position;}",
fragmentShader:"precision highp float;varying vec2 v_texture_coord;uniform sampler2D uTile;uniform bool uUseFilter;uniform vec4 uFilterColor;void main(){vec4 textureColor=texture2D(uTile,vec2(v_texture_coord.s,v_texture_coord.t));if(uUseFilter){textureColor=textureColor*uFilterColor;}gl_FragColor=textureColor;}",defines:b.terrain?["TERRAIN"]:""},this);this.vertexBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.indexBuffer=new H({gl:a,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});
this.vertexArray=new wa({gl:a,program:this.program,attributes:[{name:"a_pos",buffer:this.vertexBuffer,stride:20,size:3,type:"FLOAT",offset:0},{name:"a_texture_coord",buffer:this.vertexBuffer,size:2,stride:20,type:"FLOAT",offset:12}]})}},{key:"onChanged",value:function(a,c){var b=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){b.loadTexture(function(){b.parseData(c);b.dataTime=new Date;b.webglLayer.render()})},0))}},{key:"render",value:function(a){var b=
a.gl,c=a.projectionMatrix;a=a.viewMatrix;var g=this.getOptions(),k=this.program,h=k.uniforms;k.use(b);this.texture&&(b.activeTexture(b.TEXTURE0),b.uniform1i(h.uTile,0),b.bindTexture(b.TEXTURE_2D,this.texture),b.activeTexture(b.TEXTURE1),b.uniform1i(h.uTerrain,1),b.bindTexture(b.TEXTURE_2D,this.terrainSampler),b.disable(b.CULL_FACE),k.setUniforms({u_proj_matrix:c,uUseFilter:!!g.filterColor,uFilterColor:this.normizedColor(g.filterColor||"rgba(0, 0, 100, 1.0)"),u_mv_matrix:a}),0<this.index.length&&(this.indexBuffer.bind(),
this.vertexArray.bind(),b.drawElements(b.TRIANGLES,this.index.length,b.UNSIGNED_INT,0)))}},{key:"loadTexture",value:function(a){var b=this,c=this.getOptions();c.tile?c.terrain?Ma(this.gl,c.terrain,function(d,e){b.terrainSampler=d;Ma(b.gl,c.tile,function(c,d){b.texture=c;a&&a();b.webglLayer.render()})},{TEXTURE_WRAP_S:"MIRRORED_REPEAT",TEXTURE_WRAP_T:"MIRRORED_REPEAT"}):Ma(this.gl,c.tile,function(c,d){b.texture=c;a&&a();b.webglLayer.render()}):(this.texture=null,a&&a())}},{key:"parseData",value:function(a){var b=
this,c=[],g=[];if(a&&a[0]){var k=a[0].geometry.coordinates[0];k=k.map(function(a){return b.normizedPoint(a)});a=k[0][0];var h=k[0][1],m=k[0][2],n=(k[2][0]-a)/16;k=(k[2][1]-h)/16;for(var p=0;16>=p;p++)for(var l=0;16>=l;l++)if(c.push(a+n*l,h+k*p,m),c.push(l/16,p/16),16>l&&16>p){var q=17*p+l,r=17*(p+1)+l;g.push(q,r+1,q+1);g.push(q,r,r+1)}}this.index=g;this.vertexBuffer.updateData(new Float32Array(c));this.indexBuffer.updateData(new Uint32Array(g))}}]);return a}(ca),Bc=function(c,a,b,d){if(!(c instanceof
a)||void 0!==d&&d in c)throw TypeError(b+": incorrect invocation!");return c},jb=K(function(c){var a={},b={};c=c.exports=function(c,e,g,k,h){h=h?function(){return c}:od(c);g=ia(g,k,e?2:1);k=0;var d,n;if("function"!=typeof h)throw TypeError(c+" is not iterable!");if(void 0===h||Ja.Array!==h&&Ye[Xe]!==h)for(k=h.call(c);!(n=k.next()).done;){if(h=We(k,g,n.value,e),h===a||h===b)return h}else for(d=jc(c.length);d>k;k++)if(h=e?g(oa(n=c[k])[0],n[1]):g(c[k]),h===a||h===b)return h};c.BREAK=a;c.RETURN=b}),ji=
fa("species"),wf=function(c,a){c=oa(c).constructor;var b;return void 0===c||void 0==(b=oa(c)[ji])?a:cb(b)},ki=function(c,a,b){var d=void 0===b;switch(a.length){case 0:return d?c():c.call(b);case 1:return d?c(a[0]):c.call(b,a[0]);case 2:return d?c(a[0],a[1]):c.call(b,a[0],a[1]);case 3:return d?c(a[0],a[1],a[2]):c.call(b,a[0],a[1],a[2]);case 4:return d?c(a[0],a[1],a[2],a[3]):c.call(b,a[0],a[1],a[2],a[3])}return c.apply(b,a)},xf=M.process,Ad=M.setImmediate,yf=M.clearImmediate,zf=M.MessageChannel,Bd=
M.Dispatch,Cd=0,Wb={},Xb=function(){var c=+this;if(Wb.hasOwnProperty(c)){var a=Wb[c];delete Wb[c];a()}},Af=function(c){Xb.call(c.data)};if(!Ad||!yf)if(Ad=function(c){for(var a=[],b=1;arguments.length>b;)a.push(arguments[b++]);Wb[++Cd]=function(){ki("function"==typeof c?c:Function(c),a)};Yb(Cd);return Cd},yf=function(c){delete Wb[c]},"process"==db(xf))var Yb=function(c){xf.nextTick(ia(Xb,c,1))};else if(Bd&&Bd.now)Yb=function(c){Bd.now(ia(Xb,c,1))};else if(zf){var Bf=new zf;var Cf=Bf.port2;Bf.port1.onmessage=
Af;Yb=ia(Cf.postMessage,Cf,1)}else M.addEventListener&&"function"==typeof postMessage&&!M.importScripts?(Yb=function(c){M.postMessage(c+"","*")},M.addEventListener("message",Af,!1)):Yb="onreadystatechange"in(mc?nb.createElement("script"):{})?function(c){ad.appendChild(mc?nb.createElement("script"):{}).onreadystatechange=function(){ad.removeChild(this);Xb.call(c)}}:function(c){setTimeout(ia(Xb,c,1),0)};var Dd=Ad,Df=M.MutationObserver||M.WebKitMutationObserver,Ed=M.process,Fd=M.Promise,Ef="process"==
db(Ed),Cc={f:function(c){return new hg(c)}},Dc=function(c){try{return{e:!1,v:c()}}catch(a){return{e:!0,v:a}}},Ff=M.navigator,li=Ff&&Ff.userAgent||"",Gd=function(c,a){oa(c);if(ma(a)&&a.constructor===c)return a;c=Cc.f(c);var b=c.resolve;b(a);return c.promise},Hd=function(c,a,b){for(var d in a)b&&c[d]?c[d]=a[d]:Pa(c,d,a[d]);return c},Gf=fa("species"),Hf=function(c){c="function"==typeof T[c]?T[c]:M[c];za&&c&&!c[Gf]&&va.f(c,Gf,{configurable:!0,get:function(){return this}})},If=function(){var c,a,b=function(){var b;
for(Ef&&(b=Ed.domain)&&b.exit();c;){var e=c.fn;c=c.next;try{e()}catch(n){throw c?d():a=void 0,n;}}a=void 0;b&&b.enter()};if(Ef)var d=function(){Ed.nextTick(b)};else if(!Df||M.navigator&&M.navigator.standalone)if(Fd&&Fd.resolve){var e=Fd.resolve(void 0);d=function(){e.then(b)}}else d=function(){Dd.call(M,b)};else{var g=!0,k=document.createTextNode("");(new Df(b)).observe(k,{characterData:!0});d=function(){k.data=g=!g}}return function(b){b={fn:b,next:void 0};a&&(a.next=b);c||(c=b,d());a=b}}(),Jf=M.TypeError,
wb=M.process,Kf=wb&&wb.versions,mi=Kf&&Kf.v8||"",Ka=M.Promise,Zb="process"==xc(wb),Ec=function(){},Lf,$b=Lf=Cc.f,Fc=!!function(){try{var c=Ka.resolve(1),a=(c.constructor={})[fa("species")]=function(a){a(Ec,Ec)};return(Zb||"function"==typeof PromiseRejectionEvent)&&c.then(Ec)instanceof a&&0!==mi.indexOf("6.6")&&-1===li.indexOf("Chrome/66")}catch(b){}}(),Mf=function(c){var a;return ma(c)&&"function"==typeof(a=c.then)?a:!1},Id=function(c,a){if(!c._n){c._n=!0;var b=c._c;If(function(){for(var d=c._v,e=
1==c._s,g=0;b.length>g;){var k=void 0,h=void 0,m=void 0,n=b[g++],p=e?n.ok:n.fail,l=n.resolve,q=n.reject,r=n.domain;try{p?(e||(2==c._h&&ni(c),c._h=1),!0===p?m=d:(r&&r.enter(),m=p(d),r&&(r.exit(),k=!0)),m===n.promise?q(Jf("Promise-chain cycle")):(h=Mf(m))?h.call(m,l,q):l(m)):q(d)}catch(t){r&&!k&&r.exit(),q(t)}}c._c=[];c._n=!1;a&&!c._h&&oi(c)})}},oi=function(c){Dd.call(M,function(){var a=c._v,b=1!==c._h&&0===(c._a||c._c).length,d,e;if(b){var g=Dc(function(){Zb?wb.emit("unhandledRejection",a,c):(d=M.onunhandledrejection)?
d({promise:c,reason:a}):(e=M.console)&&e.error&&e.error("Unhandled promise rejection",a)});c._h=Zb||1!==c._h&&0===(c._a||c._c).length?2:1}c._a=void 0;if(b&&g.e)throw g.v;})},ni=function(c){Dd.call(M,function(){var a;Zb?wb.emit("rejectionHandled",c):(a=M.onrejectionhandled)&&a({promise:c,reason:c._v})})},xb=function(c){var a=this;a._d||(a._d=!0,a=a._w||a,a._v=c,a._s=2,a._a||(a._a=a._c.slice()),Id(a,!0))},Jd=function(c){var a=this,b;if(!a._d){a._d=!0;a=a._w||a;try{if(a===c)throw Jf("Promise can't be resolved itself");
(b=Mf(c))?If(function(){var d={_w:a,_d:!1};try{b.call(c,ia(Jd,d,1),ia(xb,d,1))}catch(e){xb.call(d,e)}}):(a._v=c,a._s=1,Id(a,!1))}catch(d){xb.call({_w:a,_d:!1},d)}}};if(!Fc){Ka=function(c){Bc(this,Ka,"Promise","_h");cb(c);Kd.call(this);try{c(ia(Jd,this,1),ia(xb,this,1))}catch(a){xb.call(this,a)}};var Kd=function(c){this._c=[];this._a=void 0;this._s=0;this._d=!1;this._v=void 0;this._h=0;this._n=!1};Kd.prototype=Hd(Ka.prototype,{then:function(c,a){var b=$b(wf(this,Ka));b.ok="function"==typeof c?c:!0;
b.fail="function"==typeof a&&a;b.domain=Zb?wb.domain:void 0;this._c.push(b);this._a&&this._a.push(b);this._s&&Id(this,!1);return b.promise},"catch":function(c){return this.then(void 0,c)}});var pi=function(){var c=new Kd;this.promise=c;this.resolve=ia(Jd,c,1);this.reject=ia(xb,c,1)};Cc.f=$b=function(c){return c===Ka||c===Nf?new pi(c):Lf(c)}}C(C.G+C.W+C.F*!Fc,{Promise:Ka});eb(Ka,"Promise");Hf("Promise");var Nf=T.Promise;C(C.S+C.F*!Fc,"Promise",{reject:function(c){var a=$b(this),b=a.reject;b(c);return a.promise}});
C(C.S+1*C.F,"Promise",{resolve:function(c){return Gd(this===Nf?Ka:this,c)}});C(C.S+C.F*!(Fc&&$e(function(c){Ka.all(c)["catch"](Ec)})),"Promise",{all:function(c){var a=this,b=$b(a),d=b.resolve,e=b.reject,g=Dc(function(){var b=[],g=0,m=1;jb(c,!1,function(c){var h=g++,k=!1;b.push(void 0);m++;a.resolve(c).then(function(a){k||(k=!0,b[h]=a,--m||d(b))},e)});--m||d(b)});g.e&&e(g.v);return b.promise},race:function(c){var a=this,b=$b(a),d=b.reject,e=Dc(function(){jb(c,!1,function(c){a.resolve(c).then(b.resolve,
d)})});e.e&&d(e.v);return b.promise}});C(C.P+C.R,"Promise",{"finally":function(c){var a=wf(this,T.Promise||M.Promise),b="function"==typeof c;return this.then(b?function(b){return Gd(a,c()).then(function(){return b})}:c,b?function(b){return Gd(a,c()).then(function(){throw b;})}:c)}});C(C.S,"Promise",{"try":function(c){var a=Cc.f(this);c=Dc(c);(c.e?a.reject:a.resolve)(c.v);return a.promise}});var qi=T.Promise,ri=K(function(c){c.exports={"default":qi,__esModule:!0}}),Of=N(ri),Za=function(c,a){if(!ma(c)||
c._t!==a)throw TypeError("Incompatible receiver, "+a+" required!");return c},si=va.f,Pf=sc.fastKey,ac=za?"_s":"size",Gc=function(c,a){var b=Pf(a);if("F"!==b)return c._i[b];for(c=c._f;c;c=c.n)if(c.k==a)return c},Ld={getConstructor:function(c,a,b,d){var e=c(function(c,k){Bc(c,e,a,"_i");c._t=a;c._i=Wa(null);c._f=void 0;c._l=void 0;c[ac]=0;void 0!=k&&jb(k,b,c[d],c)});Hd(e.prototype,{clear:function(){for(var b=Za(this,a),c=b._i,d=b._f;d;d=d.n)d.r=!0,d.p&&(d.p=d.p.n=void 0),delete c[d.i];b._f=b._l=void 0;
b[ac]=0},"delete":function(b){var c=Za(this,a);if(b=Gc(c,b)){var d=b.n,e=b.p;delete c._i[b.i];b.r=!0;e&&(e.n=d);d&&(d.p=e);c._f==b&&(c._f=d);c._l==b&&(c._l=e);c[ac]--}return!!b},forEach:function(b){Za(this,a);for(var c=ia(b,1<arguments.length?arguments[1]:void 0,3),d;d=d?d.n:this._f;)for(c(d.v,d.k,this);d&&d.r;)d=d.p},has:function(b){return!!Gc(Za(this,a),b)}});za&&si(e.prototype,"size",{get:function(){return Za(this,a)[ac]}});return e},def:function(c,a,b){var d=Gc(c,a),e;d?d.v=b:(c._l=d={i:e=Pf(a,
!0),k:a,v:b,p:a=c._l,n:void 0,r:!1},c._f||(c._f=d),a&&(a.n=d),c[ac]++,"F"!==e&&(c._i[e]=d));return c},getEntry:Gc,setStrong:function(c,a,b){ed(c,a,function(b,c){this._t=Za(b,a);this._k=c;this._l=void 0},function(){for(var a=this._k,b=this._l;b&&b.r;)b=b.p;return this._t&&(this._l=b=b?b.n:this._t._f)?"keys"==a?Xa(0,b.k):"values"==a?Xa(0,b.v):Xa(0,[b.k,b.v]):(this._t=void 0,Xa(1))},b?"entries":"values",!b,!0);Hf(a)}},ti=fa("species"),ui=function(c,a){if(jd(c)){var b=c.constructor;"function"!=typeof b||
b!==Array&&!jd(b.prototype)||(b=void 0);ma(b)&&(b=b[ti],null===b&&(b=void 0))}return new (void 0===b?Array:b)(a)},vi=va.f,wi=function(c,a){var b=1==c,d=2==c,e=3==c,g=4==c,k=6==c,h=5==c||k,m=a||ui;return function(a,p,l){var n=Object(Ta(a)),r=Xc(n);p=ia(p,l,3);l=jc(r.length);var t=0;a=b?m(a,l):d?m(a,0):void 0;for(var u,w;l>t;t++)if(h||t in r)if(u=r[t],w=p(u,t,n),c)if(b)a[t]=w;else if(w)switch(c){case 3:return!0;case 5:return u;case 6:return t;case 2:a.push(u)}else if(g)return!1;return k?-1:e||g?g:a}}(0);
(function(c,a,b,d,e,g){var k=M[c],h=k,m=e?"set":"add",n=h&&h.prototype,p={};za&&"function"==typeof h&&(g||n.forEach&&!Ua(function(){(new h).entries().next()}))?(h=a(function(a,b){Bc(a,h,c,"_c");a._c=new k;void 0!=b&&jb(b,e,a[m],a)}),wi("add clear delete forEach get has set keys values entries toJSON".split(" "),function(a){var b="add"==a||"set"==a;a in n&&(!g||"clear"!=a)&&Pa(h.prototype,a,function(c,d){Bc(this,h,a);if(!b&&g&&!ma(c))return"get"==a?void 0:!1;c=this._c[a](0===c?0:c,d);return b?this:
c})}),g||vi(h.prototype,"size",{get:function(){return this._c.size}})):(h=d.getConstructor(a,c,e,m),Hd(h.prototype,b),sc.NEED=!0);eb(h,c);p[c]=h;C(C.G+C.W+C.F,p);g||d.setStrong(h,c,e);return h})("Map",function(c){return function(){return c(this,0<arguments.length?arguments[0]:void 0)}},{get:function(c){return(c=Ld.getEntry(Za(this,"Map"),c))&&c.v},set:function(c,a){return Ld.def(Za(this,"Map"),0===c?0:c,a)}},Ld,!0);C(C.P+C.R,"Map",{toJSON:function(c){return function(){if(xc(this)!=c)throw TypeError(c+
"#toJSON isn't generic");var a=[];jb(this,!1,a.push,a,void 0);return a}}("Map")});(function(c){C(C.S,c,{of:function(){for(var a=arguments.length,b=Array(a);a--;)b[a]=arguments[a];return new this(b)}})})("Map");(function(c){C(C.S,c,{from:function(a,b,c){var d;cb(this);(d=void 0!==b)&&cb(b);if(void 0==a)return new this;var g=[];if(d){var k=0;var h=ia(b,c,2);jb(a,!1,function(a){g.push(h(a,k++))})}else jb(a,!1,g.push,g);return new this(g)}})})("Map");var xi=T.Map,yi=K(function(c){c.exports={"default":xi,
__esModule:!0}}),Qf=N(yi),zi=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b,c));b.index=[];c=b.canvas=document.createElement("canvas");c=b.ctx=c.getContext("2d");c.textAlign="start";c.textBaseline="top";return b}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{padding:[0,0]}}},{key:"initialize",value:function(a){this.gl=a;var b=this.getOptions();this.texture=null;this.program=new S(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute float a_corner;attribute vec2 a_size;attribute vec2 a_offset;attribute vec2 a_texture_coord;uniform mat4 u_matrix;uniform vec2 u_size;uniform vec2 u_offset;uniform float devicePixelRatio;varying vec2 v_texture_coord;vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x-=size[0];y+=size[1];}else if(corner==2.0){x+=size[0];y+=size[1];}else if(corner==3.0){x+=size[0];y-=size[1];}else{x-=size[0];y-=size[1];}return vec3(x,y,coord.z);}void main(){v_texture_coord=a_texture_coord;vec4 position=u_matrix*vec4(a_pos,1.0);vec3 screen=position.xyz/position.w;vec2 halfSize=a_size/MAPV_resolution*devicePixelRatio;vec3 current=transformCoord(screen,halfSize,a_corner);current.xy=current.xy-a_offset*2./MAPV_resolution*devicePixelRatio;gl_Position=vec4(current,1.0);}",
fragmentShader:"precision highp float;varying vec2 v_texture_coord;uniform sampler2D u_icon;uniform vec4 uSelectedColor;void main(){vec4 textureColor=texture2D(u_icon,vec2(v_texture_coord.x,1.0-v_texture_coord.y));if(textureColor.a==0.0){discard;}gl_FragColor=textureColor;\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}\n#endif\n}",defines:b.enablePicked?["PICK"]:[]},this);this.vertexBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.uvBuffer=
new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.indexBuffer=new H({gl:a,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});b=[{name:"a_pos",buffer:this.vertexBuffer,size:3,stride:32,type:"FLOAT",offset:0},{name:"a_corner",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:12},{name:"a_size",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:16},{name:"a_offset",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:24},{name:"a_texture_coord",buffer:this.uvBuffer,
size:2,stride:8,type:"FLOAT",offset:0}];b=b.concat(this.getCommonAttributes());this.vertexArray=new wa({gl:a,program:this.program,attributes:b})}},{key:"onChanged",value:function(a,c){var b=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){b.processCache(a,c)},0))}},{key:"processCache",value:function(a,c){var b=this;this.cachedData=[];this.iconHash=new Qf;for(var d=a.icon,k=a.width,h=a.height,m=a.offset,n=0;n<c.length;n++){var p=this.normizedPoint(c[n].geometry.coordinates),
l=c[n].icon||d;"properties"in c[n]&&"icon"in c[n].properties&&(l=c[n].properties.icon);var q=c[n].width||k;"properties"in c[n]&&"width"in c[n].properties&&(q=c[n].properties.width);var r=c[n].height||h;"properties"in c[n]&&"height"in c[n].properties&&(r=c[n].properties.height);var t=c[n].offset||m;"properties"in c[n]&&"offset"in c[n].properties&&(t=c[n].properties.offset);p&&l&&(this.cachedData.push({point:p,icon:l,width:q,height:r,offset:t}),p=new Image,this.iconHash.get(l)||this.iconHash.set(l,
p))}c=mh(this.iconHash.keys()).map(function(a){return new Of(function(c,d){b.url2canvas(a,function(d){b.iconHash.set(a,d);c()})})});Of.all(c).then(function(c){b.buildSprite(a);b.webglLayer.render()})}},{key:"buildSprite",value:function(a){var b=a.padding,c=this.canvas,g=this.ctx,k=[],h=new Qf,m=!0,n=!1,p=void 0;try{for(var l=Wc(this.iconHash),q;!(m=(q=l.next()).done);m=!0){var r=gb(q.value,2),t=r[1],u=t.width,w=t.height;k.push({w:u+b[0],h:w+b[0],width:u,height:w,key:r[0],icon:t})}}catch(y){n=!0,p=
y}finally{try{!m&&l.return&&l.return()}finally{if(n)throw p;}}n=pe(k);for(m=0;m<k.length;m++)p=k[m],h.get(p.key)||h.set(p.key,p);m=zb(n.w);n=zb(n.h);c.width=m;c.height=n;g.save();for(c=0;c<k.length;c++)p=k[c],g.drawImage(p.icon,p.x+b[0],p.y+b[1],p.width,p.height);g.restore();this.loadTexture();this.buildVertex(a,h,m,n)}},{key:"buildVertex",value:function(a,c,e,g){a=a.enablePicked;for(var b=[],d=[],m=[],n=[],p=0;p<this.cachedData.length;p++){var l=this.cachedData[p],q=l.point,r=l.width,t=l.height,
u=l.offset;l=c.get(l.icon);r=r||l.icon.width;t=t||l.icon.height;u=u||[0,-t/2];var w=gb(q,3);q=w[0];var x=w[1];w=w[2];for(var v=0;4>v;v++)b.push(q,x,w),b.push(v),b.push(r,t),b.push.apply(b,aa(u));r=l.x/e;t=(l.x+l.w)/e;u=(l.y+l.h)/g;l=l.y/g;d.push(r,u,r,l,t,l,t,u);l=4*p;m.push(l,l+2,l+1,l,l+3,l+2);a&&(l=this.indexToRgb(p),n.push(l[0]/255,l[1]/255,l[2]/255),n.push(l[0]/255,l[1]/255,l[2]/255),n.push(l[0]/255,l[1]/255,l[2]/255),n.push(l[0]/255,l[1]/255,l[2]/255))}this.index=m;this.vertexBuffer.updateData(new Float32Array(b));
this.uvBuffer.updateData(new Float32Array(d));this.indexBuffer.updateData(new Uint32Array(m));a&&this.pickBuffer.updateData(new Float32Array(n))}},{key:"render",value:function(a){if(this.cachedData&&this.cachedData.length&&this.iconHash&&this.texture){var b=a.gl,c=a.matrix,g=this.program;g.use(b);b.enable(b.BLEND);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);g.setUniforms(W(this.getCommonUniforms(a),{u_icon:this.texture,u_matrix:c,devicePixelRatio:window.devicePixelRatio}));0<this.index.length&&
(this.indexBuffer.bind(),this.vertexArray.bind(),b.drawElements(b.TRIANGLES,this.index.length,b.UNSIGNED_INT,0));b.useProgram(null)}}},{key:"url2canvas",value:function(a,c){if("object"===("undefined"===typeof a?"undefined":bc(a)))c(a);else{var b=new Image;b.crossOrigin="anonymous";b.onload=function(){var a=b.width,d=b.height,e=document.createElement("canvas");e.width=a;e.height=d;e.getContext("2d").drawImage(b,0,0,a,d);c(e)};b.src=a}}},{key:"loadTexture",value:function(){var a=this;this.canvas?Ma(this.gl,
this.canvas,function(b){a.texture=b}):this.texture=null}}]);return a}(ca),Ai=function(c){function a(b){F(this,a);var c=O(this,(a.__proto__||L(a)).call(this,b));b=c.getOptions();c.shapeLayer=new Ac({enablePicked:b.enablePicked});c.lineLayer=new pf;c.children=[c.shapeLayer,c.lineLayer];return c}P(a,c);J(a,[{key:"pick",value:function(a,c){return this.shapeLayer.pick(a,c)}},{key:"onOptionsChanged",value:function(a){this.shapeLayer.setOptions({onClick:function(b){a.onClick&&a.onClick(b)},selectedIndex:a.selectedIndex,
selectedColor:a.selectedColor,height:0,autoSelect:a.autoSelect,color:a.fillColor,opacity:a.fillOpacity,topColor:a.fillColor,useLight:!1});this.lineLayer.setOptions({color:a.lineColor,width:a.lineWidth,lineJoin:a.lineJoin})}},{key:"onDataChanged",value:function(a){this.shapeLayer.setData(a);this.lineLayer.setData(a)}},{key:"getDefaultOptions",value:function(){return{enablePicked:!1,selectedIndex:-1,selectedColor:"#ff0000",autoSelect:!0,lineColor:"rgba(250, 250, 25, 1)",lineWidth:2,lineJoin:"miter",
fillColor:"rgba(25, 25, 250, 1)",fillOpacity:1}}}]);return a}(sb);Y.prototype.parseColors=function(c){this.arrFeatureStyles=[[2,c[0]||"rgba(79,210,125,1)",2,2,0,[],0,0],[2,c[0]||"rgba(79,210,125,1)",3,2,0,[],0,0],[2,c[0]||"rgba(79,210,125,1)",3,2,0,[],0,0],[2,c[0]||"rgba(79,210,125,1)",5,2,0,[],0,0],[2,c[0]||"rgba(79,210,125,1)",6,2,0,[],0,0],[2,c[2]||"rgba(255,208,69,1)",2,2,0,[],0,0],[2,c[2]||"rgba(255,208,69,1)",3,2,0,[],0,0],[2,c[2]||"rgba(255,208,69,1)",3,2,0,[],0,0],[2,c[2]||"rgba(255,208,69,1)",
5,2,0,[],0,0],[2,c[2]||"rgba(255,208,69,1)",6,2,0,[],0,0],[2,c[1]||"rgba(232,14,14,1)",2,2,0,[],0,0],[2,c[1]||"rgba(232,14,14,1)",3,2,0,[],0,0],[2,c[1]||"rgba(232,14,14,1)",3,2,0,[],0,0],[2,c[1]||"rgba(232,14,14,1)",5,2,0,[],0,0],[2,c[1]||"rgba(232,14,14,1)",6,2,0,[],0,0],[2,c[3]||"rgba(181,0,0,1)",2,2,0,[],0,0],[2,c[3]||"rgba(181,0,0,1)",3,2,0,[],0,0],[2,c[3]||"rgba(181,0,0,1)",3,2,0,[],0,0],[2,c[3]||"rgba(181,0,0,1)",5,2,0,[],0,0],[2,c[3]||"rgba(181,0,0,1)",6,2,0,[],0,0],[2,"rgba(255,255,255,1)",
4,0,0,[],0,0],[2,"rgba(255,255,255,1)",5.5,0,0,[],0,0],[2,"rgba(255,255,255,1)",7,0,0,[],0,0],[2,"rgba(255,255,255,1)",8.5,0,0,[],0,0],[2,"rgba(255,255,255,1)",10,0,0,[],0,0]]};Y.prototype.setColors=function(c){this.parseColors(c)};Y.prototype.initialize=function(c){this._initialize||(this._initialize=!0)};Y.prototype.clearCache=function(c){this.cache={}};Y.prototype.setMap=function(c){c?(this.map=c,this._initialize?this.canvaslayer.show():this.initialize(c)):this.canvaslayer.hide()};Y.prototype.draw=
function(c){c=c||{};c.clearCache&&this.clearCache();this.canvaslayer.draw()};Y.prototype.clear=function(){};Y.prototype.update=function(){var c=this.map,a=this.getDataZoom(),b=Math.pow(2,18-a),d=256*b,e=c.getCenter(),g=Math.ceil(e.lng/d),k=Math.ceil(e.lat/d),h=this.tileSize,m=a-Math.round(c.getZoom());0<m&&(h/=Math.pow(2,m));d=[g,k,(e.lng-g*d)/d*h,(e.lat-k*d)/d*h];g=c.getBounds();e=g.getNorthEast();g=g.getSouthWest();c.getSize();c.getSize();c=(e.lng-g.lng)/b;b=(e.lat-g.lat)/b;e=d[1]-Math.ceil((b/
2-d[3])/h);g=d[0]+Math.ceil((c/2+d[2])/h);k=d[1]+Math.ceil((b/2+d[3])/h);b=[];for(h=d[0]-Math.ceil((c/2-d[2])/h);h<g;h++)for(d=e;d<k;d++)b.push([h,d,a]);this.tilesOrder=b;this._loadCount={};for(h=0;h<b.length;h++)d=b[h][0],c=b[h][1],this._loadCount[d+"_"+c+"_"+b[h][2]]=!1;for(h=0;h<b.length;h++)d=b[h][0],c=b[h][1],this.showTile(d,c,a)};Y.prototype.showTile=function(c,a,b){this._parseDataAndDraw(c,a,b)};Y.prototype.drawCurrentData=function(){this.clear();for(var c=[],a=0;a<this.tilesOrder.length;a++){var b=
this.tilesOrder[a][0],d=this.tilesOrder[a][1],e=this.tilesOrder[a][2],g=this.cache[this.getCacheKey(b,d,e)];if(g)for(b=this._drawFeatures(g,b,d,e),d=0;d<b.length;d++)c.push(b[d])}this.lineLayer.setData(c)};Y.prototype.isAllLoaded=function(){var c=!0,a;for(a in this._loadCount)if(!this._loadCount[a]){c=!1;break}return c};Y.prototype.getCacheKey=function(c,a,b){return c+"_"+a+"_"+b};Y.prototype.getDataZoom=function(){var c=Math.round(this.map.getZoom());19<c&&(c=19);return c};Y.prototype._parseDataAndDraw=
function(c,a,b){var d=this,e=d.map,g=e.getCenter(),k=Math.round(e.getZoom()),h=this.getCacheKey(c,a,b),m="_cbk"+(1E5*Math.random()).toFixed(0),n=this.getTileUrl(c,a,b,"BMapGL."+m);BMapGL[m]=function(n){d._loadCount[c+"_"+a+"_"+b]=!0;var l=e.getCenter(),p=Math.round(e.getZoom());l.equals(g)&&p===k?(l=n.content&&n.content.tf,n.data&&(l=n.data),d.cache[h]=l?{traffic:l,precision:n.precision}:null,d.drawTogether&&d.isAllLoaded()&&d.drawCurrentData()):p!==k&&d.clear();delete BMapGL[m]};void 0!==d.cache[h]?
(d._loadCount[c+"_"+a+"_"+b]=!0,d.drawTogether&&d.isAllLoaded()&&d.drawCurrentData()):this.request(n)};Y.prototype.getTileUrl=function(c,a,b,d){return"https://sp3.baidu.com/7_AZsjOpB1gCo2Kml5_Y_DAcsMJiwa/traffic/?qt=vtraffic&x="+c+"&y="+a+"&z="+b+"&fn="+d+"&t="+(new Date).getTime()};Y.prototype._drawFeatures=function(c,a,b,d){var e=10;d=Math.pow(2,18-d);this.map.getCenter();var g=this.tileSize;a=[a*g*d,(b+1)*g*d];b=[];if(c&&c.traffic){e*=c.precision;c=c.traffic;g=0;for(var k=c.length;g<k;g++){var h=
c[g],m=h[1];h=this.arrFeatureStyles[h[3]];var n=m[0]/e,p=-m[1]/e,l=[];l.push([a[0]+n*d,a[1]+p*d]);for(var q=2,r=m.length;q<r;q+=2)n+=m[q]/e,p-=m[q+1]/e,l.push([a[0]+n*d,a[1]+p*d,1]);b.push({color:h[1],geometry:{type:"LineString",coordinates:l}})}}return b};Y.prototype.request=function(c,a){if(a){var b=(1E5*Math.random()).toFixed(0);BMapGL._rd["_cbk"+b]=function(c){a&&a(c);delete BMapGL._rd["_cbk"+b]};c+="&callback=BMapGL._rd._cbk"+b}var d=document.createElement("script");d.type="text/javascript";
d.charset="utf-8";d.src=c;d.addEventListener?d.addEventListener("load",function(a){a=a.target;a.parentNode.removeChild(a)},!1):d.attachEvent&&d.attachEvent("onreadystatechange",function(a){a=window.event.srcElement;!a||"loaded"!==a.readyState&&"complete"!==a.readyState||a.parentNode.removeChild(a)});setTimeout(function(){document.getElementsByTagName("head")[0].appendChild(d);d=null},1)};Y.prototype.getRGBA=function(c){c>>>=0;return"rgba("+(c>>24&255)+","+(c>>16&255)+","+(c>>8&255)+","+(c&255)/256+
")"};Y.prototype.getLineCap=function(c){return["butt","square","round"][c]};Y.prototype.getLineJoin=function(c){return["miter","bevel","round"][c]};var Bi=function(c){function a(b){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b));b.autoUpdate=!0;b.getOptions();var c=new vf({color:"rgba(257, 254, 47, 0.9)",zoom:18,duration:.8,interval:.2,trailLength:.4}),e=new qf({height:5,color:"rgba(257, 254, 47, 0.9)",trailLength:2,step:.02,startTime:0,endTime:4});b.lineLayer=c;b.wallTripLayer=e;b.children=
[c,e];return b}P(a,c);J(a,[{key:"initialize",value:function(b){Ya(a.prototype.__proto__||L(a.prototype),"initialize",this).call(this,b);b=this.map.map;var c=new Y({});c.lineLayer=this.lineLayer;c.wallTripLayer=this.wallTripLayer;this.trafficTileManager=c;c.setMap(b);c.update();b.addEventListener("moveend",function(){c.update()});b.addEventListener("zoomend",function(){c.update()});b.addEventListener("ondraw",function(){})}},{key:"onOptionsChanged",value:function(a){}},{key:"onDataChanged",value:function(a){}},
{key:"getDefaultOptions",value:function(){return{}}}]);return a}(sb),Ci=function(c){function a(b,c){F(this,a);b=O(this,(a.__proto__||L(a)).call(this,b,c));b.bufferData=[];return b}P(a,c);J(a,[{key:"getDefaultOptions",value:function(){return{size:13,unit:"px",height:0,max:100,min:0}}},{key:"initialize",value:function(a){var b=this;this.gl=a;var c=this.getOptions();this.inverseMatrix=R.create(Float64Array);this.frameBuffer=new sa(a);this.webglLayer.map.onResize(function(){b.frameBuffer=new sa(a)});
this.circle=ig(64);this.circleTexture=kb(a,this.circle,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"});this.intensity=new la({gradient:c.gradient});this.paletteTexture=kb(a,this.intensity.paletteCtx.canvas,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"});this.offlineProgram=new S(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform mat4 pointToPixelMatrix;uniform mat4 pixelToViewMatrix;uniform mat4 projectionMatrix;uniform int unit;uniform float size;uniform float max;uniform float min;attribute vec3 aPos;attribute vec2 aOffset;attribute float aCount;varying vec2 vOffset;varying float vCount;varying vec3 vPosition;void main(){vOffset=aOffset;vCount=(aCount-min)/(max-min);if(unit==1){vec2 pos=(pointToPixelMatrix*vec4(aPos.xy,0.0,1.0)).xy+aOffset.xy*size/2.0;gl_Position=projectionMatrix*pixelToViewMatrix*vec4(pos,0.0,1.0);}else{vec2 pos=aPos.xy+aOffset.xy*size;gl_Position=u_matrix*vec4(pos,0.0,1.0);}vPosition=vec3(gl_Position.z/gl_Position.w);}",
fragmentShader:"varying vec2 vOffset;varying float vCount;varying vec3 vPosition;uniform sampler2D uCircle;void main(){vec4 circle=texture2D(uCircle,(vOffset+1.0)/2.0);float intensity=circle.a*vCount;if(intensity<=0.0){discard;}gl_FragColor=vec4(vPosition,intensity);}"},this);this.offlineBuffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.offlineIndexBuffer=new H({gl:a,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});this.offlineVertexArray=new wa({gl:a,program:this.offlineProgram,
attributes:[{stride:24,name:"aPos",buffer:this.offlineBuffer,size:3,type:"FLOAT",offset:0},{stride:24,name:"aOffset",buffer:this.offlineBuffer,size:2,type:"FLOAT",offset:12},{stride:24,name:"aCount",buffer:this.offlineBuffer,size:1,type:"FLOAT",offset:20}]});this.indexBuffer=new H({gl:a,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});this.program=new S(this.gl,{vertexShader:"attribute vec2 aPos;varying vec2 vPos;uniform float uHeight;uniform mat4 pixelToViewMatrix;uniform mat4 projectionMatrix;uniform sampler2D u_sampler;uniform mat4 inverseMatrix;void main(){vPos=aPos;if(uHeight<=0.0){gl_Position=vec4(aPos,0.0,1.0);}else{vec4 gray=texture2D(u_sampler,(aPos+1.0)/2.0);vec4 m0=inverseMatrix*vec4(aPos.xy,0.0,1.0);vec4 m1=inverseMatrix*vec4(aPos.xy,1.0,1.0);m0/=m0.w;m1/=m1.w;vec4 pixel=m0+(-m0.z/(m1.z-m0.z))*(m1-m0);pixel.z=uHeight*gray.a;gl_Position=projectionMatrix*pixelToViewMatrix*vec4(pixel.xyz,1.0);}}",
fragmentShader:"uniform sampler2D u_sampler;uniform sampler2D u_samplerPalette;uniform float uHeight;varying vec2 vPos;void main(){vec4 gray=texture2D(u_sampler,(vPos+1.0)/2.0);float grayAlpha=gray.a;if(grayAlpha<=0.0){discard;}vec4 color=texture2D(u_samplerPalette,vec2(grayAlpha,1.0));gl_FragColor=vec4(color.rgb,grayAlpha);}"},this);this.buffer=new H({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.vertexArray=new wa({gl:a,program:this.program,attributes:[{stride:8,name:"aPos",buffer:this.buffer,
size:2,type:"FLOAT",offset:0}]});c=[];for(var g=[],k=Math.floor(a.canvas.width/4),h=Math.floor(a.canvas.height/4),m=k+1,n=0;n<=h;n++)for(var p=0;p<=k;p++)if(c.push(2*p/k-1,2*n/h-1),p<k&&n<h){var l=m*n+p,q=m*(n+1)+p;g.push(l,q+1,l+1);g.push(l,q,q+1)}this.bufferData=c;this.buffer.updateData(new Float32Array(c));this.indexData=g;this.indexBuffer.updateData(new Uint32Array(g))}},{key:"onOptionsChanged",value:function(a,c){var b=this.gl;b&&a.gradient!==c.gradient&&(this.intensity=new la({gradient:a.gradient}),
this.paletteTexture=kb(b,this.intensity.paletteCtx.canvas,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}))}},{key:"onDataChanged",value:function(a){if(this.gl){var b=[],c=[];this.getOptions();for(var g=0;g<a.length;g++){var k=a[g],h=this.normizedPoint(a[g].geometry.coordinates),m=void 0===k.count?1:k.count;"properties"in k&&"count"in k.properties&&(m=k.properties.count);b.push(h[0],h[1],h[2]);b.push(-1,-1);b.push(m);b.push(h[0],
h[1],h[2]);b.push(-1,1);b.push(m);b.push(h[0],h[1],h[2]);b.push(1,1);b.push(m);b.push(h[0],h[1],h[2]);b.push(1,-1);b.push(m);k=4*g;c.push(k+0,k+1,k+2);c.push(k+0,k+2,k+3)}this.offlineBufferData=b;this.offlineIndexData=c;this.offlineBuffer.updateData(new Float32Array(b));this.offlineIndexBuffer.updateData(new Uint32Array(c))}}},{key:"render",value:function(a){var b=a.gl,c=a.matrix,g=a.pointToPixelMatrix,k=a.pixelToViewMatrix;a=a.projectionMatrix;if(this.offlineBufferData&&!(0>=this.offlineBufferData.length)){var h=
this.getOptions();b.enable(b.BLEND);b.disable(b.DEPTH_TEST);b.blendFunc(b.ONE,b.ONE);b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer.framebuffer);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT);this.offlineProgram.use(b);this.offlineProgram.setUniforms({u_matrix:c,uCircle:this.circleTexture,pointToPixelMatrix:g,pixelToViewMatrix:k,projectionMatrix:a,unit:"px"===h.unit?1:0,size:h.size,max:h.max,min:h.min});this.offlineVertexArray.bind();this.offlineIndexBuffer.bind();b.drawElements(b.TRIANGLES,
this.offlineIndexData.length,b.UNSIGNED_INT,0);b.bindFramebuffer(b.FRAMEBUFFER,null);this.program.use(b);this.vertexArray.bind();c=this.inverseMatrix;R.identity(c);R.multiply(c,a,k);R.invert(c,c);b.enable(b.DEPTH_TEST);b.disable(b.BLEND);this.program.setUniforms({u_sampler:this.frameBuffer.framebuffer.texture,u_samplerPalette:this.paletteTexture,uHeight:h.height,pixelToViewMatrix:k,inverseMatrix:c,projectionMatrix:a});this.indexBuffer.bind();b.drawElements(b.TRIANGLES,this.indexData.length,b.UNSIGNED_INT,
0)}}}]);return a}(ca),Di=function(){function c(a){F(this,c);this.layers=[];this.options=a;this.webglLayer=a.webglLayer}J(c,[{key:"addLayer",value:function(a){for(var b=!1,c=0;c<this.layers.length;c++)if(this.layers[c]===a){b=!0;break}b||(a.map=this.webglLayer.map,"threeLayer"===a.layerType?(a.setWebglLayer(this.webglLayer),b=a.getThreeLayer(),this.addLayer(b),a.initialize&&a.initialize(b)):(a.setWebglLayer(this.webglLayer),a.commonInitialize&&a.commonInitialize(this.webglLayer.gl),a.initialize&&a.initialize(this.webglLayer.gl),
a.onOptionsChanged(a.getOptions(),{}),a.onDataChanged(a.getData()),a.onChanged(a.getOptions(),a.getData())),this.layers.push(a));this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation());this.webglLayer.render()}},{key:"removeLayer",value:function(a){for(var b=0;b<this.layers.length;b++)this.layers[b]===a&&(a.destroy&&a.destroy(),this.layers.splice(b,1));this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():
this.webglLayer.stopAnimation());this.webglLayer.render()}},{key:"removeAllLayers",value:function(){for(var a=0;a<this.layers.length;a++){var b=this.layers[a];b.destroy&&b.destroy();this.layers.splice(a,1)}this.webglLayer.render()}},{key:"isRequestAnimation",value:function(){for(var a=!1,b=0;b<this.layers.length;b++)if(this.layers[b].isRequestAnimation()){a=!0;break}return a}},{key:"beforeRender",value:function(a){a.gl&&this.webglLayer.stateManager.save()}},{key:"afterRender",value:function(a){a.gl&&
this.webglLayer.stateManager.restore()}},{key:"renderGLLayers",value:function(a){this.webglLayer.stateManager.save();this.webglLayer.stateManager.setDefaultState();for(var b=0;b<this.layers.length;b++){var c=this.layers[b];"threeLayer"!==c.layerType&&"ThreeLayer"!==c.layerType&&(this.beforeRender(a),a.gl.enable(a.gl.DEPTH_TEST),a.gl.depthFunc(a.gl.LEQUAL),a.gl.enable(a.gl.POLYGON_OFFSET_FILL),a.gl.polygonOffset(1,1),c.render(a),this.afterRender(a))}this.webglLayer.stateManager.restore()}},{key:"renderThreeLayer",
value:function(a){for(var b=0;b<this.layers.length;b++){var c=this.layers[b];"ThreeLayer"===c.layerType&&c.render(a)}}},{key:"renderThreeLayers",value:function(a){for(var b=0;b<this.layers.length;b++){var c=this.layers[b];"threeLayer"===c.layerType&&(this.beforeRender(a),c.render(a),this.afterRender(a))}}},{key:"onClick",value:function(a){for(var b=0;b<this.layers.length;b++){var c=this.layers[b];if("threeLayer"!==c.layerType&&"ThreeLayer"!==c.layerType&&c.options.enablePicked&&c.options.onClick&&
c.pick){var e=c.pick(a.x,a.y);c.options.onClick(e)}}}},{key:"onDblClick",value:function(a){for(var b=0;b<this.layers.length;b++){var c=this.layers[b];if("threeLayer"!==c.layerType&&"ThreeLayer"!==c.layerType&&c.options.enablePicked&&c.options.onDblClick&&c.pick){var e=c.pick(a.x,a.y);c.options.onDblClick(e)}}}},{key:"onRightClick",value:function(a){for(var b=0;b<this.layers.length;b++){var c=this.layers[b];if("threeLayer"!==c.layerType&&"ThreeLayer"!==c.layerType&&c.options.enablePicked&&c.options.onRightClick&&
c.pick){var e=c.pick(a.x,a.y);c.options.onRightClick(e)}}}},{key:"onMousemove",value:function(a){for(var b=!1,c=0;c<this.layers.length;c++){var e=this.layers[c];if("threeLayer"!==e.layerType&&"ThreeLayer"!==e.layerType&&e.options.enablePicked&&e.pick){var g=e.pick(a.x,a.y);-1===g.dataIndex?this.webglLayer.map.map.setDefaultCursor("default"):this.webglLayer.map.map.setDefaultCursor("pointer");if(e.options.onMousemove)e.options.onMousemove(g);e.options.autoSelect&&(b=!0)}}b&&(this.webglLayer.isAnimation||
this.webglLayer.render())}}]);return c}(),Ei=function(){function c(a){var b=this;F(this,c);this.options={autoUpdate:!0};W(this.options,a);var d=a.pointOffset;this.webglLayer=a.webglLayer||new sf(a.map,this.options);this.layerManager=new Di({autoUpdate:this.options.autoUpdate,webglLayer:this.webglLayer});this.effectManager=new cf(this.webglLayer.gl);this.webglRender={render:function(){}};this.options.effects&&this.effectManager.setEffects([this.webglRender].concat(this.options.effects));this.webglLayer.onRender(function(a){b._render(a)});
this.webglLayer.onClick=function(a){b.layerManager.onClick(a)};this.webglLayer.onDblClick=function(a){b.layerManager.onDblClick(a)};this.webglLayer.onRightClick=function(a){b.layerManager.onRightClick(a)};this.webglLayer.onMousemove=function(a){b.layerManager.onMousemove(a)};d||"cesium"===this.webglLayer.options.mapType||(d=this.webglLayer.map.getCenter(),this.webglLayer.options.pointOffset=[d.lng,d.lat]);this.webglLayer.map.onResize(function(){b.effectManager.onResize()});if(this.postProcessing=
a.postProcessing)this.postProcessing.setWebglLayer(this.webglLayer),a=this.postProcessing.getThreeLayer(),this.addLayer(a),this.postProcessing.initialize(a),a.postProcessing=this.postProcessing}J(c,[{key:"renderCanvas",value:function(a){var b=this;this.postProcessing?(this.postProcessing.addRender(function(){b.renderGLLayers(a)}),this.layerManager.renderThreeLayers(a),this.layerManager.renderThreeLayer(a)):(this.layerManager.renderThreeLayers(a),this.layerManager.renderThreeLayer(a),this.layerManager.renderGLLayers(a))}},
{key:"render",value:function(){this.webglLayer.render()}},{key:"_render",value:function(a){var b=this,c=this.options.effects;c&&0<c.length?(this.webglRender.render=function(){b.renderCanvas(a)},this.effectManager.render()):(this.webglLayer.saveFramebuffer(),this.renderCanvas(a),this.webglLayer.restoreFramebuffer())}},{key:"onRender",value:function(a){this.webglLayer.onRender(a)}},{key:"destroy",value:function(){this.stopAnimation();this.layerManager.removeAllLayers();this.webglLayer.destroy()}},{key:"isRequestAnimation",
value:function(){return this.layerManager.isRequestAnimation()}},{key:"startAnimation",value:function(){this.webglLayer.startAnimation()}},{key:"stopAnimation",value:function(){this.webglLayer.stopAnimation()}},{key:"addLayer",value:function(a){this.layerManager.addLayer(a)}},{key:"removeLayer",value:function(a){this.layerManager.removeLayer(a)}}]);return c}();window._hmt=window._hmt||[];(function(){var c=document.createElement("script");c.src="https://hm.baidu.com/hm.js?e8002ef3d9e0d8274b5b74cc4a027d08";
var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(c,a)})();x.View=Ei;x.GridLayer=mf;x.HeatGridLayer=Hh;x.ShapeLayer=Ac;x.SimpleLineLayer=nf;x.LineLayer=pf;x.WallSpriteLayer=qf;x.LinePointLayer=ib;x.WallLayer=Qh;x.WallTripLayer=Sh;x.HeatLineLayer=Th;x.HoneycombLayer=Vh;x.WebglLayer=sf;x.PointLayer=zd;x.GroundRippleLayer=ai;x.RippleLayer=bi;x.SparkLayer=ci;x.ClusterLayer=di;x.HeatPointLayer=ei;x.ShapeLineLayer=fi;x.PointTripLayer=gi;x.LineTripLayer=hi;x.LineFlowLayer=vf;x.TileLayer=
ii;x.IconLayer=zi;x.PolygonLayer=Ai;x.Layer=ca;x.TextLayer=yd;x.TrafficLayer=Bi;x.HeatmapLayer=Ci;x.BlurEffect=vh;x.BloomEffect=wh;x.BrightEffect=xh;x.DepthEffect=yh;x.EffectManager=cf;x.getContext=Rd;x.createTexture=kb;x.loadTextureImage=Ma;x.FrameBufferObject=sa;x.Program=S;x.StateManager=bf;x.Buffer=H;x.VertexArray=wa;x.CommonLayer=qd;x.MercatorProjection=ua;x.Canvas=Nc;x.Intensity=la;x.BezierCurve=La;x.GeodesicCurve=Sa;x.toRadian=ja;x.toAngle=Kc;x.ceilPowerOfTwo=zb;x.floorPowerOfTwo=Lc;x.approximatelyEqual=
Mc;x.__moduleExports=Aa;x.vec4=zc;x.vec3=Sb;x.vec2=zh;x.quat2=Ah;x.quat=Bh;x.mat4=R;x.mat3=Ch;x.mat2d=Dh;x.mat2=Eh;x.glMatrix=Fh;Object.defineProperty(x,"__esModule",{value:!0})});
